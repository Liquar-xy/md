# 我的附近功能使用说明

## 🎯 功能概述

前端"我的附近"功能已经完全实现，支持：

- ✅ **真实API调用**：调用后端 `http://localhost:8000/api/nearby/my-nearby` 接口
- ✅ **模拟数据模式**：当后端服务不可用时，使用模拟数据进行测试
- ✅ **百度地图显示**：显示用户位置和附近寄存点
- ✅ **实时定位**：自动获取用户GPS位置
- ✅ **距离计算**：显示寄存点距离用户的距离
- ✅ **状态管理**：区分可用/不可用寄存点

## 🚀 使用步骤

### 1. 启动后端服务

```bash
cd ito-deposit
go run cmd/ito-deposit/main.go
```

服务启动后会监听 `http://localhost:8000`

### 2. 测试后端接口（可选）

```powershell
# 在 ito-deposit 目录下运行
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.\test_api.ps1
```

### 3. 启动前端应用

1. 启动uni-app项目
2. 登录后进入首页
3. 点击"我的附近"按钮
4. 允许位置权限（如果浏览器询问）

### 4. 功能测试

#### 真实API模式（默认）
- 页面会自动调用后端接口
- 如果后端服务正常，会显示真实的寄存点数据
- 如果后端服务不可用，会提示切换到模拟数据

#### 模拟数据模式
- 点击右侧的"真实API"按钮切换到"模拟数据"模式
- 会显示模拟的寄存点数据，用于前端功能测试

## 🔧 接口配置

### 后端接口地址
```
GET http://localhost:8000/api/nearby/my-nearby
```

### 请求参数
```
?longitude=116.397428&latitude=39.90923&radius=5&limit=20
```

### 返回格式
```json
{
  "user_location": {
    "longitude": 116.397428,
    "latitude": 39.90923,
    "address": "北京市东城区天安门广场",
    "city": "北京市",
    "district": "东城区",
    "province": "北京市",
    "location_type": "gps"
  },
  "nearby_points": [
    {
      "id": 1,
      "name": "天安门寄存点",
      "address": "北京市东城区天安门广场东侧",
      "distance": 0.2,
      "longitude": 116.398,
      "latitude": 39.909
    }
  ],
  "total_count": 1,
  "search_radius": 5.0,
  "baidu_map_ak": "7pzoTHchDdMRK7jmpCr1sugjv3hfoxz5"
}
```

## 🎨 页面功能

### 地图功能
- 🗺️ **百度地图显示**：显示用户位置和寄存点
- 📍 **位置标记**：用户位置（蓝色）和寄存点（红色/灰色）
- 🔄 **重新定位**：点击定位按钮重新获取位置
- 🔄 **刷新数据**：点击刷新按钮更新寄存点信息

### 寄存点列表
- 📋 **列表显示**：底部面板显示寄存点详细信息
- 📏 **距离显示**：显示每个寄存点的距离
- 🏪 **状态显示**：显示寄存点可用状态
- 👆 **点击交互**：点击寄存点跳转到详情页

### 开发工具
- 🔧 **API模式切换**：右侧按钮切换真实API/模拟数据
- 📊 **控制台日志**：详细的调试信息输出
- ⚠️ **错误处理**：友好的错误提示和降级方案

## 🐛 常见问题

### 1. 后端服务连接失败
**现象**：页面提示"连接后端服务失败"

**解决方案**：
1. 确保后端服务已启动：`go run cmd/ito-deposit/main.go`
2. 检查服务是否监听 8000 端口
3. 或者点击"使用模拟数据"进行前端功能测试

### 2. 定位失败
**现象**：无法获取用户位置

**解决方案**：
1. 确保浏览器允许位置权限
2. 使用HTTPS协议（生产环境）
3. 检查网络连接

### 3. 地图不显示
**现象**：地图区域空白

**解决方案**：
1. 检查百度地图API密钥配置
2. 确保网络可以访问百度地图服务
3. 查看浏览器控制台错误信息

## 📱 移动端适配

- ✅ 响应式布局设计
- ✅ 触摸操作优化
- ✅ GPS定位支持
- ✅ 移动端地图交互

## 🔄 实时更新

- ⏰ 30秒自动刷新寄存点信息
- 🔄 页面显示时自动更新
- 📍 位置变化时重新搜索

## 📞 技术支持

如果遇到问题：

1. 查看浏览器控制台的详细日志
2. 确认后端服务状态
3. 尝试切换到模拟数据模式测试前端功能
4. 检查网络连接和权限设置

---

**注意**：首次使用时，浏览器可能会询问位置权限，请点击"允许"以获得最佳体验。