<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>åŸå¸‚åŒæ­¥æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>æ™ºèƒ½å¯„å­˜æŸœ - åŸå¸‚åŒæ­¥é—®é¢˜ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-case info">
        <h3>é—®é¢˜æè¿°</h3>
        <p>åœ¨é¦–é¡µé€‰æ‹©åŒ—äº¬åï¼Œç‚¹å‡»"æˆ‘çš„é™„è¿‘"é¡µé¢ï¼Œå…ˆæ˜¾ç¤ºéƒ‘å·çš„å¯„å­˜ç‚¹ï¼Œç„¶åå‡ºç°"åœ°å›¾åŠ è½½å¤±è´¥"ï¼Œéœ€è¦ç‚¹å‡»é‡è¯•æ‰èƒ½æ­£ç¡®æ˜¾ç¤ºåŒ—äº¬çš„å¯„å­˜ç‚¹ã€‚</p>
    </div>

    <div class="test-case success">
        <h3>âœ… ä¿®å¤æ–¹æ¡ˆ</h3>
        <ul>
            <li><strong>é¦–é¡µä¼˜åŒ–</strong>ï¼šè·³è½¬å‰ç¡®ä¿åŸå¸‚ä¿¡æ¯æ­£ç¡®ä¿å­˜ï¼Œä¼ é€’åŸå¸‚å‚æ•°</li>
            <li><strong>é™„è¿‘é¡µé¢ä¼˜åŒ–</strong>ï¼šä¼˜å…ˆä½¿ç”¨é¡µé¢å‚æ•°ï¼Œæ”¹å–„åˆå§‹åŒ–é€»è¾‘</li>
            <li><strong>é”™è¯¯å¤„ç†ä¼˜åŒ–</strong>ï¼šé‡è¯•æ—¶ä¿æŒæ­£ç¡®çš„åŸå¸‚ä¿¡æ¯</li>
            <li><strong>æ•°æ®åŒæ­¥ä¼˜åŒ–</strong>ï¼šç»Ÿä¸€åŸå¸‚ä¿¡æ¯çš„å­˜å‚¨å’Œè¯»å–é€»è¾‘</li>
        </ul>
    </div>

    <div class="test-case">
        <h3>ğŸ§ª æµ‹è¯•ç”¨ä¾‹</h3>
        
        <h4>æµ‹è¯•1ï¼šæ¨¡æ‹Ÿé¦–é¡µåŸå¸‚é€‰æ‹©</h4>
        <button onclick="testCitySelection('åŒ—äº¬')">é€‰æ‹©åŒ—äº¬</button>
        <button onclick="testCitySelection('ä¸Šæµ·')">é€‰æ‹©ä¸Šæµ·</button>
        <button onclick="testCitySelection('å¹¿å·')">é€‰æ‹©å¹¿å·</button>
        <button onclick="testCitySelection('æ·±åœ³')">é€‰æ‹©æ·±åœ³</button>
        
        <h4>æµ‹è¯•2ï¼šæ¨¡æ‹Ÿé¡µé¢è·³è½¬</h4>
        <button onclick="testPageNavigation()">è·³è½¬åˆ°é™„è¿‘é¡µé¢</button>
        <button onclick="testRetry()">æµ‹è¯•é‡è¯•åŠŸèƒ½</button>
        
        <h4>æµ‹è¯•3ï¼šæ•°æ®éªŒè¯</h4>
        <button onclick="checkLocalStorage()">æ£€æŸ¥æœ¬åœ°å­˜å‚¨</button>
        <button onclick="clearTestData()">æ¸…é™¤æµ‹è¯•æ•°æ®</button>
    </div>

    <div class="test-case">
        <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
        <div id="testResults" class="log">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <script>
        // åŸå¸‚åæ ‡é…ç½®ï¼ˆä¸å®é™…ä»£ç ä¿æŒä¸€è‡´ï¼‰
        const cityCoordinates = {
            'åŒ—äº¬': { longitude: 116.4074, latitude: 39.9042 },
            'ä¸Šæµ·': { longitude: 121.4737, latitude: 31.2304 },
            'å¤©æ´¥': { longitude: 117.1901, latitude: 39.1084 },
            'é‡åº†': { longitude: 106.5516, latitude: 29.5630 },
            'éƒ‘å·': { longitude: 113.6253, latitude: 34.7466 },
            'å¹¿å·': { longitude: 113.2644, latitude: 23.1291 },
            'æ·±åœ³': { longitude: 114.0579, latitude: 22.5431 },
            'æˆéƒ½': { longitude: 104.0665, latitude: 30.5728 },
            'æ­å·': { longitude: 120.1551, latitude: 30.2741 },
            'å—äº¬': { longitude: 118.7969, latitude: 32.0603 }
        };

        let testLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLog.push(logEntry);
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = testLog.join('\n');
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
            
            console.log(logEntry);
        }

        // æµ‹è¯•åŸå¸‚é€‰æ‹©åŠŸèƒ½
        function testCitySelection(cityName) {
            log(`ğŸ™ï¸ æµ‹è¯•é€‰æ‹©åŸå¸‚: ${cityName}`);
            
            // æ¨¡æ‹Ÿé¦–é¡µçš„åŸå¸‚é€‰æ‹©é€»è¾‘
            const cityInfo = {
                name: cityName,
                coordinates: cityCoordinates[cityName] || cityCoordinates['éƒ‘å·']
            };
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæ¨¡æ‹ŸlocalStorageï¼‰
            localStorage.setItem('selectedCity', JSON.stringify(cityInfo));
            
            log(`âœ… åŸå¸‚ä¿¡æ¯å·²ä¿å­˜: ${JSON.stringify(cityInfo)}`);
            log(`ğŸ“ åæ ‡: ç»åº¦${cityInfo.coordinates.longitude}, çº¬åº¦${cityInfo.coordinates.latitude}`);
        }

        // æµ‹è¯•é¡µé¢è·³è½¬é€»è¾‘
        function testPageNavigation() {
            log('ğŸ”„ æµ‹è¯•é¡µé¢è·³è½¬é€»è¾‘');
            
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„åŸå¸‚ä¿¡æ¯
            const selectedCity = JSON.parse(localStorage.getItem('selectedCity') || 'null');
            
            if (selectedCity) {
                log(`âœ… æ£€æµ‹åˆ°é€‰æ‹©çš„åŸå¸‚: ${selectedCity.name}`);
                log(`ğŸ“¡ æ¨¡æ‹Ÿè·³è½¬URL: /pages/nearby/nearby?city=${encodeURIComponent(selectedCity.name)}`);
                
                // æ¨¡æ‹Ÿé™„è¿‘é¡µé¢çš„onLoadé€»è¾‘
                const cityParam = selectedCity.name;
                log(`ğŸ“¥ é™„è¿‘é¡µé¢æ¥æ”¶å‚æ•°: city=${cityParam}`);
                
                // æ¨¡æ‹Ÿåˆå§‹åŒ–é€»è¾‘
                if (cityParam && cityCoordinates[cityParam]) {
                    log(`ğŸ—ºï¸ ä½¿ç”¨åŸå¸‚åæ ‡åˆå§‹åŒ–åœ°å›¾: ${cityParam}`);
                    log(`ğŸ“ åœ°å›¾ä¸­å¿ƒ: ${cityCoordinates[cityParam].longitude}, ${cityCoordinates[cityParam].latitude}`);
                    log(`âœ… æµ‹è¯•é€šè¿‡ï¼šç›´æ¥æ˜¾ç¤ºæ­£ç¡®åŸå¸‚ï¼Œæ— éœ€åˆ‡æ¢`);
                } else {
                    log(`âŒ æµ‹è¯•å¤±è´¥ï¼šåŸå¸‚å‚æ•°æ— æ•ˆ`);
                }
            } else {
                log(`âš ï¸ æœªæ‰¾åˆ°é€‰æ‹©çš„åŸå¸‚ï¼Œå°†ä½¿ç”¨é»˜è®¤åŸå¸‚`);
                log(`ğŸ™ï¸ é»˜è®¤åŸå¸‚: éƒ‘å·`);
            }
        }

        // æµ‹è¯•é‡è¯•åŠŸèƒ½
        function testRetry() {
            log('ğŸ”„ æµ‹è¯•é‡è¯•åŠŸèƒ½');
            
            const selectedCity = JSON.parse(localStorage.getItem('selectedCity') || 'null');
            
            if (selectedCity) {
                log(`ğŸ”„ é‡è¯•æ—¶ä½¿ç”¨åŸå¸‚: ${selectedCity.name}`);
                log(`ğŸ“ é‡è¯•åæ ‡: ${selectedCity.coordinates.longitude}, ${selectedCity.coordinates.latitude}`);
                log(`âœ… é‡è¯•åŠŸèƒ½æ­£å¸¸ï¼šä¿æŒæ­£ç¡®çš„åŸå¸‚ä¿¡æ¯`);
            } else {
                log(`âŒ é‡è¯•åŠŸèƒ½å¼‚å¸¸ï¼šç¼ºå°‘åŸå¸‚ä¿¡æ¯`);
            }
        }

        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨
        function checkLocalStorage() {
            log('ğŸ” æ£€æŸ¥æœ¬åœ°å­˜å‚¨æ•°æ®');
            
            const selectedCity = localStorage.getItem('selectedCity');
            
            if (selectedCity) {
                try {
                    const cityData = JSON.parse(selectedCity);
                    log(`âœ… æœ¬åœ°å­˜å‚¨æ•°æ®æ­£å¸¸:`);
                    log(`   åŸå¸‚åç§°: ${cityData.name}`);
                    log(`   ç»åº¦: ${cityData.coordinates.longitude}`);
                    log(`   çº¬åº¦: ${cityData.coordinates.latitude}`);
                } catch (e) {
                    log(`âŒ æœ¬åœ°å­˜å‚¨æ•°æ®æ ¼å¼é”™è¯¯: ${e.message}`);
                }
            } else {
                log(`âš ï¸ æœ¬åœ°å­˜å‚¨ä¸­æ²¡æœ‰åŸå¸‚æ•°æ®`);
            }
        }

        // æ¸…é™¤æµ‹è¯•æ•°æ®
        function clearTestData() {
            localStorage.removeItem('selectedCity');
            testLog = [];
            document.getElementById('testResults').innerHTML = 'æµ‹è¯•æ•°æ®å·²æ¸…é™¤';
            log('ğŸ§¹ æµ‹è¯•æ•°æ®å·²æ¸…é™¤');
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('ğŸš€ åŸå¸‚åŒæ­¥æµ‹è¯•é¡µé¢å·²åŠ è½½');
            log('ğŸ’¡ è¯·æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•ï¼š1.é€‰æ‹©åŸå¸‚ â†’ 2.æµ‹è¯•è·³è½¬ â†’ 3.æ£€æŸ¥æ•°æ®');
        };
    </script>
</body>
</html>