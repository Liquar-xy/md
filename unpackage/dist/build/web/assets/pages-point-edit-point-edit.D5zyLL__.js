import{r as t,g as a,a as e,m as o,q as s,v as i,y as n,p as l,e as c,w as d,i as p,o as f,f as u,j as h,t as r,n as m,C as I,D as _,F as b,k as g,u as v,l as k,x as T}from"./index-BgeTyoVd.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=C({data:()=>({pointId:null,pointName:"",pointInfo:{name:"",address:"",pointType:"",availableLarge:0,availableMedium:0,availableSmall:0,openTime:"",staus:1,pointImage:"",photos:[]},isSaving:!1}),onLoad(t){this.pointId=t.id||"new",this.pointName=decodeURIComponent(t.name||""),"new"===this.pointId?(console.log("新增网点模式"),this.pointInfo={name:"",address:"",pointType:"",availableLarge:0,availableMedium:0,availableSmall:0,openTime:"",staus:1,pointImage:"",photos:[]}):(console.log("修改网点模式，ID:",this.pointId),this.getPointInfo())},methods:{getPointInfo(){console.log("正在获取网点信息，ID:",this.pointId),t({url:"http://localhost:8000/point_info",method:"POST",data:{id:this.pointId},header:{"Content-Type":"application/json",Authorization:"Bearer "+a("adminToken")},success:t=>{var a;console.log("网点信息接口返回数据:",t),!t.data||200!==t.data.code&&"200"!==t.data.code?(console.error("接口返回错误:",t.data),e({title:(null==(a=t.data)?void 0:a.msg)||"获取网点信息失败",icon:"none"})):(this.pointInfo={name:t.data.name||t.data.Name||"",address:t.data.address||t.data.Address||"",pointType:t.data.pointType||t.data.PointType||"",availableLarge:parseInt(t.data.availableLarge||t.data.AvailableLarge)||0,availableMedium:parseInt(t.data.availableMedium||t.data.AvailableMedium)||0,availableSmall:parseInt(t.data.availableSmall||t.data.AvailableSmall)||0,openTime:t.data.openTime||t.data.OpenTime||"",staus:parseInt(t.data.staus||t.data.Status)||1,pointImage:t.data.pointImage||t.data.PointImage||"",photos:t.data.photos||t.data.Photos||[]},console.log("处理后的网点信息:",this.pointInfo),e({title:"数据加载成功",icon:"success",duration:1e3}))},fail:t=>{console.error("网点信息请求失败:",t),e({title:"网络请求失败",icon:"none"})}})},getCabinetInfo(){const{availableLarge:t,availableMedium:a,availableSmall:e}=this.pointInfo;return`${t}组${a}主机${e}柜门`},editField(t){console.log("点击编辑字段:",t);const a={name:"网点名称",address:"网点地址",pointType:"网点类型",cabinet:"管理柜组",openTime:"营业时间",status:"网点状态"}[t]||t;if("cabinet"!==t)if("status"!==t){switch(t){case"name":this.pointInfo.name;break;case"address":this.pointInfo.address;break;case"pointType":this.pointInfo.pointType;break;case"openTime":this.pointInfo.openTime}o({title:`编辑${a}`,content:"",editable:!0,placeholderText:`请输入${a}`,success:a=>{if(a.confirm){const o=a.content.trim();if(o){switch(t){case"name":this.pointInfo.name=o;break;case"address":this.pointInfo.address=o;break;case"pointType":this.pointInfo.pointType=o;break;case"openTime":this.pointInfo.openTime=o}e({title:"修改成功",icon:"success"})}}}})}else this.editStatus();else this.editCabinet()},editCabinet(){console.log("编辑柜组信息被调用"),o({title:"编辑柜组信息",content:"",editable:!0,placeholderText:"请输入：组数,主机数,柜门数（例如：10,15,20）",success:t=>{console.log("输入结果:",t),t.confirm&&t.content&&this.processCabinetInput(t.content)}})},processCabinetInput(t){console.log("用户输入:",t);const a=t.split(/[,，\s]+/).map((t=>parseInt(t.trim())||0));console.log("解析结果:",a),3===a.length?(this.pointInfo.availableLarge=a[0],this.pointInfo.availableMedium=a[1],this.pointInfo.availableSmall=a[2],console.log("更新后的柜组数据:",this.pointInfo.availableLarge,this.pointInfo.availableMedium,this.pointInfo.availableSmall),e({title:`已设置为：${a[0]}组${a[1]}主机${a[2]}柜门`,icon:"success",duration:2e3})):e({title:"格式错误，请输入三个数字，用逗号分隔",icon:"none",duration:3e3})},editStatus(){const t=[{text:"正常",value:1},{text:"暂停营业",value:0}];s({itemList:t.map((t=>t.text)),success:a=>{const o=t[a.tapIndex];this.pointInfo.staus=o.value,e({title:`状态已设置为${o.text}`,icon:"success"})}})},viewChargingRules(){i({url:`/pages/price-rule/price-rule?id=${this.pointId}&name=${encodeURIComponent(this.pointInfo.name||this.pointName)}`})},uploadPhoto(){n({count:1,success:t=>{const a=t.tempFilePaths[0];this.pointInfo.pointImage=a,this.pointInfo.photos.includes(a)||this.pointInfo.photos.unshift(a),e({title:"照片上传成功",icon:"success"})}})},addPhoto(){n({count:1,success:t=>{const a=t.tempFilePaths[0];this.pointInfo.photos.push(a),e({title:"照片添加成功",icon:"success"})}})},removePhoto(t){const a=this.pointInfo.photos[t];this.pointInfo.pointImage===a&&(this.pointInfo.pointImage=""),this.pointInfo.photos.splice(t,1),e({title:"照片删除成功",icon:"success"})},setMainPhoto(t){this.pointInfo.pointImage=t,e({title:"已设置为主照片",icon:"success"})},savePoint(){this.pointInfo.name&&""!==this.pointInfo.name.trim()?this.pointInfo.address&&""!==this.pointInfo.address.trim()?this.pointInfo.pointType&&""!==this.pointInfo.pointType.trim()?(this.isSaving=!0,console.log("保存网点信息:",{name:this.pointInfo.name,address:this.pointInfo.address,pointType:this.pointInfo.pointType,availableLarge:this.pointInfo.availableLarge,availableMedium:this.pointInfo.availableMedium,availableSmall:this.pointInfo.availableSmall,openTime:this.pointInfo.openTime,status:this.pointInfo.staus,pointImage:this.pointInfo.pointImage,photos:this.pointInfo.photos}),setTimeout((()=>{this.isSaving=!1;const t=this.pointId&&"new"!==this.pointId;e({title:t?"修改成功":"新增成功",icon:"success",duration:3e3}),console.log("保存完成，停留在当前页面")}),500)):e({title:"请输入网点类型",icon:"none"}):e({title:"请输入网点地址",icon:"none"}):e({title:"请输入网点名称",icon:"none"})},goBack(){l()}}},[["render",function(t,a,e,o,s,i){const n=g,l=p,C=v,y=k;return f(),c(l,{class:"point-edit"},{default:d((()=>[u(l,{class:"header"},{default:d((()=>[u(l,{class:"back-btn",onClick:i.goBack},{default:d((()=>[u(n,{class:"back-icon"},{default:d((()=>[h("←")])),_:1})])),_:1},8,["onClick"]),u(l,{class:"title"},{default:d((()=>[h(r("new"===s.pointId?"新增网点":"编辑网点"),1)])),_:1}),u(l,{class:"header-right"},{default:d((()=>[u(n,{class:"menu-icon"},{default:d((()=>[h("⋯")])),_:1}),u(n,{class:"target-icon"},{default:d((()=>[h("◎")])),_:1})])),_:1})])),_:1}),u(l,{class:"photo-section"},{default:d((()=>[u(l,{class:"photo-placeholder",onClick:i.uploadPhoto},{default:d((()=>[s.pointInfo.pointImage?(f(),c(C,{key:0,src:s.pointInfo.pointImage,mode:"aspectFill",class:"main-photo"},null,8,["src"])):(f(),c(l,{key:1,class:"photo-upload"},{default:d((()=>[u(n,{class:"photo-icon"},{default:d((()=>[h("📷")])),_:1}),u(n,{class:"photo-text"},{default:d((()=>[h("网点照片")])),_:1})])),_:1}))])),_:1},8,["onClick"])])),_:1}),u(l,{class:"info-section"},{default:d((()=>[u(l,{class:"section-header"},{default:d((()=>[u(n,{class:"section-title"},{default:d((()=>[h("网点信息")])),_:1}),u(n,{class:"section-tip"},{default:d((()=>[h("点击各项可编辑")])),_:1})])),_:1}),u(l,{class:"info-item",onClick:a[0]||(a[0]=t=>i.editField("name"))},{default:d((()=>[u(n,{class:"info-label"},{default:d((()=>[h("网点名称")])),_:1}),u(n,{class:"info-value"},{default:d((()=>[h(r(s.pointInfo.name||"未设置"),1)])),_:1}),u(n,{class:"arrow"},{default:d((()=>[h(">")])),_:1})])),_:1}),u(l,{class:"info-item",onClick:a[1]||(a[1]=t=>i.editField("address"))},{default:d((()=>[u(n,{class:"info-label"},{default:d((()=>[h("网点地址")])),_:1}),u(l,{class:"address-container"},{default:d((()=>[u(n,{class:"location-icon"},{default:d((()=>[h("📍")])),_:1}),u(n,{class:"info-value"},{default:d((()=>[h(r(s.pointInfo.address||"未设置"),1)])),_:1})])),_:1}),u(n,{class:"arrow"},{default:d((()=>[h(">")])),_:1})])),_:1}),u(l,{class:"info-item",onClick:a[2]||(a[2]=t=>i.editField("pointType"))},{default:d((()=>[u(n,{class:"info-label"},{default:d((()=>[h("网点类型")])),_:1}),u(n,{class:"info-value"},{default:d((()=>[h(r(s.pointInfo.pointType||"未设置"),1)])),_:1}),u(n,{class:"arrow"},{default:d((()=>[h(">")])),_:1})])),_:1}),u(l,{class:"info-item",onClick:a[3]||(a[3]=t=>i.editField("cabinet"))},{default:d((()=>[u(n,{class:"info-label"},{default:d((()=>[h("管理柜组")])),_:1}),u(n,{class:"info-value"},{default:d((()=>[h(r(i.getCabinetInfo()),1)])),_:1}),u(n,{class:"arrow"},{default:d((()=>[h(">")])),_:1})])),_:1}),u(l,{class:"info-item",onClick:a[4]||(a[4]=t=>i.editField("openTime"))},{default:d((()=>[u(n,{class:"info-label"},{default:d((()=>[h("营业时间")])),_:1}),u(n,{class:"info-value"},{default:d((()=>[h(r(s.pointInfo.openTime||"未设置"),1)])),_:1}),u(n,{class:"arrow"},{default:d((()=>[h(">")])),_:1})])),_:1}),u(l,{class:"info-item",onClick:a[5]||(a[5]=t=>i.editField("status"))},{default:d((()=>[u(n,{class:"info-label"},{default:d((()=>[h("网点状态")])),_:1}),u(n,{class:m(["info-value",1==s.pointInfo.staus?"status-normal":"status-closed"])},{default:d((()=>[h(r(1==s.pointInfo.staus?"正常":"暂停营业"),1)])),_:1},8,["class"]),u(n,{class:"arrow"},{default:d((()=>[h(">")])),_:1})])),_:1}),u(l,{class:"info-item",onClick:i.viewChargingRules},{default:d((()=>[u(n,{class:"info-label"},{default:d((()=>[h("收费规则")])),_:1}),u(n,{class:"info-value"},{default:d((()=>[h("查看")])),_:1}),u(n,{class:"arrow"},{default:d((()=>[h(">")])),_:1})])),_:1},8,["onClick"])])),_:1}),u(l,{class:"photo-list-section"},{default:d((()=>[u(n,{class:"section-title"},{default:d((()=>[h("网点照片")])),_:1}),u(l,{class:"photo-list"},{default:d((()=>[(f(!0),I(b,null,_(s.pointInfo.photos,((t,a)=>(f(),c(l,{key:a,class:"photo-item"},{default:d((()=>[u(C,{src:t,mode:"aspectFill",class:"list-photo",onClick:a=>i.setMainPhoto(t)},null,8,["src","onClick"]),u(n,{class:"remove-btn",onClick:t=>i.removePhoto(a)},{default:d((()=>[h("×")])),_:2},1032,["onClick"]),s.pointInfo.pointImage===t?(f(),c(n,{key:0,class:"main-photo-label"},{default:d((()=>[h("主图")])),_:1})):T("",!0)])),_:2},1024)))),128)),u(l,{class:"add-photo",onClick:i.addPhoto},{default:d((()=>[u(n,{class:"add-icon"},{default:d((()=>[h("+")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),u(l,{class:"save-section"},{default:d((()=>[u(y,{class:"save-btn",onClick:i.savePoint,disabled:s.isSaving},{default:d((()=>[h(r(s.isSaving?"保存中...":"new"===s.pointId?"新增":"保存"),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-dee68ce4"]]);export{y as default};
