import{g as s,v as t,a as e,r as a,e as r,w as o,i,o as l,f as c,j as n,t as u,x as h,C as d,D as y,F as g,k as m,I as f,l as _,n as p}from"./index-BgeTyoVd.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=S({data:()=>({currentCity:"郑州",searchKeyword:"",searchResults:[],isSearching:!1,autoFocus:!0,searchStatus:"",searchTimer:null,attractions:["美景天城","大卫城","国贸360","万特","少林寺","银基动物王国"],stations:["郑州站","郑州东站","新郑国际机场"],subwayStations:["二七广场","陇海路地铁站","航海广场站","陇海路地铁站","航海广场站"],businessAreas:["熙地港购物中心","二七广场","正弘城","二七广场","正弘城"],cityCategories:{"郑州":{attractions:["美景天城","大卫城","国贸360","万特","少林寺","银基动物王国"],stations:["郑州站","郑州东站","新郑国际机场"],subwayStations:["二七广场","陇海路地铁站","航海广场站","紫荆山站","人民路站"],businessAreas:["熙地港购物中心","二七广场","正弘城","万达广场","国贸360"]},"北京":{attractions:["天安门","故宫","颐和园","天坛","长城","鸟巢"],stations:["北京站","北京西站","北京南站","首都国际机场","大兴国际机场"],subwayStations:["天安门东","王府井","西单","国贸","三里屯"],businessAreas:["王府井","西单","国贸","三里屯","中关村"]},"上海":{attractions:["外滩","东方明珠","豫园","城隍庙","朱家角","迪士尼"],stations:["上海站","上海虹桥站","上海南站","浦东国际机场","虹桥机场"],subwayStations:["人民广场","南京路","陆家嘴","徐家汇","静安寺"],businessAreas:["南京路","淮海路","陆家嘴","徐家汇","静安寺"]},"广州":{attractions:["广州塔","陈家祠","沙面","白云山","长隆","珠江夜游"],stations:["广州站","广州南站","广州东站","白云国际机场"],subwayStations:["体育西路","珠江新城","北京路","上下九","天河城"],businessAreas:["天河城","北京路","上下九","珠江新城","万菱汇"]},"深圳":{attractions:["世界之窗","欢乐谷","大梅沙","莲花山","华侨城","东部华侨城"],stations:["深圳站","深圳北站","深圳东站","宝安国际机场"],subwayStations:["罗湖","国贸","华强北","车公庙","世界之窗"],businessAreas:["华强北","东门","海岸城","万象城","益田假日广场"]},"杭州":{attractions:["西湖","灵隐寺","雷峰塔","千岛湖","西溪湿地","宋城"],stations:["杭州站","杭州东站","杭州南站","萧山国际机场"],subwayStations:["西湖文化广场","武林广场","钱江新城","滨江","城站"],businessAreas:["武林广场","湖滨","钱江新城","西溪","滨江"]},"南京":{attractions:["中山陵","夫子庙","玄武湖","总统府","明孝陵","秦淮河"],stations:["南京站","南京南站","禄口国际机场"],subwayStations:["新街口","夫子庙","鼓楼","玄武门","中华门"],businessAreas:["新街口","夫子庙","湖南路","江宁万达","仙林"]},"武汉":{attractions:["黄鹤楼","东湖","武汉大学","户部巷","长江大桥","归元寺"],stations:["武汉站","汉口站","武昌站","天河国际机场"],subwayStations:["江汉路","中南路","光谷广场","街道口","武昌火车站"],businessAreas:["江汉路","中南路","光谷","汉正街","楚河汉街"]},"成都":{attractions:["宽窄巷子","锦里","武侯祠","杜甫草堂","青城山","都江堰"],stations:["成都站","成都东站","双流国际机场","天府国际机场"],subwayStations:["春熙路","天府广场","骡马市","太古里","金沙遗址"],businessAreas:["春熙路","太古里","天府广场","建设路","金沙"]},"西安":{attractions:["兵马俑","大雁塔","钟楼","古城墙","华清池","法门寺"],stations:["西安站","西安北站","咸阳国际机场"],subwayStations:["钟楼","小寨","大雁塔","北大街","纺织城"],businessAreas:["钟楼","小寨","大雁塔","高新区","曲江"]},"沈阳":{attractions:["沈阳故宫","张氏帅府","北陵公园","东陵公园","沈阳植物园","棋盘山"],stations:["沈阳站","沈阳北站","沈阳南站","桃仙国际机场"],subwayStations:["太原街","中街","沈阳站","青年大街","奥体中心"],businessAreas:["太原街","中街","铁西广场","沈北新区","浑南新区"]},"沈阳市":{attractions:["沈阳故宫","张氏帅府","北陵公园","东陵公园","沈阳植物园","棋盘山"],stations:["沈阳站","沈阳北站","沈阳南站","桃仙国际机场"],subwayStations:["太原街","中街","沈阳站","青年大街","奥体中心"],businessAreas:["太原街","中街","铁西广场","沈北新区","浑南新区"]}}}),onLoad(t){console.log("🔍 搜索页面加载成功"),console.log("🔍 页面参数:",t),this.searchStatus="页面加载完成";try{const t=s("selectedCity");t?(this.currentCity=t.name,this.searchStatus=`正在${t.name}为您搜索寄存点`,console.log("✅ 获取到选择的城市:",t.name)):(this.searchStatus=`正在${this.currentCity}为您搜索寄存点`,console.log("⚠️ 未找到选择的城市，使用默认城市:",this.currentCity))}catch(e){console.error("❌ 获取城市信息失败:",e),this.searchStatus="获取城市信息失败"}this.updateCategoryData(),t.keyword?(this.searchKeyword=decodeURIComponent(t.keyword),this.autoFocus=!1,setTimeout((()=>{this.performSearch()}),500)):setTimeout((()=>{this.searchStatus=""}),2e3)},onShow(){try{const t=s("selectedCity");console.log("🔍 搜索页面onShow检查城市:",{"存储中的城市":null==t?void 0:t.name,"当前显示城市":this.currentCity}),t&&t.name!==this.currentCity?(console.log("🏙️ 搜索页面检测到城市变化:",{"从":this.currentCity,"到":t.name}),this.currentCity=t.name,this.updateCategoryData(),this.searchResults=[],this.searchStatus="",this.searchKeyword&&(console.log("🔄 城市变化后重新搜索:",this.searchKeyword),setTimeout((()=>{this.performSearch()}),300))):t&&this.updateCategoryData()}catch(t){console.error("搜索页面onShow处理城市变化时出错:",t)}},methods:{updateCategoryData(){console.log("🔄 更新搜索分类数据，当前城市:",this.currentCity);const s=this.cityCategories[this.currentCity];if(s)this.attractions=[...s.attractions],this.stations=[...s.stations],this.subwayStations=[...s.subwayStations],this.businessAreas=[...s.businessAreas],console.log("✅ 分类数据已更新:",{city:this.currentCity,attractions:this.attractions.length,stations:this.stations.length,subwayStations:this.subwayStations.length,businessAreas:this.businessAreas.length});else{console.log("⚠️ 未找到城市分类数据配置，自动生成");const s=this.generateCityCategories(this.currentCity);this.attractions=[...s.attractions],this.stations=[...s.stations],this.subwayStations=[...s.subwayStations],this.businessAreas=[...s.businessAreas],this.cityCategories[this.currentCity]=s,console.log("✅ 自动生成分类数据完成:",{city:this.currentCity,attractions:this.attractions.length,stations:this.stations.length,subwayStations:this.subwayStations.length,businessAreas:this.businessAreas.length})}},generateCityCategories(s){console.log("🎯 为城市自动生成分类数据:",s);const t=s.replace(/[市省区县]/g,"");return{attractions:[`${t}博物馆`,`${t}公园`,`${t}广场`,`${t}古城`,`${t}风景区`,`${t}文化中心`],stations:[`${t}站`,`${t}东站`,`${t}北站`,`${t}机场`],subwayStations:[`${t}中心站`,`${t}广场站`,`${t}火车站`,`${t}汽车站`,`${t}体育馆站`],businessAreas:[`${t}万达`,`${t}购物中心`,`${t}商业街`,`${t}步行街`]}},selectCity(){t({url:"/pages/city-select/city-select?from=search"})},onSearchInput(s){this.searchKeyword=s.detail.value,this.searchStatus="",clearTimeout(this.searchTimer),this.searchKeyword.trim()?(this.searchStatus=`正在搜索"${this.searchKeyword.trim()}"...`,this.searchTimer=setTimeout((()=>{this.performSearch()}),800)):(this.searchResults=[],this.searchStatus="")},performSearch(){const s=this.searchKeyword.trim();s?(console.log("🔍 执行搜索:",s),this.searchResults=[],this.isSearching=!0,this.searchStatus=`正在搜索"${s}"...`,this.callSearchAPI(s)):e({title:"请输入搜索关键词",icon:"none"})},callSearchAPI(s){console.log("📡 调用后端搜索接口:",s);const t=`http://localhost:8000/api/nearby/city/search?${new URLSearchParams({city_name:this.currentCity,keyword:s,page:"1",page_size:"20"}).toString()}`;console.log("🔍 搜索请求URL:",t),a({url:t,method:"GET",header:{"Content-Type":"application/json",Accept:"application/json"},timeout:1e4,success:t=>{console.log("✅ 搜索接口响应:",t),this.handleSearchSuccess(t.data,s)},fail:t=>{console.log("❌ 搜索接口失败:",t),this.handleSearchError(s,t)},complete:()=>{this.isSearching=!1}})},handleSearchSuccess(s,t){console.log("🔄 处理搜索成功响应:",s);try{let a=[];s&&s.items&&Array.isArray(s.items)?a=s.items:s&&Array.isArray(s)?a=s:s&&s.data&&Array.isArray(s.data)&&(a=s.data),console.log("📊 解析到的结果数量:",a.length),a.length>0?(this.searchResults=a.map(((s,t)=>({id:s.id||t+1,name:s.name||`寄存点${t+1}`,address:s.address||s.location||"地址信息暂无",distance:s.distance?`${s.distance.toFixed(1)}km`:"",large:parseInt(s.large_count||s.large||0),medium:parseInt(s.medium_count||s.medium||0),small:parseInt(s.small_count||s.small||0),price:s.price||"2元/小时起",status:s.status||"available"}))),this.searchStatus=`在${this.currentCity}找到 ${this.searchResults.length} 个"${t}"相关的寄存点`,e({title:`找到${this.searchResults.length}个寄存点`,icon:"success",duration:2e3}),console.log("✅ 搜索结果处理完成:",this.searchResults)):this.handleNoResults(t)}catch(a){console.error("❌ 处理搜索结果时出错:",a),this.handleSearchError(t,a)}},handleSearchError(s,t){console.log("❌ 搜索失败:",t),this.searchResults=[],this.searchStatus="搜索失败，请检查网络连接或稍后重试",e({title:"搜索失败",icon:"error",duration:2e3})},handleNoResults(s){this.searchResults=[],this.searchStatus=`在${this.currentCity}没有找到"${s}"相关的寄存点`,e({title:"未找到相关寄存点",icon:"none",duration:2e3}),setTimeout((()=>{this.searchStatus='试试搜索其他关键词，如"火车站"、"地铁站"、"商场"等'}),2e3)},searchLockers(s){this.searchKeyword=s,this.performSearch()},handleSearchSuccess(s,t){console.log("✅ 真实后端搜索成功"),console.log("原始响应数据:",s);try{let a=[],r=0;s.items&&Array.isArray(s.items)?(a=s.items,r=s.total||s.items.length):s.data&&Array.isArray(s.data)?a=s.data:s.results&&Array.isArray(s.results)?a=s.results:s.lockers&&Array.isArray(s.lockers)?a=s.lockers:s.locker_points&&Array.isArray(s.locker_points)?a=s.locker_points:Array.isArray(s)?a=s:(console.log("⚠️ 未识别的响应数据格式，尝试提取所有可能的数组字段"),Object.keys(s).forEach((t=>{Array.isArray(s[t])&&s[t].length>0&&(console.log(`发现数组字段: ${t}`,s[t]),0===a.length&&(a=s[t]))}))),r=r||s.total||s.total_count||s.count||a.length,console.log("解析后的搜索结果:",{keyword:t,resultsCount:a.length,totalCount:r,firstResult:a[0]||null}),this.searchStatus="",a&&a.length>0?(this.searchResults=this.processSearchResults(a),console.log("✅ 真实数据处理完成:",this.searchResults.length,"个寄存点"),this.searchStatus=`在${this.currentCity}找到 ${this.searchResults.length} 个"${t}"相关的寄存点`,e({title:`找到${this.searchResults.length}个寄存点`,icon:"success",duration:2e3})):(console.log("⚠️ 后端返回空结果"),this.searchResults=[],this.searchStatus=`在${this.currentCity}未找到"${t}"相关的寄存点`,e({title:"未找到相关寄存点",icon:"none",duration:2e3}))}catch(a){console.error("处理搜索结果时出错:",a),this.searchResults=[],this.searchStatus="搜索结果处理失败",e({title:"搜索结果处理失败",icon:"error",duration:2e3})}},processSearchResults(s){return console.log("🔄 处理真实后端搜索结果数据"),console.log("原始结果数据:",s),Array.isArray(s)?s.map(((s,t)=>{console.log(`处理第${t+1}个结果:`,s);try{const e={id:s.id||s.locker_id||s.point_id||`search_${Date.now()}_${t+1}`,name:s.name||s.locker_name||s.point_name||s.location_name||`寄存点${t+1}`,address:s.address||s.location||s.location_address||s.full_address||"地址信息待完善",distance:this.formatDistance(s.distance||s.dist||0),large:parseInt(s.available_large||s.large_count||s.large||s.large_capacity||s.big_count||0),medium:parseInt(s.available_medium||s.medium_count||s.medium||s.medium_capacity||s.mid_count||0),small:parseInt(s.available_small||s.small_count||s.small||s.small_capacity||0),status:this.mapItemStatus(s.status||s.state||s.available),rating:parseFloat(s.rating||s.score||0),price:parseFloat(s.price||s.cost||0),openTime:s.open_time||s.openTime||"24小时",mobile:s.mobile||s.phone||"",rawData:s};return console.log(`处理后的第${t+1}个结果:`,e),e}catch(e){return console.error(`处理第${t+1}个搜索结果时出错:`,e,s),{id:`error_${Date.now()}_${t}`,name:`寄存点${t+1}`,address:"地址信息获取失败",distance:"0km",large:0,medium:0,small:0,status:"available",rating:0,price:0,rawData:s}}})):(console.error("搜索结果不是数组格式:",s),[])},mapItemStatus(s){if("boolean"==typeof s)return s?"available":"unavailable";if("string"==typeof s){const t=s.toLowerCase();if(t.includes("available")||t.includes("open")||"营业中"===t)return"available";if(t.includes("unavailable")||t.includes("closed")||"暂停服务"===t)return"unavailable"}return"available"},formatDistance:s=>"number"==typeof s?s<1?Math.round(1e3*s)+"m":s.toFixed(1)+"km":"string"==typeof s?s:"距离未知",searchLocation(s){console.log("🔍 点击搜索位置:",s),this.searchKeyword=s,this.searchStatus=`正在搜索"${s}"相关的寄存点...`,this.performSearch()},selectSearchResult(s){console.log("选择搜索结果:",s),t({url:`/pages/locker-detail/locker-detail?id=${s.id}&name=${encodeURIComponent(s.name)}&address=${encodeURIComponent(s.address)}`})},testSearch(){console.log("🧪 开始测试搜索功能"),e({title:"测试后端搜索接口",icon:"loading",duration:1e3}),this.searchKeyword="火车站",this.performSearch()}}},[["render",function(s,t,e,a,S,b){const C=m,w=i,$=f,A=_;return l(),r(w,{class:"page"},{default:o((()=>[c(w,{class:"search-section"},{default:o((()=>[c(w,{class:"city-selector",onClick:b.selectCity},{default:o((()=>[c(C,{class:"city-name"},{default:o((()=>[n(u(S.currentCity),1)])),_:1}),c(C,{class:"dropdown-icon"},{default:o((()=>[n("▼")])),_:1})])),_:1},8,["onClick"]),c(w,{class:"search-input-container"},{default:o((()=>[c($,{class:"search-input",placeholder:"搜索位置/地址/景点",modelValue:S.searchKeyword,"onUpdate:modelValue":t[0]||(t[0]=s=>S.searchKeyword=s),onInput:b.onSearchInput,onConfirm:b.performSearch,"confirm-type":"search",focus:S.autoFocus},null,8,["modelValue","onInput","onConfirm","focus"]),c(w,{class:"search-btn",onClick:b.performSearch},{default:o((()=>[c(C,{class:"search-icon"},{default:o((()=>[n("🔍")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),S.searchStatus?(l(),r(w,{key:0,class:"search-status"},{default:o((()=>[c(C,{class:"status-text"},{default:o((()=>[n(u(S.searchStatus),1)])),_:1})])),_:1})):h("",!0),c(w,{class:"content-section"},{default:o((()=>[S.searchResults.length>0?(l(),r(w,{key:0,class:"search-results"},{default:o((()=>[c(w,{class:"results-header"},{default:o((()=>[c(C,{class:"results-title"},{default:o((()=>[n("🏪 找到 "+u(S.searchResults.length)+" 个寄存点",1)])),_:1}),c(C,{class:"results-subtitle"},{default:o((()=>[n("点击查看详情")])),_:1})])),_:1}),(l(!0),d(g,null,y(S.searchResults,((s,t)=>(l(),r(w,{class:"result-item",key:t,onClick:t=>b.selectSearchResult(s)},{default:o((()=>[c(w,{class:"result-left"},{default:o((()=>[c(w,{class:"result-icon"},{default:o((()=>[n("🏪")])),_:1}),c(w,{class:"result-info"},{default:o((()=>[c(C,{class:"result-name"},{default:o((()=>[n(u(s.name),1)])),_:2},1024),c(C,{class:"result-address"},{default:o((()=>[n("📍 "+u(s.address),1)])),_:2},1024),c(w,{class:"result-capacity"},{default:o((()=>[c(C,{class:"capacity-item"},{default:o((()=>[n("大"+u(s.large||0),1)])),_:2},1024),c(C,{class:"capacity-item"},{default:o((()=>[n("中"+u(s.medium||0),1)])),_:2},1024),c(C,{class:"capacity-item"},{default:o((()=>[n("小"+u(s.small||0),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),c(w,{class:"result-right"},{default:o((()=>[s.distance?(l(),r(C,{key:0,class:"result-distance"},{default:o((()=>[n(u(s.distance),1)])),_:2},1024)):h("",!0),c(w,{class:p(["result-status",s.status||"available"])},{default:o((()=>[c(C,{class:"status-text"},{default:o((()=>[n(u("available"!==s.status&&s.status?"暂停服务":"营业中"),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(l(),r(w,{key:1,class:"category-list"},{default:o((()=>[c(w,{class:"category-intro"},{default:o((()=>[c(C,{class:"intro-title"},{default:o((()=>[n("🔍 快速搜索")])),_:1}),c(C,{class:"intro-desc"},{default:o((()=>[n("点击下方分类快速查找"+u(S.currentCity)+"的寄存点",1)])),_:1}),c(w,{class:"debug-section",style:{"margin-top":"20rpx","text-align":"center"}},{default:o((()=>[c(A,{class:"debug-btn",onClick:b.testSearch,style:{background:"#007AFF",color:"white",border:"none",padding:"10rpx 20rpx","border-radius":"10rpx","font-size":"24rpx"}},{default:o((()=>[n(" 测试搜索功能 ")])),_:1},8,["onClick"])])),_:1})])),_:1}),c(w,{class:"category-section"},{default:o((()=>[c(w,{class:"category-header"},{default:o((()=>[c(w,{class:"category-badge attractions"},{default:o((()=>[n("1")])),_:1}),c(C,{class:"category-title"},{default:o((()=>[n("景点")])),_:1}),c(C,{class:"category-count"},{default:o((()=>[n(u(S.attractions.length)+"个",1)])),_:1})])),_:1}),c(w,{class:"category-items"},{default:o((()=>[(l(!0),d(g,null,y(S.attractions,((s,t)=>(l(),r(w,{class:"category-item",key:t,onClick:t=>b.searchLocation(s)},{default:o((()=>[c(C,{class:"item-icon"},{default:o((()=>[n("🎡")])),_:1}),c(C,{class:"item-text"},{default:o((()=>[n(u(s),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),c(w,{class:"category-section"},{default:o((()=>[c(w,{class:"category-header"},{default:o((()=>[c(w,{class:"category-badge stations"},{default:o((()=>[n("🚂")])),_:1}),c(C,{class:"category-title"},{default:o((()=>[n("机场车站")])),_:1}),c(C,{class:"category-count"},{default:o((()=>[n(u(S.stations.length)+"个",1)])),_:1})])),_:1}),c(w,{class:"category-items"},{default:o((()=>[(l(!0),d(g,null,y(S.stations,((s,t)=>(l(),r(w,{class:"category-item",key:t,onClick:t=>b.searchLocation(s)},{default:o((()=>[c(C,{class:"item-icon"},{default:o((()=>[n("🚂")])),_:1}),c(C,{class:"item-text"},{default:o((()=>[n(u(s),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),c(w,{class:"category-section"},{default:o((()=>[c(w,{class:"category-header"},{default:o((()=>[c(w,{class:"category-badge subway"},{default:o((()=>[n("🚇")])),_:1}),c(C,{class:"category-title"},{default:o((()=>[n("地铁站")])),_:1}),c(C,{class:"category-count"},{default:o((()=>[n(u(S.subwayStations.length)+"个",1)])),_:1})])),_:1}),c(w,{class:"category-items"},{default:o((()=>[(l(!0),d(g,null,y(S.subwayStations,((s,t)=>(l(),r(w,{class:"category-item",key:t,onClick:t=>b.searchLocation(s)},{default:o((()=>[c(C,{class:"item-icon"},{default:o((()=>[n("🚇")])),_:1}),c(C,{class:"item-text"},{default:o((()=>[n(u(s),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),c(w,{class:"category-section"},{default:o((()=>[c(w,{class:"category-header"},{default:o((()=>[c(w,{class:"category-badge business"},{default:o((()=>[n("🏢")])),_:1}),c(C,{class:"category-title"},{default:o((()=>[n("商圈")])),_:1}),c(C,{class:"category-count"},{default:o((()=>[n(u(S.businessAreas.length)+"个",1)])),_:1})])),_:1}),c(w,{class:"category-items"},{default:o((()=>[(l(!0),d(g,null,y(S.businessAreas,((s,t)=>(l(),r(w,{class:"category-item",key:t,onClick:t=>b.searchLocation(s)},{default:o((()=>[c(C,{class:"item-icon"},{default:o((()=>[n("🏢")])),_:1}),c(C,{class:"item-text"},{default:o((()=>[n(u(s),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1}))])),_:1}),S.isSearching?(l(),r(w,{key:1,class:"loading-overlay"},{default:o((()=>[c(w,{class:"loading-content"},{default:o((()=>[c(w,{class:"loading-spinner"}),c(C,{class:"loading-text"},{default:o((()=>[n("正在搜索...")])),_:1})])),_:1})])),_:1})):h("",!0)])),_:1})}],["__scopeId","data-v-43aed8cc"]]);export{b as default};
