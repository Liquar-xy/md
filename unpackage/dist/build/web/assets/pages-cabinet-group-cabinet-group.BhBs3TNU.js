import{g as t,J as o,p as e,r as a,m as s,v as n,a as l,b as c,h as i,e as r,w as u,i as d,o as g,f,j as h,t as _,n as p,x as m,C,D as k,F as L,L as b,k as T,l as w,S as M}from"./index-BAOqw0gZ.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=y({data:()=>({currentLocation:"éƒ‘å·æ–°é€”å¾„",currentLocationId:1,groupList:[],currentPage:1,pageSize:10,hasMore:!0,loading:!1,showMenuModal:!1,showConnectionStatus:!1,connectionStatusText:"",connectionStatusClass:"",apiBaseUrl:"http://localhost:8000"}),onLoad(){console.log("=== æŸœç»„ç®¡ç†é¡µé¢åŠ è½½ ==="),this.initLocationInfo(),console.log("å½“å‰å¯„å­˜ç‚¹ID:",this.currentLocationId),console.log("APIåŸºç¡€URL:",this.apiBaseUrl);const o=t("token")||t("adminToken");console.log("ç™»å½•çŠ¶æ€:",o?"å·²ç™»å½•":"æœªç™»å½•"),this.loadGroupList()},onShow(){console.log("=== æŸœç»„ç®¡ç†é¡µé¢æ˜¾ç¤º ===");const e=t("selectedLocationId"),a=t("selectedLocationName");if(e&&e!==this.currentLocationId)console.log("å¯„å­˜ç‚¹å·²å˜æ›´ï¼Œé‡æ–°åŠ è½½æ•°æ®"),this.currentLocationId=parseInt(e),this.currentLocation=a||"æœªçŸ¥å¯„å­˜ç‚¹",this.refreshData();else{t("shouldRefreshGroupList")&&(console.log("ä»æ·»åŠ é¡µé¢è¿”å›ï¼Œåˆ·æ–°æŸœç»„åˆ—è¡¨"),o("shouldRefreshGroupList"),this.refreshData())}},methods:{goBack(){e()},showMenu(){this.showMenuModal=!0},hideMenu(){this.showMenuModal=!1},refreshData(){console.log("ğŸ”„ åˆ·æ–°æŸœç»„æ•°æ®"),this.currentPage=1,this.hasMore=!0,this.groupList=[],this.loadGroupList()},async testBackendConnection(){console.log("ğŸ” æµ‹è¯•åç«¯è¿æ¥");try{const t=await new Promise(((t,o)=>{a({url:`${this.apiBaseUrl}/v1/group/list`,method:"POST",header:{"Content-Type":"application/json"},data:{page:1,size:1,location_point_id:1},timeout:5e3,success:t,fail:o})}));return console.log("âœ… åç«¯è¿æ¥æµ‹è¯•æˆåŠŸ:",t),!0}catch(t){return console.error("âŒ åç«¯è¿æ¥æµ‹è¯•å¤±è´¥:",t),!1}},initLocationInfo(){const o=t("selectedLocationId"),e=t("selectedLocationName");o&&e?(this.currentLocationId=parseInt(o),this.currentLocation=e,console.log("ä»æœ¬åœ°å­˜å‚¨åŠ è½½å¯„å­˜ç‚¹:",this.currentLocation,this.currentLocationId)):(this.currentLocationId=null,this.currentLocation="è¯·é€‰æ‹©å¯„å­˜ç‚¹",console.log("æœªé€‰æ‹©å¯„å­˜ç‚¹ï¼Œéœ€è¦ç”¨æˆ·é€‰æ‹©"),setTimeout((()=>{s({title:"æç¤º",content:"è¯·å…ˆé€‰æ‹©è¦ç®¡ç†çš„å¯„å­˜ç‚¹",showCancel:!1,success:()=>{this.selectLocation()}})}),500))},selectLocation(){console.log("è·³è½¬åˆ°å¯„å­˜ç‚¹é€‰æ‹©é¡µé¢"),n({url:"/pages/location-select/location-select?from=cabinet-group"})},async loadGroupList(){if(!this.loading&&this.hasMore)if(this.currentLocationId){this.loading=!0;try{const t=await this.requestGroupList();if(console.log("=== å¤„ç†å“åº”æ•°æ® ==="),console.log("å“åº”å¯¹è±¡:",t),console.log("å“åº”code:",t.code),console.log("å“åº”groups:",t.groups),200!==t.code&&"200"!==t.code)throw new Error(t.msg||`æœåŠ¡å™¨è¿”å›é”™è¯¯: ${t.code}`);{const o=t.groups||[];console.log("è·å–åˆ°çš„æŸœç»„æ•°æ®:",o),console.log("æŸœç»„æ•°é‡:",o.length),1===this.currentPage?this.groupList=o:this.groupList=[...this.groupList,...o],this.hasMore=o.length===this.pageSize,console.log(`âœ… åŠ è½½æŸœç»„åˆ—è¡¨æˆåŠŸï¼Œå½“å‰é¡µï¼š${this.currentPage}ï¼Œæ•°æ®é‡ï¼š${o.length}`),1===this.currentPage&&(this.showConnectionStatus=!0,this.connectionStatusText=`âœ… åç«¯è¿æ¥æ­£å¸¸ï¼Œå…±åŠ è½½${o.length}ä¸ªæŸœç»„`,this.connectionStatusClass="success",setTimeout((()=>{this.showConnectionStatus=!1}),3e3),l({title:`åŠ è½½æˆåŠŸï¼Œå…±${o.length}ä¸ªæŸœç»„`,icon:"success",duration:1500}))}}catch(t){console.error("âŒ åŠ è½½æŸœç»„åˆ—è¡¨å¤±è´¥:",t),this.showConnectionStatus=!0,this.connectionStatusText=`è¿æ¥å¤±è´¥: ${t.message}`,this.connectionStatusClass="error",l({title:t.message||"åŠ è½½å¤±è´¥",icon:"none",duration:2e3}),1===this.currentPage&&(console.log("âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºé™çº§æ–¹æ¡ˆ"),this.loadMockData(),this.connectionStatusText="åç«¯è¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®",this.connectionStatusClass="warning")}finally{this.loading=!1}}else console.log("æœªé€‰æ‹©å¯„å­˜ç‚¹ï¼Œæ— æ³•åŠ è½½æŸœç»„æ•°æ®")},requestGroupList(){return new Promise(((o,e)=>{console.log("=== å¼€å§‹è¯·æ±‚æŸœç»„åˆ—è¡¨ ===");const s=t("token")||t("adminToken")||"",n={page:String(this.currentPage),size:String(this.pageSize),location_point_id:this.currentLocationId,status:"normal"};console.log("è¯·æ±‚å‚æ•°:",n),console.log("è¯·æ±‚URL:",`${this.apiBaseUrl}/v1/group/list`),console.log("ä½¿ç”¨Token:",s?"å·²è®¾ç½®":"æœªè®¾ç½®"),console.log("Content-Type: application/json"),1===this.currentPage&&c({title:"åŠ è½½æŸœç»„æ•°æ®...",mask:!0}),a({url:`${this.apiBaseUrl}/v1/group/list`,method:"POST",header:{"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:""},data:n,timeout:15e3,success:t=>{var a;console.log("=== æŸœç»„åˆ—è¡¨APIå“åº” ==="),console.log("HTTPçŠ¶æ€ç :",t.statusCode),console.log("å“åº”å¤´:",t.header),console.log("å“åº”æ•°æ®ç±»å‹:",typeof t.data),console.log("å“åº”æ•°æ®:",t.data),1===this.currentPage&&i(),200===t.statusCode?t.data&&"object"==typeof t.data?(console.log("âœ… å“åº”æ•°æ®æ ¼å¼æ­£ç¡®"),o(t.data)):(console.error("âŒ å“åº”æ•°æ®æ ¼å¼é”™è¯¯:",t.data),e(new Error("å“åº”æ•°æ®æ ¼å¼é”™è¯¯"))):(console.error("âŒ HTTPçŠ¶æ€ç é”™è¯¯:",t.statusCode),e(new Error(`HTTP ${t.statusCode}: ${(null==(a=t.data)?void 0:a.msg)||"è¯·æ±‚å¤±è´¥"}`)))},fail:t=>{console.error("=== æŸœç»„åˆ—è¡¨APIè¯·æ±‚å¤±è´¥ ==="),console.error("é”™è¯¯å¯¹è±¡:",t),console.error("é”™è¯¯æ¶ˆæ¯:",t.errMsg),1===this.currentPage&&i();let o="ç½‘ç»œè¯·æ±‚å¤±è´¥";t.errMsg&&(o=t.errMsg.includes("timeout")?"è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":t.errMsg.includes("fail")?"æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨":t.errMsg),e(new Error(o))}})}))},loadMockData(){console.log("ğŸ­ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºé™çº§æ–¹æ¡ˆ");this.groupList=[{id:1,location_point_id:1,group_name:"Aç»„",group_code:"1234567865435",group_type:"standard",status:"normal",total_cells:20,start_no:1,end_no:20,install_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:2,location_point_id:1,group_name:"Bç»„",group_code:"1234567865436",group_type:"standard",status:"normal",total_cells:20,start_no:1,end_no:20,install_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:3,location_point_id:1,group_name:"Cç»„",group_code:"1234567865437",group_type:"refrigerated",status:"normal",total_cells:15,start_no:1,end_no:15,install_time:"2024-01-20T10:00:00Z",create_time:"2024-01-20T10:00:00Z",update_time:"2024-01-20T10:00:00Z"}],this.hasMore=!1,l({title:"ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®",icon:"none",duration:2e3})},loadMore(){this.hasMore&&!this.loading&&(this.currentPage++,this.loadGroupList())},formatGroupNumber(t){const o=t.startNo||t.start_no||1;return`${String(o).padStart(2,"0")}å·æŸœ`},getStatusClass:t=>({normal:"status-normal",abnormal:"status-abnormal",disabled:"status-disabled",damaged:"status-damaged"}[t]||"status-normal"),getStatusText:t=>({normal:"æ­£å¸¸",abnormal:"å¼‚å¸¸",disabled:"ç¦ç”¨",damaged:"æŸå"}[t]||"æœªçŸ¥"),getUsageText(t){const o=t.totalCells||t.total_cells||0,e=Math.floor(Math.random()*o);return`${e}å•/${o-e}é—¨`},getTodayOrders:t=>Math.floor(50*Math.random())+10,manageCabinet(t){console.log("ç®¡ç†æŸœé—¨:",t);const o=t.groupName||t.group_name||"æœªçŸ¥æŸœç»„";n({url:`/pages/cabinet-cell/cabinet-cell?groupId=${t.id}&groupName=${encodeURIComponent(o)}`})},viewOrders(t){console.log("æŸ¥çœ‹æŸœé—¨è®¢å•:",t);const o=t.groupName||t.group_name||"æœªçŸ¥æŸœç»„";n({url:`/pages/group-orders/group-orders?groupId=${t.id}&groupName=${encodeURIComponent(o)}`})},addGroup(){this.navigateToAddGroup()},navigateToAddGroup(){this.hideMenu(),n({url:"/pages/group-add/group-add?from=cabinet-group"})},searchGroup(){this.hideMenu(),n({url:"/pages/group-search/group-search"})},exportData(){this.hideMenu(),l({title:"å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},async testAPI(){console.log("ğŸ” æ‰‹åŠ¨æµ‹è¯•APIè¿æ¥"),c({title:"æµ‹è¯•è¿æ¥...",mask:!0});try{if(await this.testBackendConnection()){const t=await this.requestGroupList();i(),s({title:"æµ‹è¯•ç»“æœ",content:`è¿æ¥æˆåŠŸï¼\nè¿”å›æ•°æ®: ${JSON.stringify(t,null,2)}`,showCancel:!1})}else i(),s({title:"æµ‹è¯•ç»“æœ",content:"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨\n2. ç«¯å£8000æ˜¯å¦æ­£ç¡®\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸",showCancel:!1})}catch(t){i(),s({title:"æµ‹è¯•å¤±è´¥",content:`é”™è¯¯ä¿¡æ¯: ${t.message}`,showCancel:!1})}}}},[["render",function(t,o,e,a,s,n){const l=T,c=d,i=w,y=M;return g(),r(c,{class:"page"},{default:u((()=>[f(c,{class:"navbar"},{default:u((()=>[f(c,{class:"nav-left",onClick:n.goBack},{default:u((()=>[f(c,{class:"back-button"},{default:u((()=>[f(l,{class:"back-icon"},{default:u((()=>[h("â†")])),_:1}),f(l,{class:"back-text"},{default:u((()=>[h("è¿”å›")])),_:1})])),_:1})])),_:1},8,["onClick"]),f(c,{class:"nav-center"},{default:u((()=>[f(l,{class:"nav-title"},{default:u((()=>[h("æŸœç»„ç®¡ç†")])),_:1})])),_:1}),f(c,{class:"nav-right"},{default:u((()=>[f(c,{class:"nav-action",onClick:n.testAPI},{default:u((()=>[f(l,{class:"nav-icon"},{default:u((()=>[h("ğŸ”")])),_:1})])),_:1},8,["onClick"]),f(c,{class:"nav-action",onClick:n.showMenu},{default:u((()=>[f(l,{class:"nav-icon"},{default:u((()=>[h("â‹¯")])),_:1})])),_:1},8,["onClick"]),f(c,{class:"nav-action",onClick:n.refreshData},{default:u((()=>[f(l,{class:"nav-icon"},{default:u((()=>[h("âŸ²")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),f(c,{class:"location-selector",onClick:n.selectLocation},{default:u((()=>[f(c,{class:"location-content"},{default:u((()=>[f(c,{class:"location-icon"},{default:u((()=>[h("ğŸ“")])),_:1}),f(c,{class:"location-info"},{default:u((()=>[f(l,{class:"location-label"},{default:u((()=>[h("å½“å‰å¯„å­˜ç‚¹")])),_:1}),f(l,{class:"location-text"},{default:u((()=>[h(_(s.currentLocation),1)])),_:1})])),_:1})])),_:1}),f(c,{class:"dropdown-arrow"},{default:u((()=>[f(l,{class:"dropdown-icon"},{default:u((()=>[h("â–¼")])),_:1})])),_:1})])),_:1},8,["onClick"]),s.showConnectionStatus?(g(),r(c,{key:0,class:"connection-status"},{default:u((()=>[f(l,{class:p(["status-text",s.connectionStatusClass])},{default:u((()=>[h(_(s.connectionStatusText),1)])),_:1},8,["class"])])),_:1})):m("",!0),f(y,{class:"group-list","scroll-y":"true",onScrolltolower:n.loadMore},{default:u((()=>[(g(!0),C(L,null,k(s.groupList,((t,o)=>(g(),r(c,{class:"group-item",key:t.id},{default:u((()=>[f(c,{class:"group-card"},{default:u((()=>[f(c,{class:"group-header"},{default:u((()=>[f(c,{class:"group-title-section"},{default:u((()=>[f(l,{class:"group-name"},{default:u((()=>[h(_(t.groupName||t.group_name),1)])),_:2},1024),f(c,{class:"group-badge"},{default:u((()=>[f(l,{class:"group-number"},{default:u((()=>[h(_(n.formatGroupNumber(t)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(c,{class:p(["status-indicator",n.getStatusClass(t.status)])},{default:u((()=>[f(l,{class:"status-dot"},{default:u((()=>[h("â—")])),_:1}),f(l,{class:"status-text"},{default:u((()=>[h(_(n.getStatusText(t.status)),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),f(c,{class:"group-info-grid"},{default:u((()=>[f(c,{class:"info-card"},{default:u((()=>[f(l,{class:"info-icon"},{default:u((()=>[h("ğŸ·ï¸")])),_:1}),f(c,{class:"info-content"},{default:u((()=>[f(l,{class:"info-label"},{default:u((()=>[h("æŸœç»„ç¼–å·")])),_:1}),f(l,{class:"info-value"},{default:u((()=>[h(_(t.groupCode||t.group_code),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(c,{class:"info-card"},{default:u((()=>[f(l,{class:"info-icon"},{default:u((()=>[h("ğŸ“Š")])),_:1}),f(c,{class:"info-content"},{default:u((()=>[f(l,{class:"info-label"},{default:u((()=>[h("ä½¿ç”¨çŠ¶æ€")])),_:1}),f(l,{class:"info-value"},{default:u((()=>[h(_(n.getUsageText(t)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(c,{class:"info-card"},{default:u((()=>[f(l,{class:"info-icon"},{default:u((()=>[h("ğŸ”¢")])),_:1}),f(c,{class:"info-content"},{default:u((()=>[f(l,{class:"info-label"},{default:u((()=>[h("ç¼–å·åŒºé—´")])),_:1}),f(l,{class:"info-value"},{default:u((()=>[h(_(t.startNo||t.start_no)+" - "+_(t.endNo||t.end_no),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(c,{class:"info-card"},{default:u((()=>[f(l,{class:"info-icon"},{default:u((()=>[h("ğŸ“‹")])),_:1}),f(c,{class:"info-content"},{default:u((()=>[f(l,{class:"info-label"},{default:u((()=>[h("ä»Šæ—¥è®¢å•")])),_:1}),f(l,{class:"info-value highlight"},{default:u((()=>[h(_(n.getTodayOrders(t))+"å•",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(c,{class:"group-actions"},{default:u((()=>[f(i,{class:"action-btn primary-btn",onClick:o=>n.manageCabinet(t)},{default:u((()=>[f(l,{class:"btn-icon"},{default:u((()=>[h("ğŸ”§")])),_:1}),f(l,{class:"btn-text"},{default:u((()=>[h("ç®¡ç†æŸœé—¨")])),_:1})])),_:2},1032,["onClick"]),f(i,{class:"action-btn secondary-btn",onClick:o=>n.viewOrders(t)},{default:u((()=>[f(l,{class:"btn-icon"},{default:u((()=>[h("ğŸ“Š")])),_:1}),f(l,{class:"btn-text"},{default:u((()=>[h("æŸœé—¨è®¢å•")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),s.hasMore?(g(),r(c,{key:0,class:"load-more"},{default:u((()=>[s.loading?(g(),r(l,{key:1,class:"load-text"},{default:u((()=>[h("åŠ è½½ä¸­...")])),_:1})):(g(),r(l,{key:0,class:"load-text"},{default:u((()=>[h("ä¸Šæ‹‰åŠ è½½æ›´å¤š")])),_:1}))])),_:1})):m("",!0),!s.hasMore&&s.groupList.length>0?(g(),r(c,{key:1,class:"no-more"},{default:u((()=>[f(l,{class:"no-more-text"},{default:u((()=>[h("æ²¡æœ‰æ›´å¤šæ•°æ®äº†")])),_:1})])),_:1})):m("",!0),s.loading||0!==s.groupList.length?m("",!0):(g(),r(c,{key:2,class:"empty-state"},{default:u((()=>[f(l,{class:"empty-icon"},{default:u((()=>[h("ğŸ“¦")])),_:1}),f(l,{class:"empty-text"},{default:u((()=>[h("æš‚æ— æŸœç»„æ•°æ®")])),_:1}),f(i,{class:"refresh-btn",onClick:n.refreshData},{default:u((()=>[h("åˆ·æ–°æ•°æ®")])),_:1},8,["onClick"])])),_:1}))])),_:1},8,["onScrolltolower"]),f(c,{class:"fab",onClick:n.addGroup},{default:u((()=>[f(c,{class:"fab-content"},{default:u((()=>[f(l,{class:"fab-icon"},{default:u((()=>[h("+")])),_:1})])),_:1})])),_:1},8,["onClick"]),s.showMenuModal?(g(),r(c,{key:1,class:"menu-overlay",onClick:n.hideMenu},{default:u((()=>[f(c,{class:"menu-popup",onClick:o[0]||(o[0]=b((()=>{}),["stop"]))},{default:u((()=>[f(c,{class:"menu-item",onClick:n.navigateToAddGroup},{default:u((()=>[f(l,{class:"menu-icon"},{default:u((()=>[h("â•")])),_:1}),f(l,{class:"menu-text"},{default:u((()=>[h("æ·»åŠ æŸœç»„")])),_:1})])),_:1},8,["onClick"]),f(c,{class:"menu-item",onClick:n.searchGroup},{default:u((()=>[f(l,{class:"menu-icon"},{default:u((()=>[h("ğŸ”")])),_:1}),f(l,{class:"menu-text"},{default:u((()=>[h("æœç´¢æŸœç»„")])),_:1})])),_:1},8,["onClick"]),f(c,{class:"menu-item",onClick:n.exportData},{default:u((()=>[f(l,{class:"menu-icon"},{default:u((()=>[h("ğŸ“Š")])),_:1}),f(l,{class:"menu-text"},{default:u((()=>[h("å¯¼å‡ºæ•°æ®")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1},8,["onClick"])):m("",!0)])),_:1})}],["__scopeId","data-v-5edf3435"]]);export{S as default};
