import{p as a,g as t,m as e,a as o,b as l,h as s,c as n,r,e as c,w as i,i as u,o as d,f as m,j as f,t as p,L as g,k as h,I as _,E as D,l as C}from"./index-C_HCjYUn.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=b({data:()=>({fromPage:"",currentLocation:"",currentLocationId:null,formData:{groupName:"",groupCode:"",groupTypeIndex:0,totalCells:"",startNo:"",endNo:"",installDate:""},groupTypeOptions:[{label:"æ ‡å‡†æŸœç»„",value:"standard"},{label:"å†·è—æŸœç»„",value:"refrigerated"},{label:"è¶…å¤§æŸœç»„",value:"oversize"}],apiBaseUrl:"http://localhost:8000"}),computed:{canSubmit(){return this.formData.groupName.trim()&&this.formData.groupCode.trim()&&this.formData.totalCells>0&&this.formData.startNo>0&&this.formData.endNo>0&&this.currentLocationId}},onLoad(a){console.log("æ·»åŠ æŸœç»„é¡µé¢åŠ è½½:",a),this.fromPage=a.from||"cabinet-group",this.initLocationInfo();const t=new Date;this.formData.installDate=t.toISOString().split("T")[0]},methods:{goBack(){console.log("é¡¶éƒ¨è¿”å›žæŒ‰é’®è¢«ç‚¹å‡»"),a()},initLocationInfo(){const o=t("selectedLocationId"),l=t("selectedLocationName");o&&l?(this.currentLocationId=parseInt(o),this.currentLocation=l,console.log("å½“å‰å¯„å­˜ç‚¹:",this.currentLocation,this.currentLocationId)):(this.currentLocationId=null,this.currentLocation="æœªé€‰æ‹©å¯„å­˜ç‚¹",e({title:"æç¤º",content:"è¯·å…ˆé€‰æ‹©è¦ç®¡ç†çš„å¯„å­˜ç‚¹",showCancel:!1,success:()=>{a()}}))},onGroupTypeChange(a){this.formData.groupTypeIndex=a.detail.value},onInstallDateChange(a){this.formData.installDate=a.detail.value},calculateEndNo(){this.formData.totalCells>0&&this.formData.startNo>0?this.formData.endNo=parseInt(this.formData.startNo)+parseInt(this.formData.totalCells)-1:this.formData.endNo=""},resetForm(){this.formData={groupName:"",groupCode:"",groupTypeIndex:0,totalCells:"",startNo:"",endNo:"",installDate:(new Date).toISOString().split("T")[0]},o({title:"è¡¨å•å·²é‡ç½®",icon:"success",duration:1e3})},handleCancelClick(a){console.log("å–æ¶ˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶:",a),a.stopPropagation(),a.preventDefault(),this.cancelAdd()},handleConfirmClick(a){console.log("ç¡®è®¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶:",a),a.stopPropagation(),a.preventDefault(),this.confirmAdd()},cancelAdd(){console.log("å–æ¶ˆæ·»åŠ æŒ‰é’®è¢«ç‚¹å‡»"),e({title:"ç¡®è®¤å–æ¶ˆ",content:"ç¡®å®šè¦å–æ¶ˆæ·»åŠ æŸœç»„å—ï¼Ÿå·²å¡«å†™çš„ä¿¡æ¯å°†ä¸¢å¤±ã€‚",success:t=>{t.confirm?(console.log("ç”¨æˆ·ç¡®è®¤å–æ¶ˆï¼Œè¿”å›žä¸Šä¸€é¡µ"),a()):console.log("ç”¨æˆ·å–æ¶ˆäº†å–æ¶ˆæ“ä½œ")}})},async confirmAdd(){if(console.log("ç¡®è®¤æ·»åŠ æŒ‰é’®è¢«ç‚¹å‡»"),!this.canSubmit)return console.log("è¡¨å•éªŒè¯å¤±è´¥ï¼Œæ— æ³•æäº¤"),void o({title:"è¯·å¡«å†™å®Œæ•´ä¿¡æ¯",icon:"none"});try{l({title:"æ·»åŠ ä¸­...",mask:!0});const t=await this.createGroupAPI();s(),200===t.code?(o({title:"æ·»åŠ æˆåŠŸ",icon:"success",duration:1500}),n("shouldRefreshGroupList",!0),setTimeout((()=>{a()}),1500)):o({title:t.msg||"æ·»åŠ å¤±è´¥",icon:"none",duration:2e3})}catch(t){s(),console.error("æ·»åŠ æŸœç»„å¤±è´¥:",t),o({title:t.message||"æ·»åŠ å¤±è´¥",icon:"none",duration:2e3})}},createGroupAPI(){return new Promise(((a,e)=>{console.log("=== å¼€å§‹åˆ›å»ºæŸœç»„ ===");const o=t("token")||t("adminToken")||"",l={location_point_id:this.currentLocationId,group_name:this.formData.groupName.trim(),group_code:this.formData.groupCode.trim(),group_type:this.groupTypeOptions[this.formData.groupTypeIndex].value,total_cells:parseInt(this.formData.totalCells),start_no:parseInt(this.formData.startNo),end_no:parseInt(this.formData.endNo),install_time:new Date(this.formData.installDate+"T00:00:00Z").toISOString()};console.log("åˆ›å»ºæŸœç»„è¯·æ±‚æ•°æ®:",l),console.log("è¯·æ±‚URL:",`${this.apiBaseUrl}/v1/group/create`),r({url:`${this.apiBaseUrl}/v1/group/create`,method:"POST",header:{"Content-Type":"application/json",Authorization:o?`Bearer ${o}`:""},data:l,timeout:15e3,success:t=>{var o;console.log("=== åˆ›å»ºæŸœç»„APIå“åº” ==="),console.log("HTTPçŠ¶æ€ç :",t.statusCode),console.log("å“åº”æ•°æ®:",t.data),200===t.statusCode?t.data&&"object"==typeof t.data?a(t.data):e(new Error("å“åº”æ•°æ®æ ¼å¼é”™è¯¯")):e(new Error(`HTTP ${t.statusCode}: ${(null==(o=t.data)?void 0:o.msg)||"è¯·æ±‚å¤±è´¥"}`))},fail:a=>{console.error("=== åˆ›å»ºæŸœç»„APIè¯·æ±‚å¤±è´¥ ==="),console.error("é”™è¯¯å¯¹è±¡:",a);let t="ç½‘ç»œè¯·æ±‚å¤±è´¥";a.errMsg&&(t=a.errMsg.includes("timeout")?"è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥":a.errMsg.includes("fail")?"æ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥åŽç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨":a.errMsg),e(new Error(t))}})}))}}},[["render",function(a,t,e,o,l,s){const n=h,r=u,b=_,I=D,k=C;return d(),c(r,{class:"page"},{default:i((()=>[m(r,{class:"navbar"},{default:i((()=>[m(r,{class:"nav-left",onClick:s.goBack},{default:i((()=>[m(r,{class:"back-button"},{default:i((()=>[m(n,{class:"back-icon"},{default:i((()=>[f("â†")])),_:1}),m(n,{class:"back-text"},{default:i((()=>[f("è¿”å›ž")])),_:1})])),_:1})])),_:1},8,["onClick"]),m(r,{class:"nav-center"},{default:i((()=>[m(n,{class:"nav-title"},{default:i((()=>[f("æ·»åŠ æŸœç»„")])),_:1})])),_:1}),m(r,{class:"nav-right"},{default:i((()=>[m(r,{class:"nav-action",onClick:s.resetForm},{default:i((()=>[m(n,{class:"nav-icon"},{default:i((()=>[f("âŸ²")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),m(r,{class:"location-info"},{default:i((()=>[m(r,{class:"location-icon"},{default:i((()=>[f("ðŸ“")])),_:1}),m(r,{class:"location-content"},{default:i((()=>[m(n,{class:"location-label"},{default:i((()=>[f("å½“å‰å¯„å­˜ç‚¹")])),_:1}),m(n,{class:"location-text"},{default:i((()=>[f(p(l.currentLocation),1)])),_:1})])),_:1})])),_:1}),m(r,{class:"form-container"},{default:i((()=>[m(r,{class:"form-section"},{default:i((()=>[m(n,{class:"section-title"},{default:i((()=>[f("åŸºæœ¬ä¿¡æ¯")])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("æŸœç»„åç§°")])),_:1}),m(b,{class:"form-input",modelValue:l.formData.groupName,"onUpdate:modelValue":t[0]||(t[0]=a=>l.formData.groupName=a),placeholder:"è¯·è¾“å…¥æŸœç»„åç§°ï¼ˆå¦‚ï¼šAç»„ã€Bç»„ï¼‰",maxlength:"20"},null,8,["modelValue"])])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("æŸœç»„ç¼–ç ")])),_:1}),m(b,{class:"form-input",modelValue:l.formData.groupCode,"onUpdate:modelValue":t[1]||(t[1]=a=>l.formData.groupCode=a),placeholder:"è¯·è¾“å…¥æŸœç»„ç¼–ç ï¼ˆå¦‚ï¼šGROUP001ï¼‰",maxlength:"32"},null,8,["modelValue"])])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("æŸœç»„ç±»åž‹")])),_:1}),m(I,{value:l.formData.groupTypeIndex,range:l.groupTypeOptions,"range-key":"label",onChange:s.onGroupTypeChange},{default:i((()=>[m(r,{class:"form-picker"},{default:i((()=>[m(n,{class:"picker-text"},{default:i((()=>[f(p(l.groupTypeOptions[l.formData.groupTypeIndex].label),1)])),_:1}),m(n,{class:"picker-arrow"},{default:i((()=>[f("â–¼")])),_:1})])),_:1})])),_:1},8,["value","range","onChange"])])),_:1})])),_:1}),m(r,{class:"form-section"},{default:i((()=>[m(n,{class:"section-title"},{default:i((()=>[f("æ ¼å£é…ç½®")])),_:1}),m(r,{class:"form-row"},{default:i((()=>[m(r,{class:"form-item half"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("æ€»æ ¼å£æ•°")])),_:1}),m(b,{class:"form-input",modelValue:l.formData.totalCells,"onUpdate:modelValue":t[2]||(t[2]=a=>l.formData.totalCells=a),modelModifiers:{number:!0},placeholder:"æ€»æ ¼å£æ•°",type:"number",maxlength:"3",onInput:s.calculateEndNo},null,8,["modelValue","onInput"])])),_:1}),m(r,{class:"form-item half"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("èµ·å§‹ç¼–å·")])),_:1}),m(b,{class:"form-input",modelValue:l.formData.startNo,"onUpdate:modelValue":t[3]||(t[3]=a=>l.formData.startNo=a),modelModifiers:{number:!0},placeholder:"èµ·å§‹ç¼–å·",type:"number",maxlength:"3",onInput:s.calculateEndNo},null,8,["modelValue","onInput"])])),_:1})])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("ç»“æŸç¼–å·")])),_:1}),m(b,{class:"form-input calculated",modelValue:l.formData.endNo,"onUpdate:modelValue":t[4]||(t[4]=a=>l.formData.endNo=a),modelModifiers:{number:!0},placeholder:"ç»“æŸç¼–å·ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰",type:"number",readonly:""},null,8,["modelValue"])])),_:1})])),_:1}),m(r,{class:"form-section"},{default:i((()=>[m(n,{class:"section-title"},{default:i((()=>[f("å®‰è£…ä¿¡æ¯")])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("å®‰è£…æ—¶é—´")])),_:1}),m(I,{mode:"date",value:l.formData.installDate,onChange:s.onInstallDateChange},{default:i((()=>[m(r,{class:"form-picker"},{default:i((()=>[m(n,{class:"picker-text"},{default:i((()=>[f(p(l.formData.installDate||"è¯·é€‰æ‹©å®‰è£…æ—¶é—´"),1)])),_:1}),m(n,{class:"picker-arrow"},{default:i((()=>[f("â–¼")])),_:1})])),_:1})])),_:1},8,["value","onChange"])])),_:1})])),_:1})])),_:1}),m(r,{class:"bottom-actions",onClick:t[5]||(t[5]=g((()=>{}),["stop"]))},{default:i((()=>[m(k,{class:"action-btn cancel-btn",onClick:g(s.handleCancelClick,["stop"]),type:"button"},{default:i((()=>[f("å–æ¶ˆ")])),_:1},8,["onClick"]),m(k,{class:"action-btn confirm-btn",onClick:g(s.handleConfirmClick,["stop"]),disabled:!s.canSubmit,type:"button"},{default:i((()=>[f("ç¡®å®šæ·»åŠ ")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-54a00d47"]]);export{I as default};
