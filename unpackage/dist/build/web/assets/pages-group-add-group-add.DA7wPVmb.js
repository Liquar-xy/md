import{p as a,g as t,m as e,a as o,b as l,h as s,c as n,r,e as c,w as i,i as u,o as d,f as m,j as f,t as p,L as g,k as h,I as _,E as D,l as C}from"./index-C_HCjYUn.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=b({data:()=>({fromPage:"",currentLocation:"",currentLocationId:null,formData:{groupName:"",groupCode:"",groupTypeIndex:0,totalCells:"",startNo:"",endNo:"",installDate:""},groupTypeOptions:[{label:"标准柜组",value:"standard"},{label:"冷藏柜组",value:"refrigerated"},{label:"超大柜组",value:"oversize"}],apiBaseUrl:"http://localhost:8000"}),computed:{canSubmit(){return this.formData.groupName.trim()&&this.formData.groupCode.trim()&&this.formData.totalCells>0&&this.formData.startNo>0&&this.formData.endNo>0&&this.currentLocationId}},onLoad(a){console.log("添加柜组页面加载:",a),this.fromPage=a.from||"cabinet-group",this.initLocationInfo();const t=new Date;this.formData.installDate=t.toISOString().split("T")[0]},methods:{goBack(){console.log("顶部返回按钮被点击"),a()},initLocationInfo(){const o=t("selectedLocationId"),l=t("selectedLocationName");o&&l?(this.currentLocationId=parseInt(o),this.currentLocation=l,console.log("当前寄存点:",this.currentLocation,this.currentLocationId)):(this.currentLocationId=null,this.currentLocation="未选择寄存点",e({title:"提示",content:"请先选择要管理的寄存点",showCancel:!1,success:()=>{a()}}))},onGroupTypeChange(a){this.formData.groupTypeIndex=a.detail.value},onInstallDateChange(a){this.formData.installDate=a.detail.value},calculateEndNo(){this.formData.totalCells>0&&this.formData.startNo>0?this.formData.endNo=parseInt(this.formData.startNo)+parseInt(this.formData.totalCells)-1:this.formData.endNo=""},resetForm(){this.formData={groupName:"",groupCode:"",groupTypeIndex:0,totalCells:"",startNo:"",endNo:"",installDate:(new Date).toISOString().split("T")[0]},o({title:"表单已重置",icon:"success",duration:1e3})},handleCancelClick(a){console.log("取消按钮点击事件:",a),a.stopPropagation(),a.preventDefault(),this.cancelAdd()},handleConfirmClick(a){console.log("确认按钮点击事件:",a),a.stopPropagation(),a.preventDefault(),this.confirmAdd()},cancelAdd(){console.log("取消添加按钮被点击"),e({title:"确认取消",content:"确定要取消添加柜组吗？已填写的信息将丢失。",success:t=>{t.confirm?(console.log("用户确认取消，返回上一页"),a()):console.log("用户取消了取消操作")}})},async confirmAdd(){if(console.log("确认添加按钮被点击"),!this.canSubmit)return console.log("表单验证失败，无法提交"),void o({title:"请填写完整信息",icon:"none"});try{l({title:"添加中...",mask:!0});const t=await this.createGroupAPI();s(),200===t.code?(o({title:"添加成功",icon:"success",duration:1500}),n("shouldRefreshGroupList",!0),setTimeout((()=>{a()}),1500)):o({title:t.msg||"添加失败",icon:"none",duration:2e3})}catch(t){s(),console.error("添加柜组失败:",t),o({title:t.message||"添加失败",icon:"none",duration:2e3})}},createGroupAPI(){return new Promise(((a,e)=>{console.log("=== 开始创建柜组 ===");const o=t("token")||t("adminToken")||"",l={location_point_id:this.currentLocationId,group_name:this.formData.groupName.trim(),group_code:this.formData.groupCode.trim(),group_type:this.groupTypeOptions[this.formData.groupTypeIndex].value,total_cells:parseInt(this.formData.totalCells),start_no:parseInt(this.formData.startNo),end_no:parseInt(this.formData.endNo),install_time:new Date(this.formData.installDate+"T00:00:00Z").toISOString()};console.log("创建柜组请求数据:",l),console.log("请求URL:",`${this.apiBaseUrl}/v1/group/create`),r({url:`${this.apiBaseUrl}/v1/group/create`,method:"POST",header:{"Content-Type":"application/json",Authorization:o?`Bearer ${o}`:""},data:l,timeout:15e3,success:t=>{var o;console.log("=== 创建柜组API响应 ==="),console.log("HTTP状态码:",t.statusCode),console.log("响应数据:",t.data),200===t.statusCode?t.data&&"object"==typeof t.data?a(t.data):e(new Error("响应数据格式错误")):e(new Error(`HTTP ${t.statusCode}: ${(null==(o=t.data)?void 0:o.msg)||"请求失败"}`))},fail:a=>{console.error("=== 创建柜组API请求失败 ==="),console.error("错误对象:",a);let t="网络请求失败";a.errMsg&&(t=a.errMsg.includes("timeout")?"请求超时，请检查网络连接":a.errMsg.includes("fail")?"无法连接到服务器，请检查后端服务是否启动":a.errMsg),e(new Error(t))}})}))}}},[["render",function(a,t,e,o,l,s){const n=h,r=u,b=_,I=D,k=C;return d(),c(r,{class:"page"},{default:i((()=>[m(r,{class:"navbar"},{default:i((()=>[m(r,{class:"nav-left",onClick:s.goBack},{default:i((()=>[m(r,{class:"back-button"},{default:i((()=>[m(n,{class:"back-icon"},{default:i((()=>[f("←")])),_:1}),m(n,{class:"back-text"},{default:i((()=>[f("返回")])),_:1})])),_:1})])),_:1},8,["onClick"]),m(r,{class:"nav-center"},{default:i((()=>[m(n,{class:"nav-title"},{default:i((()=>[f("添加柜组")])),_:1})])),_:1}),m(r,{class:"nav-right"},{default:i((()=>[m(r,{class:"nav-action",onClick:s.resetForm},{default:i((()=>[m(n,{class:"nav-icon"},{default:i((()=>[f("⟲")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),m(r,{class:"location-info"},{default:i((()=>[m(r,{class:"location-icon"},{default:i((()=>[f("📍")])),_:1}),m(r,{class:"location-content"},{default:i((()=>[m(n,{class:"location-label"},{default:i((()=>[f("当前寄存点")])),_:1}),m(n,{class:"location-text"},{default:i((()=>[f(p(l.currentLocation),1)])),_:1})])),_:1})])),_:1}),m(r,{class:"form-container"},{default:i((()=>[m(r,{class:"form-section"},{default:i((()=>[m(n,{class:"section-title"},{default:i((()=>[f("基本信息")])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("柜组名称")])),_:1}),m(b,{class:"form-input",modelValue:l.formData.groupName,"onUpdate:modelValue":t[0]||(t[0]=a=>l.formData.groupName=a),placeholder:"请输入柜组名称（如：A组、B组）",maxlength:"20"},null,8,["modelValue"])])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("柜组编码")])),_:1}),m(b,{class:"form-input",modelValue:l.formData.groupCode,"onUpdate:modelValue":t[1]||(t[1]=a=>l.formData.groupCode=a),placeholder:"请输入柜组编码（如：GROUP001）",maxlength:"32"},null,8,["modelValue"])])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("柜组类型")])),_:1}),m(I,{value:l.formData.groupTypeIndex,range:l.groupTypeOptions,"range-key":"label",onChange:s.onGroupTypeChange},{default:i((()=>[m(r,{class:"form-picker"},{default:i((()=>[m(n,{class:"picker-text"},{default:i((()=>[f(p(l.groupTypeOptions[l.formData.groupTypeIndex].label),1)])),_:1}),m(n,{class:"picker-arrow"},{default:i((()=>[f("▼")])),_:1})])),_:1})])),_:1},8,["value","range","onChange"])])),_:1})])),_:1}),m(r,{class:"form-section"},{default:i((()=>[m(n,{class:"section-title"},{default:i((()=>[f("格口配置")])),_:1}),m(r,{class:"form-row"},{default:i((()=>[m(r,{class:"form-item half"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("总格口数")])),_:1}),m(b,{class:"form-input",modelValue:l.formData.totalCells,"onUpdate:modelValue":t[2]||(t[2]=a=>l.formData.totalCells=a),modelModifiers:{number:!0},placeholder:"总格口数",type:"number",maxlength:"3",onInput:s.calculateEndNo},null,8,["modelValue","onInput"])])),_:1}),m(r,{class:"form-item half"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("起始编号")])),_:1}),m(b,{class:"form-input",modelValue:l.formData.startNo,"onUpdate:modelValue":t[3]||(t[3]=a=>l.formData.startNo=a),modelModifiers:{number:!0},placeholder:"起始编号",type:"number",maxlength:"3",onInput:s.calculateEndNo},null,8,["modelValue","onInput"])])),_:1})])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("结束编号")])),_:1}),m(b,{class:"form-input calculated",modelValue:l.formData.endNo,"onUpdate:modelValue":t[4]||(t[4]=a=>l.formData.endNo=a),modelModifiers:{number:!0},placeholder:"结束编号（自动计算）",type:"number",readonly:""},null,8,["modelValue"])])),_:1})])),_:1}),m(r,{class:"form-section"},{default:i((()=>[m(n,{class:"section-title"},{default:i((()=>[f("安装信息")])),_:1}),m(r,{class:"form-item"},{default:i((()=>[m(n,{class:"form-label"},{default:i((()=>[f("安装时间")])),_:1}),m(I,{mode:"date",value:l.formData.installDate,onChange:s.onInstallDateChange},{default:i((()=>[m(r,{class:"form-picker"},{default:i((()=>[m(n,{class:"picker-text"},{default:i((()=>[f(p(l.formData.installDate||"请选择安装时间"),1)])),_:1}),m(n,{class:"picker-arrow"},{default:i((()=>[f("▼")])),_:1})])),_:1})])),_:1},8,["value","onChange"])])),_:1})])),_:1})])),_:1}),m(r,{class:"bottom-actions",onClick:t[5]||(t[5]=g((()=>{}),["stop"]))},{default:i((()=>[m(k,{class:"action-btn cancel-btn",onClick:g(s.handleCancelClick,["stop"]),type:"button"},{default:i((()=>[f("取消")])),_:1},8,["onClick"]),m(k,{class:"action-btn confirm-btn",onClick:g(s.handleConfirmClick,["stop"]),disabled:!s.canSubmit,type:"button"},{default:i((()=>[f("确定添加")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-54a00d47"]]);export{I as default};
