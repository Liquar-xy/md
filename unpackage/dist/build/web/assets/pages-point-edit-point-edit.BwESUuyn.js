import{r as a,g as t,a as e,m as o,q as i,y as n,v as s,p as l,A as d,e as c,w as p,i as f,o as u,f as r,j as m,t as h,n as I,C as g,D as v,F as _,k as b,u as k,l as T,x as C}from"./index-BAOqw0gZ.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=P({data:()=>({pointId:null,pointName:"",pointInfo:{name:"",address:"",pointType:"",availableLarge:0,availableMedium:0,availableSmall:0,openTime:"",staus:1,pointImage:"",manager:"",photos:[]},isSaving:!1}),onLoad(a){this.pointId=a.id||"new",this.pointName=decodeURIComponent(a.name||""),"new"===this.pointId?(console.log("æ–°å¢ç½‘ç‚¹æ¨¡å¼"),this.pointInfo={name:"",address:"",pointType:"",availableLarge:0,availableMedium:0,availableSmall:0,openTime:"",staus:1,pointImage:"",manager:"",photos:[]}):(console.log("ä¿®æ”¹ç½‘ç‚¹æ¨¡å¼ï¼ŒID:",this.pointId),this.getPointInfo())},methods:{getPointInfo(){console.log("æ­£åœ¨è·å–ç½‘ç‚¹ä¿¡æ¯ï¼ŒID:",this.pointId),a({url:"http://localhost:8000/admin/getPointInfo",method:"POST",data:{Id:this.pointId},header:{"Content-Type":"application/json",Authorization:"Bearer "+t("adminToken")},success:a=>{var t;console.log("ç½‘ç‚¹ä¿¡æ¯æ¥å£è¿”å›æ•°æ®:",a),!a.data||200!==a.data.code&&"200"!==a.data.code?(console.error("æ¥å£è¿”å›é”™è¯¯:",a.data),e({title:(null==(t=a.data)?void 0:t.msg)||"è·å–ç½‘ç‚¹ä¿¡æ¯å¤±è´¥",icon:"none"})):(this.pointInfo={name:a.data.name||a.data.Name||"",address:a.data.address||a.data.Address||"",pointType:a.data.pointType||a.data.PointType||"",availableLarge:parseInt(a.data.availableLarge||a.data.AvailableLarge)||0,availableMedium:parseInt(a.data.availableMedium||a.data.AvailableMedium)||0,availableSmall:parseInt(a.data.availableSmall||a.data.AvailableSmall)||0,openTime:a.data.openTime||a.data.OpenTime||"",staus:parseInt(a.data.staus||a.data.Status)||1,pointImage:a.data.pointImage||a.data.PointImage||"",manager:a.data.manager||a.data.Manager||"",photos:a.data.photos||a.data.Photos||[]},console.log("å¤„ç†åçš„ç½‘ç‚¹ä¿¡æ¯:",this.pointInfo),e({title:"æ•°æ®åŠ è½½æˆåŠŸ",icon:"success",duration:1e3}))},fail:a=>{console.error("ç½‘ç‚¹ä¿¡æ¯è¯·æ±‚å¤±è´¥:",a),e({title:"ç½‘ç»œè¯·æ±‚å¤±è´¥",icon:"none"})}})},getCabinetInfo(){const{availableLarge:a,availableMedium:t,availableSmall:e}=this.pointInfo;return`${a}ç»„${t}ä¸»æœº${e}æŸœé—¨`},editField(a){console.log("ç‚¹å‡»ç¼–è¾‘å­—æ®µ:",a);const t={name:"ç½‘ç‚¹åç§°",address:"ç½‘ç‚¹åœ°å€",pointType:"ç½‘ç‚¹ç±»å‹",cabinet:"ç®¡ç†æŸœç»„",openTime:"è¥ä¸šæ—¶é—´",manager:"ç½‘ç‚¹ç®¡ç†å‘˜",status:"ç½‘ç‚¹çŠ¶æ€"}[a]||a;if("cabinet"!==a)if("status"!==a){switch(a){case"name":this.pointInfo.name;break;case"address":this.pointInfo.address;break;case"pointType":this.pointInfo.pointType;break;case"openTime":this.pointInfo.openTime;break;case"manager":this.pointInfo.manager}o({title:`ç¼–è¾‘${t}`,content:"",editable:!0,placeholderText:`è¯·è¾“å…¥${t}`,success:t=>{if(t.confirm){const o=t.content.trim();if(o){switch(a){case"name":this.pointInfo.name=o;break;case"address":this.pointInfo.address=o;break;case"pointType":this.pointInfo.pointType=o;break;case"openTime":this.pointInfo.openTime=o;break;case"manager":this.pointInfo.manager=o}e({title:"ä¿®æ”¹æˆåŠŸ",icon:"success"})}}}})}else this.editStatus();else this.editCabinet()},editCabinet(){console.log("ç¼–è¾‘æŸœç»„ä¿¡æ¯è¢«è°ƒç”¨"),o({title:"ç¼–è¾‘æŸœç»„ä¿¡æ¯",content:"",editable:!0,placeholderText:"è¯·è¾“å…¥ï¼šç»„æ•°,ä¸»æœºæ•°,æŸœé—¨æ•°ï¼ˆä¾‹å¦‚ï¼š10,15,20ï¼‰",success:a=>{console.log("è¾“å…¥ç»“æœ:",a),a.confirm&&a.content&&this.processCabinetInput(a.content)}})},processCabinetInput(a){console.log("ç”¨æˆ·è¾“å…¥:",a);const t=a.split(/[,ï¼Œ\s]+/).map((a=>parseInt(a.trim())||0));console.log("è§£æç»“æœ:",t),3===t.length?(this.pointInfo.availableLarge=t[0],this.pointInfo.availableMedium=t[1],this.pointInfo.availableSmall=t[2],console.log("æ›´æ–°åçš„æŸœç»„æ•°æ®:",this.pointInfo.availableLarge,this.pointInfo.availableMedium,this.pointInfo.availableSmall),e({title:`å·²è®¾ç½®ä¸ºï¼š${t[0]}ç»„${t[1]}ä¸»æœº${t[2]}æŸœé—¨`,icon:"success",duration:2e3})):e({title:"æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥ä¸‰ä¸ªæ•°å­—ï¼Œç”¨é€—å·åˆ†éš”",icon:"none",duration:3e3})},editStatus(){const a=[{text:"æ­£å¸¸",value:1},{text:"æš‚åœè¥ä¸š",value:0}];i({itemList:a.map((a=>a.text)),success:t=>{const o=a[t.tapIndex];this.pointInfo.staus=o.value,e({title:`çŠ¶æ€å·²è®¾ç½®ä¸º${o.text}`,icon:"success"})}})},viewChargingRules(){e({title:"æŸ¥çœ‹æ”¶è´¹è§„åˆ™",icon:"none"})},uploadPhoto(){n({count:1,success:a=>{const t=a.tempFilePaths[0];this.pointInfo.pointImage=t,this.pointInfo.photos.includes(t)||this.pointInfo.photos.unshift(t),e({title:"ç…§ç‰‡ä¸Šä¼ æˆåŠŸ",icon:"success"})}})},addPhoto(){n({count:1,success:a=>{const t=a.tempFilePaths[0];this.pointInfo.photos.push(t),e({title:"ç…§ç‰‡æ·»åŠ æˆåŠŸ",icon:"success"})}})},removePhoto(a){const t=this.pointInfo.photos[a];this.pointInfo.pointImage===t&&(this.pointInfo.pointImage=""),this.pointInfo.photos.splice(a,1),e({title:"ç…§ç‰‡åˆ é™¤æˆåŠŸ",icon:"success"})},setMainPhoto(a){this.pointInfo.pointImage=a,e({title:"å·²è®¾ç½®ä¸ºä¸»ç…§ç‰‡",icon:"success"})},savePoint(){if(!this.pointInfo.name||""===this.pointInfo.name.trim())return void e({title:"è¯·è¾“å…¥ç½‘ç‚¹åç§°",icon:"none"});if(!this.pointInfo.address||""===this.pointInfo.address.trim())return void e({title:"è¯·è¾“å…¥ç½‘ç‚¹åœ°å€",icon:"none"});if(!this.pointInfo.pointType||""===this.pointInfo.pointType.trim())return void e({title:"è¯·è¾“å…¥ç½‘ç‚¹ç±»å‹",icon:"none"});this.isSaving=!0;const o={name:this.pointInfo.name,address:this.pointInfo.address,pointType:this.pointInfo.pointType,availableLarge:this.pointInfo.availableLarge,availableMedium:this.pointInfo.availableMedium,availableSmall:this.pointInfo.availableSmall,openTime:this.pointInfo.openTime,status:this.pointInfo.staus,manager:this.pointInfo.manager,pointImage:this.pointInfo.pointImage,photos:this.pointInfo.photos},i=this.pointId&&"new"!==this.pointId,n=i?"http://localhost:8000/admin/updatePoint":"http://localhost:8000/admin/addPoint";i&&(o.id=this.pointId),console.log("ä¿å­˜ç½‘ç‚¹ä¿¡æ¯:",o),console.log("è¯·æ±‚URL:",n);const c=t("adminToken");if(console.log("å½“å‰token:",c),!c||"admin-token"===c)return e({title:"è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦å·",icon:"none",duration:2e3}),void setTimeout((()=>{s({url:"/pages/admin/login"})}),2e3);a({url:n,method:"POST",data:o,header:{"Content-Type":"application/json",Authorization:"Bearer "+t("adminToken")},success:a=>{var t;console.log("ä¿å­˜ç½‘ç‚¹æ¥å£è¿”å›æ•°æ®:",a),!a.data||200!==a.data.code&&"200"!==a.data.code?(console.error("ä¿å­˜å¤±è´¥:",a.data),e({title:(null==(t=a.data)?void 0:t.msg)||(i?"ä¿®æ”¹å¤±è´¥":"æ–°å¢å¤±è´¥"),icon:"none",duration:2e3})):(e({title:i?"ä¿®æ”¹æˆåŠŸ":"æ–°å¢æˆåŠŸ",icon:"success",duration:2e3}),setTimeout((()=>{l();const a=d(),t=a[a.length-2];t&&t.getPointList&&t.getPointList()}),1500))},fail:a=>{console.error("ä¿å­˜ç½‘ç‚¹è¯·æ±‚å¤±è´¥:",a),e({title:"ç½‘ç»œè¯·æ±‚å¤±è´¥",icon:"none",duration:2e3})},complete:()=>{this.isSaving=!1}})},goBack(){l()}}},[["render",function(a,t,e,o,i,n){const s=b,l=f,d=k,P=T;return u(),c(l,{class:"point-edit"},{default:p((()=>[r(l,{class:"header"},{default:p((()=>[r(l,{class:"back-btn",onClick:n.goBack},{default:p((()=>[r(s,{class:"back-icon"},{default:p((()=>[m("â†")])),_:1})])),_:1},8,["onClick"]),r(l,{class:"title"},{default:p((()=>[m(h("new"===i.pointId?"æ–°å¢ç½‘ç‚¹":"ç¼–è¾‘ç½‘ç‚¹"),1)])),_:1}),r(l,{class:"header-right"},{default:p((()=>[r(s,{class:"menu-icon"},{default:p((()=>[m("â‹¯")])),_:1}),r(s,{class:"target-icon"},{default:p((()=>[m("â—")])),_:1})])),_:1})])),_:1}),r(l,{class:"photo-section"},{default:p((()=>[r(l,{class:"photo-placeholder",onClick:n.uploadPhoto},{default:p((()=>[i.pointInfo.pointImage?(u(),c(d,{key:0,src:i.pointInfo.pointImage,mode:"aspectFill",class:"main-photo"},null,8,["src"])):(u(),c(l,{key:1,class:"photo-upload"},{default:p((()=>[r(s,{class:"photo-icon"},{default:p((()=>[m("ğŸ“·")])),_:1}),r(s,{class:"photo-text"},{default:p((()=>[m("ç½‘ç‚¹ç…§ç‰‡")])),_:1})])),_:1}))])),_:1},8,["onClick"])])),_:1}),r(l,{class:"info-section"},{default:p((()=>[r(l,{class:"section-header"},{default:p((()=>[r(s,{class:"section-title"},{default:p((()=>[m("ç½‘ç‚¹ä¿¡æ¯")])),_:1}),r(s,{class:"section-tip"},{default:p((()=>[m("ç‚¹å‡»å„é¡¹å¯ç¼–è¾‘")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[0]||(t[0]=a=>n.editField("name"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("ç½‘ç‚¹åç§°")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.name||"æœªè®¾ç½®"),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[1]||(t[1]=a=>n.editField("address"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("ç½‘ç‚¹åœ°å€")])),_:1}),r(l,{class:"address-container"},{default:p((()=>[r(s,{class:"location-icon"},{default:p((()=>[m("ğŸ“")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.address||"æœªè®¾ç½®"),1)])),_:1})])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[2]||(t[2]=a=>n.editField("pointType"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("ç½‘ç‚¹ç±»å‹")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.pointType||"æœªè®¾ç½®"),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[3]||(t[3]=a=>n.editField("cabinet"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("ç®¡ç†æŸœç»„")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(n.getCabinetInfo()),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[4]||(t[4]=a=>n.editField("openTime"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("è¥ä¸šæ—¶é—´")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.openTime||"æœªè®¾ç½®"),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[5]||(t[5]=a=>n.editField("manager"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("ç½‘ç‚¹ç®¡ç†å‘˜")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.manager||"æœªè®¾ç½®"),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[6]||(t[6]=a=>n.editField("status"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("ç½‘ç‚¹çŠ¶æ€")])),_:1}),r(s,{class:I(["info-value",1===i.pointInfo.staus?"status-normal":"status-closed"])},{default:p((()=>[m(h(1===i.pointInfo.staus?"æ­£å¸¸":"æš‚åœè¥ä¸š"),1)])),_:1},8,["class"]),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:n.viewChargingRules},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("æ”¶è´¹è§„åˆ™")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m("æŸ¥çœ‹")])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1},8,["onClick"])])),_:1}),r(l,{class:"photo-list-section"},{default:p((()=>[r(s,{class:"section-title"},{default:p((()=>[m("ç½‘ç‚¹ç…§ç‰‡")])),_:1}),r(l,{class:"photo-list"},{default:p((()=>[(u(!0),g(_,null,v(i.pointInfo.photos,((a,t)=>(u(),c(l,{key:t,class:"photo-item"},{default:p((()=>[r(d,{src:a,mode:"aspectFill",class:"list-photo",onClick:t=>n.setMainPhoto(a)},null,8,["src","onClick"]),r(s,{class:"remove-btn",onClick:a=>n.removePhoto(t)},{default:p((()=>[m("Ã—")])),_:2},1032,["onClick"]),i.pointInfo.pointImage===a?(u(),c(s,{key:0,class:"main-photo-label"},{default:p((()=>[m("ä¸»å›¾")])),_:1})):C("",!0)])),_:2},1024)))),128)),r(l,{class:"add-photo",onClick:n.addPhoto},{default:p((()=>[r(s,{class:"add-icon"},{default:p((()=>[m("+")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),r(l,{class:"save-section"},{default:p((()=>[r(P,{class:"save-btn",onClick:n.savePoint,disabled:i.isSaving},{default:p((()=>[m(h(i.isSaving?"ä¿å­˜ä¸­...":"new"===i.pointId?"æ–°å¢":"ä¿å­˜"),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-e99c3e38"]]);export{y as default};
