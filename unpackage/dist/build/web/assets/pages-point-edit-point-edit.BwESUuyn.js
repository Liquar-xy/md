import{r as a,g as t,a as e,m as o,q as i,y as n,v as s,p as l,A as d,e as c,w as p,i as f,o as u,f as r,j as m,t as h,n as I,C as g,D as v,F as _,k as b,u as k,l as T,x as C}from"./index-BAOqw0gZ.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=P({data:()=>({pointId:null,pointName:"",pointInfo:{name:"",address:"",pointType:"",availableLarge:0,availableMedium:0,availableSmall:0,openTime:"",staus:1,pointImage:"",manager:"",photos:[]},isSaving:!1}),onLoad(a){this.pointId=a.id||"new",this.pointName=decodeURIComponent(a.name||""),"new"===this.pointId?(console.log("新增网点模式"),this.pointInfo={name:"",address:"",pointType:"",availableLarge:0,availableMedium:0,availableSmall:0,openTime:"",staus:1,pointImage:"",manager:"",photos:[]}):(console.log("修改网点模式，ID:",this.pointId),this.getPointInfo())},methods:{getPointInfo(){console.log("正在获取网点信息，ID:",this.pointId),a({url:"http://localhost:8000/admin/getPointInfo",method:"POST",data:{Id:this.pointId},header:{"Content-Type":"application/json",Authorization:"Bearer "+t("adminToken")},success:a=>{var t;console.log("网点信息接口返回数据:",a),!a.data||200!==a.data.code&&"200"!==a.data.code?(console.error("接口返回错误:",a.data),e({title:(null==(t=a.data)?void 0:t.msg)||"获取网点信息失败",icon:"none"})):(this.pointInfo={name:a.data.name||a.data.Name||"",address:a.data.address||a.data.Address||"",pointType:a.data.pointType||a.data.PointType||"",availableLarge:parseInt(a.data.availableLarge||a.data.AvailableLarge)||0,availableMedium:parseInt(a.data.availableMedium||a.data.AvailableMedium)||0,availableSmall:parseInt(a.data.availableSmall||a.data.AvailableSmall)||0,openTime:a.data.openTime||a.data.OpenTime||"",staus:parseInt(a.data.staus||a.data.Status)||1,pointImage:a.data.pointImage||a.data.PointImage||"",manager:a.data.manager||a.data.Manager||"",photos:a.data.photos||a.data.Photos||[]},console.log("处理后的网点信息:",this.pointInfo),e({title:"数据加载成功",icon:"success",duration:1e3}))},fail:a=>{console.error("网点信息请求失败:",a),e({title:"网络请求失败",icon:"none"})}})},getCabinetInfo(){const{availableLarge:a,availableMedium:t,availableSmall:e}=this.pointInfo;return`${a}组${t}主机${e}柜门`},editField(a){console.log("点击编辑字段:",a);const t={name:"网点名称",address:"网点地址",pointType:"网点类型",cabinet:"管理柜组",openTime:"营业时间",manager:"网点管理员",status:"网点状态"}[a]||a;if("cabinet"!==a)if("status"!==a){switch(a){case"name":this.pointInfo.name;break;case"address":this.pointInfo.address;break;case"pointType":this.pointInfo.pointType;break;case"openTime":this.pointInfo.openTime;break;case"manager":this.pointInfo.manager}o({title:`编辑${t}`,content:"",editable:!0,placeholderText:`请输入${t}`,success:t=>{if(t.confirm){const o=t.content.trim();if(o){switch(a){case"name":this.pointInfo.name=o;break;case"address":this.pointInfo.address=o;break;case"pointType":this.pointInfo.pointType=o;break;case"openTime":this.pointInfo.openTime=o;break;case"manager":this.pointInfo.manager=o}e({title:"修改成功",icon:"success"})}}}})}else this.editStatus();else this.editCabinet()},editCabinet(){console.log("编辑柜组信息被调用"),o({title:"编辑柜组信息",content:"",editable:!0,placeholderText:"请输入：组数,主机数,柜门数（例如：10,15,20）",success:a=>{console.log("输入结果:",a),a.confirm&&a.content&&this.processCabinetInput(a.content)}})},processCabinetInput(a){console.log("用户输入:",a);const t=a.split(/[,，\s]+/).map((a=>parseInt(a.trim())||0));console.log("解析结果:",t),3===t.length?(this.pointInfo.availableLarge=t[0],this.pointInfo.availableMedium=t[1],this.pointInfo.availableSmall=t[2],console.log("更新后的柜组数据:",this.pointInfo.availableLarge,this.pointInfo.availableMedium,this.pointInfo.availableSmall),e({title:`已设置为：${t[0]}组${t[1]}主机${t[2]}柜门`,icon:"success",duration:2e3})):e({title:"格式错误，请输入三个数字，用逗号分隔",icon:"none",duration:3e3})},editStatus(){const a=[{text:"正常",value:1},{text:"暂停营业",value:0}];i({itemList:a.map((a=>a.text)),success:t=>{const o=a[t.tapIndex];this.pointInfo.staus=o.value,e({title:`状态已设置为${o.text}`,icon:"success"})}})},viewChargingRules(){e({title:"查看收费规则",icon:"none"})},uploadPhoto(){n({count:1,success:a=>{const t=a.tempFilePaths[0];this.pointInfo.pointImage=t,this.pointInfo.photos.includes(t)||this.pointInfo.photos.unshift(t),e({title:"照片上传成功",icon:"success"})}})},addPhoto(){n({count:1,success:a=>{const t=a.tempFilePaths[0];this.pointInfo.photos.push(t),e({title:"照片添加成功",icon:"success"})}})},removePhoto(a){const t=this.pointInfo.photos[a];this.pointInfo.pointImage===t&&(this.pointInfo.pointImage=""),this.pointInfo.photos.splice(a,1),e({title:"照片删除成功",icon:"success"})},setMainPhoto(a){this.pointInfo.pointImage=a,e({title:"已设置为主照片",icon:"success"})},savePoint(){if(!this.pointInfo.name||""===this.pointInfo.name.trim())return void e({title:"请输入网点名称",icon:"none"});if(!this.pointInfo.address||""===this.pointInfo.address.trim())return void e({title:"请输入网点地址",icon:"none"});if(!this.pointInfo.pointType||""===this.pointInfo.pointType.trim())return void e({title:"请输入网点类型",icon:"none"});this.isSaving=!0;const o={name:this.pointInfo.name,address:this.pointInfo.address,pointType:this.pointInfo.pointType,availableLarge:this.pointInfo.availableLarge,availableMedium:this.pointInfo.availableMedium,availableSmall:this.pointInfo.availableSmall,openTime:this.pointInfo.openTime,status:this.pointInfo.staus,manager:this.pointInfo.manager,pointImage:this.pointInfo.pointImage,photos:this.pointInfo.photos},i=this.pointId&&"new"!==this.pointId,n=i?"http://localhost:8000/admin/updatePoint":"http://localhost:8000/admin/addPoint";i&&(o.id=this.pointId),console.log("保存网点信息:",o),console.log("请求URL:",n);const c=t("adminToken");if(console.log("当前token:",c),!c||"admin-token"===c)return e({title:"请先登录管理员账号",icon:"none",duration:2e3}),void setTimeout((()=>{s({url:"/pages/admin/login"})}),2e3);a({url:n,method:"POST",data:o,header:{"Content-Type":"application/json",Authorization:"Bearer "+t("adminToken")},success:a=>{var t;console.log("保存网点接口返回数据:",a),!a.data||200!==a.data.code&&"200"!==a.data.code?(console.error("保存失败:",a.data),e({title:(null==(t=a.data)?void 0:t.msg)||(i?"修改失败":"新增失败"),icon:"none",duration:2e3})):(e({title:i?"修改成功":"新增成功",icon:"success",duration:2e3}),setTimeout((()=>{l();const a=d(),t=a[a.length-2];t&&t.getPointList&&t.getPointList()}),1500))},fail:a=>{console.error("保存网点请求失败:",a),e({title:"网络请求失败",icon:"none",duration:2e3})},complete:()=>{this.isSaving=!1}})},goBack(){l()}}},[["render",function(a,t,e,o,i,n){const s=b,l=f,d=k,P=T;return u(),c(l,{class:"point-edit"},{default:p((()=>[r(l,{class:"header"},{default:p((()=>[r(l,{class:"back-btn",onClick:n.goBack},{default:p((()=>[r(s,{class:"back-icon"},{default:p((()=>[m("←")])),_:1})])),_:1},8,["onClick"]),r(l,{class:"title"},{default:p((()=>[m(h("new"===i.pointId?"新增网点":"编辑网点"),1)])),_:1}),r(l,{class:"header-right"},{default:p((()=>[r(s,{class:"menu-icon"},{default:p((()=>[m("⋯")])),_:1}),r(s,{class:"target-icon"},{default:p((()=>[m("◎")])),_:1})])),_:1})])),_:1}),r(l,{class:"photo-section"},{default:p((()=>[r(l,{class:"photo-placeholder",onClick:n.uploadPhoto},{default:p((()=>[i.pointInfo.pointImage?(u(),c(d,{key:0,src:i.pointInfo.pointImage,mode:"aspectFill",class:"main-photo"},null,8,["src"])):(u(),c(l,{key:1,class:"photo-upload"},{default:p((()=>[r(s,{class:"photo-icon"},{default:p((()=>[m("📷")])),_:1}),r(s,{class:"photo-text"},{default:p((()=>[m("网点照片")])),_:1})])),_:1}))])),_:1},8,["onClick"])])),_:1}),r(l,{class:"info-section"},{default:p((()=>[r(l,{class:"section-header"},{default:p((()=>[r(s,{class:"section-title"},{default:p((()=>[m("网点信息")])),_:1}),r(s,{class:"section-tip"},{default:p((()=>[m("点击各项可编辑")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[0]||(t[0]=a=>n.editField("name"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("网点名称")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.name||"未设置"),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[1]||(t[1]=a=>n.editField("address"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("网点地址")])),_:1}),r(l,{class:"address-container"},{default:p((()=>[r(s,{class:"location-icon"},{default:p((()=>[m("📍")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.address||"未设置"),1)])),_:1})])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[2]||(t[2]=a=>n.editField("pointType"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("网点类型")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.pointType||"未设置"),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[3]||(t[3]=a=>n.editField("cabinet"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("管理柜组")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(n.getCabinetInfo()),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[4]||(t[4]=a=>n.editField("openTime"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("营业时间")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.openTime||"未设置"),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[5]||(t[5]=a=>n.editField("manager"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("网点管理员")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m(h(i.pointInfo.manager||"未设置"),1)])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:t[6]||(t[6]=a=>n.editField("status"))},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("网点状态")])),_:1}),r(s,{class:I(["info-value",1===i.pointInfo.staus?"status-normal":"status-closed"])},{default:p((()=>[m(h(1===i.pointInfo.staus?"正常":"暂停营业"),1)])),_:1},8,["class"]),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1}),r(l,{class:"info-item",onClick:n.viewChargingRules},{default:p((()=>[r(s,{class:"info-label"},{default:p((()=>[m("收费规则")])),_:1}),r(s,{class:"info-value"},{default:p((()=>[m("查看")])),_:1}),r(s,{class:"arrow"},{default:p((()=>[m(">")])),_:1})])),_:1},8,["onClick"])])),_:1}),r(l,{class:"photo-list-section"},{default:p((()=>[r(s,{class:"section-title"},{default:p((()=>[m("网点照片")])),_:1}),r(l,{class:"photo-list"},{default:p((()=>[(u(!0),g(_,null,v(i.pointInfo.photos,((a,t)=>(u(),c(l,{key:t,class:"photo-item"},{default:p((()=>[r(d,{src:a,mode:"aspectFill",class:"list-photo",onClick:t=>n.setMainPhoto(a)},null,8,["src","onClick"]),r(s,{class:"remove-btn",onClick:a=>n.removePhoto(t)},{default:p((()=>[m("×")])),_:2},1032,["onClick"]),i.pointInfo.pointImage===a?(u(),c(s,{key:0,class:"main-photo-label"},{default:p((()=>[m("主图")])),_:1})):C("",!0)])),_:2},1024)))),128)),r(l,{class:"add-photo",onClick:n.addPhoto},{default:p((()=>[r(s,{class:"add-icon"},{default:p((()=>[m("+")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),r(l,{class:"save-section"},{default:p((()=>[r(P,{class:"save-btn",onClick:n.savePoint,disabled:i.isSaving},{default:p((()=>[m(h(i.isSaving?"保存中...":"new"===i.pointId?"新增":"保存"),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-e99c3e38"]]);export{y as default};
