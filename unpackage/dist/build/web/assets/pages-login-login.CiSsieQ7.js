import{g as o,s as e,a as t,r as l,b as s,h as n,c as a,d as i,e as c,w as d,i as u,o as r,f as g,j as h,n as p,t as m,k as f,l as y,I as _}from"./index-BAOqw0gZ.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=w({data:()=>({account:"13661740781",password:"200621",verifyCode:"",loginType:"user",countdown:0}),onLoad(o){o&&"true"===o.force?console.log("强制显示登录页面，跳过自动登录检查"):this.checkLoginStatus()},methods:{checkLoginStatus(){const t=o("token"),l=o("userData");t&&l&&(console.log("用户已登录，跳转到首页"),e({url:"/pages/index/index"}))},selectLoginType(o){this.loginType=o,console.log("切换到登录类型:",o),this.account="",this.password="",this.verifyCode="",this.countdown=0},handleGetVerifyCode(){if(!this.account)return void t({title:"请先输入手机号",icon:"none"});if(!/^1[3-9]\d{9}$/.test(this.account))return void t({title:"请输入正确的手机号",icon:"none"});console.log("发送验证码到手机:",this.account),this.countdown=60,console.log("设置倒计时为:",this.countdown),this.startCountdown();const o={mobile:this.account};"admin"===this.loginType?o.source="admin_login":o.source="login",l({url:"http://localhost:8000/sendSms",method:"POST",data:o,header:{"Content-Type":"application/x-www-form-urlencoded"},success:o=>{var e;console.log("发送短信响应:",o.data),o.data&&200===o.data.code?(t({title:"验证码已发送",icon:"success"}),console.log("验证码已发送到手机:",this.account,"并存储在Redis中")):(t({title:(null==(e=o.data)?void 0:e.msg)||"发送失败",icon:"none"}),this.countdown=0)},fail:o=>{console.log("发送短信失败:",o),t({title:"网络错误，请重试",icon:"none"}),this.countdown=0}})},startCountdown(){console.log("当前倒计时:",this.countdown),this.countdown>0&&setTimeout((()=>{this.countdown--,this.startCountdown()}),1e3)},handleLogin(){if(!this.account)return void t({title:"请输入账号",icon:"none"});if(!this.password)return void t({title:"请输入密码",icon:"none"});if(!this.verifyCode)return void t({title:"请输入验证码",icon:"none"});if(4!==this.verifyCode.length)return void t({title:"验证码格式不正确",icon:"none"});let o,c;s({title:"登录中..."}),"admin"===this.loginType?(o="http://localhost:8000/admin",c={admin_id:this.account,locker_point_id:"1"}):(o="http://localhost:8000/login",c={mobile:this.account,password:this.password,smsCode:this.verifyCode,username:"user"}),console.log("=== 管理员登录请求详情 ==="),console.log("登录类型:",this.loginType),console.log("登录接口:",o),console.log("登录请求参数:",c),console.log("请求参数详情:"),console.log("  mobile:",c.mobile),console.log("  password:",c.password),console.log("  smsCode:",c.smsCode),l({url:o,method:"POST",data:c,header:{"Content-Type":"application/x-www-form-urlencoded"},success:o=>{var l;if(n(),console.log("=== 管理员登录响应详情 ==="),console.log("完整响应:",o),console.log("响应数据:",o.data),console.log("响应状态码:",o.statusCode),console.log("响应数据类型:",typeof o.data.code),console.log("响应code值:",o.data.code),console.log("响应code是否等于200:",200===o.data.code),console.log('响应code是否等于"200":',"200"===o.data.code),console.log("响应消息:",o.data.msg),console.log("管理员ID:",o.data.id),console.log("Token:",o.data.token),!o.data||200!==o.data.code&&"200"!==o.data.code)console.log("登录失败详情:",o.data),t({title:(null==(l=o.data)?void 0:l.msg)||"登录失败",icon:"none"});else{let l;console.log("后端返回的完整数据:",o.data),console.log("后端返回的id字段:",o.data.id),console.log("当前账号:",this.account),l="admin"===this.loginType?{username:"管理员",phoneNumber:this.account,account:this.account,loginType:this.loginType,token:"admin_token_"+this.account,userId:this.account,id:this.account,isLoggedIn:!0,adminStats:{pointNum:o.data.pointNum,lastOrderNum:o.data.lastOrderNum,yesterdayOrderNum:o.data.yesterdayOrderNum,lastOrderPrice:o.data.lastOrderPrice,mouthPrice:o.data.mouthPrice,monthNum:o.data.monthNum}}:{username:"智慧存0987",phoneNumber:this.account,account:this.account,loginType:this.loginType,token:o.data.token,userId:o.data.id||this.account,id:o.data.id||this.account,isLoggedIn:!0};try{"admin"===this.loginType?a("adminData",JSON.stringify(l)):a("userData",JSON.stringify(l)),a("token",l.token),console.log("登录数据已保存到localStorage")}catch(s){console.log("保存登录数据失败:",s)}console.log("登录成功，开始跳转"),console.log("当前登录类型:",this.loginType),console.log("准备执行跳转..."),console.log("当前登录类型:",this.loginType),"admin"===this.loginType?(console.log("跳转到管理员页面"),i({url:"/pages/admin/admin",success:()=>{console.log("管理员页面跳转成功"),t({title:"登录成功",icon:"success"})},fail:o=>{console.log("管理员页面跳转失败:",o),t({title:"跳转失败",icon:"none"})}})):(console.log("跳转到我的页面"),e({url:"/pages/my/my",success:()=>{console.log("我的页面跳转成功"),t({title:"登录成功",icon:"success"})},fail:o=>{console.log("我的页面跳转失败:",o),t({title:"跳转失败",icon:"none"})}}))}},fail:o=>{n(),console.log("登录请求失败:",o),t({title:"网络错误，请重试",icon:"none"})}})}}},[["render",function(o,e,t,l,s,n){const a=f,i=u,w=y,T=_;return r(),c(i,{class:"login-container"},{default:d((()=>[g(i,{class:"title-section"},{default:d((()=>[g(a,{class:"main-title"},{default:d((()=>[h("账号登录")])),_:1}),g(a,{class:"welcome-text"},{default:d((()=>[h("欢迎登录优小宝")])),_:1})])),_:1}),g(i,{class:"login-type-section"},{default:d((()=>[g(i,{class:"type-buttons"},{default:d((()=>[g(w,{class:p(["type-btn",{active:"user"===s.loginType}]),onClick:e[0]||(e[0]=o=>n.selectLoginType("user"))},{default:d((()=>[h(" 用户登录 ")])),_:1},8,["class"]),g(w,{class:p(["type-btn",{active:"admin"===s.loginType}]),onClick:e[1]||(e[1]=o=>n.selectLoginType("admin"))},{default:d((()=>[h(" 管理员登录 ")])),_:1},8,["class"])])),_:1})])),_:1}),g(i,{class:"form-section"},{default:d((()=>[g(i,{class:"input-group"},{default:d((()=>[g(a,{class:"input-label"},{default:d((()=>[h("账号")])),_:1}),g(T,{class:"input-field",type:"text",placeholder:"请输入手机号",modelValue:s.account,"onUpdate:modelValue":e[2]||(e[2]=o=>s.account=o),maxlength:"11"},null,8,["modelValue"])])),_:1}),g(i,{class:"input-group"},{default:d((()=>[g(a,{class:"input-label"},{default:d((()=>[h("密码")])),_:1}),g(T,{class:"input-field",type:"password",placeholder:"请输入密码",modelValue:s.password,"onUpdate:modelValue":e[3]||(e[3]=o=>s.password=o)},null,8,["modelValue"])])),_:1}),g(i,{class:"input-group"},{default:d((()=>[g(a,{class:"input-label"},{default:d((()=>[h("验证码")])),_:1}),g(i,{class:"verify-code-container"},{default:d((()=>[g(T,{class:"input-field verify-input",type:"text",placeholder:"请输入验证码",modelValue:s.verifyCode,"onUpdate:modelValue":e[4]||(e[4]=o=>s.verifyCode=o),maxlength:"4"},null,8,["modelValue"]),g(w,{class:p(["verify-btn",{disabled:s.countdown>0}]),onClick:n.handleGetVerifyCode,disabled:s.countdown>0},{default:d((()=>[h(m(s.countdown>0?s.countdown+"秒":"获取验证码"),1)])),_:1},8,["class","onClick","disabled"])])),_:1})])),_:1}),g(w,{class:"login-btn",onClick:n.handleLogin},{default:d((()=>[h("登录")])),_:1},8,["onClick"])])),_:1}),g(i,{class:"footer-section"},{default:d((()=>[g(i,{class:"logo-container"},{default:d((()=>[g(i,{class:"logo"},{default:d((()=>[g(a,{class:"logo-text"},{default:d((()=>[h("优小宝")])),_:1})])),_:1}),g(i,{class:"tagline"},{default:d((()=>[g(a,{class:"tagline-text"},{default:d((()=>[h("智存无忧")])),_:1}),g(a,{class:"tagline-text"},{default:d((()=>[h("安心随行")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-3ed13a0c"]]);export{T as default};
