import{a as e,p as s,r as a,m as t,A as l,s as o,e as n,w as r,i as c,o as d,f as i,j as u,t as f,n as _,x as h,C as m,D as p,F as g,k as R,l as b}from"./index-C_HCjYUn.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=k({data:()=>({orderId:null,orderInfo:null,loading:!0,processing:!1,showResult:!1,resultSuccess:!1,resultMessage:"",selectedReason:-1,refundReasons:["不需要寄存了","找到其他寄存点","计划有变","价格太贵","服务不满意","其他原因"]}),onLoad(a){console.log("订单删除页面加载:",a),a.id?(this.orderId=parseInt(a.id),this.fetchOrderDetails()):(e({title:"订单ID无效",icon:"none"}),setTimeout((()=>{s()}),2e3))},methods:{fetchOrderDetails(){this.loading=!0,a({url:"http://127.0.0.1:8000/v1/orders/show",method:"POST",header:{"Content-Type":"application/json"},data:JSON.stringify({id:this.orderId}),success:s=>{if(console.log("获取订单详情成功:",s),200===s.statusCode&&s.data&&s.data.order&&s.data.order.length>0){const e=s.data.order[0];this.orderInfo={id:e.id,order_number:e.orderNumber,status:parseInt(e.status)||0,storage_location_name:e.storageLocationName,cabinet_id:e.cabinetId,amount_paid:Number(e.amountPaid)||0,price:Number(e.price)||0}}else e({title:"获取订单信息失败",icon:"none"})},fail:s=>{console.error("获取订单详情失败:",s),e({title:"网络异常，请重试",icon:"none"})},complete:()=>{this.loading=!1}})},selectReason(e){this.selectedReason=e},confirmRefund(){this.processing||-1===this.selectedReason||t({title:"确认退款",content:`确定要退款并删除订单吗？\n退款原因：${this.refundReasons[this.selectedReason]}\n退款金额：¥${this.formatAmount(this.orderInfo.amount_paid)}`,confirmText:"确认退款",cancelText:"取消",success:e=>{e.confirm&&this.processRefund()}})},processRefund(){this.processing=!0;const e={id:this.orderId,reason:this.refundReasons[this.selectedReason],amount:this.orderInfo.amount_paid};console.log("发送退款请求:",e),a({url:"http://127.0.0.1:8000/v1/order/del",method:"POST",header:{"Content-Type":"application/json"},data:JSON.stringify(e),timeout:1e4,success:e=>{var s,a;if(console.log("退款请求响应:",e),200===e.statusCode)this.showResultModal(!0,"退款申请已提交，预计1-3个工作日内到账");else{const t=(null==(s=e.data)?void 0:s.message)||(null==(a=e.data)?void 0:a.msg)||"退款失败，请重试";this.showResultModal(!1,t)}},fail:e=>{var s;console.error("退款请求失败:",e);let a="网络异常，请重试";(null==(s=e.errMsg)?void 0:s.includes("timeout"))&&(a="请求超时，请检查网络连接"),this.showResultModal(!1,a)},complete:()=>{this.processing=!1}})},showResultModal(e,s){this.resultSuccess=e,this.resultMessage=s,this.showResult=!0},handleResultConfirm(){this.showResult=!1,this.resultSuccess&&(e({title:"退款成功",icon:"success",duration:2e3}),setTimeout((()=>{l().length>2?s({delta:2,fail:()=>{o({url:"/pages/orders/orders"})}}):o({url:"/pages/orders/orders"})}),2e3))},goBack(){s()},formatAmount:e=>(e||0).toFixed(2),getOrderStatusText(e){switch(parseInt(e)){case 1:return"待支付";case 2:return"寄存中";case 3:return"已完成";case 4:return"已取消";case 5:return"超时";case 6:return"异常";default:return"未知状态"}}}},[["render",function(e,s,a,t,l,o){const k=R,I=c,C=b;return d(),n(I,{class:"order-delete-container"},{default:r((()=>[i(I,{class:"header-bar"},{default:r((()=>[i(I,{class:"back-btn",onClick:o.goBack,"hover-class":"back-btn-hover"},{default:r((()=>[i(k,{class:"back-icon"},{default:r((()=>[u("←")])),_:1})])),_:1},8,["onClick"]),i(k,{class:"header-title"},{default:r((()=>[u("订单退款")])),_:1}),i(I,{class:"header-placeholder"})])),_:1}),l.loading?(d(),n(I,{key:0,class:"loading-container"},{default:r((()=>[i(k,{class:"loading-text"},{default:r((()=>[u("加载中...")])),_:1})])),_:1})):l.orderInfo?(d(),n(I,{key:1,class:"order-info-section"},{default:r((()=>[i(I,{class:"info-card"},{default:r((()=>[i(I,{class:"card-header"},{default:r((()=>[i(k,{class:"card-title"},{default:r((()=>[u("订单信息")])),_:1})])),_:1}),i(I,{class:"info-row"},{default:r((()=>[i(k,{class:"info-label"},{default:r((()=>[u("订单号")])),_:1}),i(k,{class:"info-value"},{default:r((()=>[u(f(l.orderInfo.order_number),1)])),_:1})])),_:1}),i(I,{class:"info-row"},{default:r((()=>[i(k,{class:"info-label"},{default:r((()=>[u("订单状态")])),_:1}),i(k,{class:_(["info-value status","status-"+l.orderInfo.status])},{default:r((()=>[u(f(o.getOrderStatusText(l.orderInfo.status)),1)])),_:1},8,["class"])])),_:1}),i(I,{class:"info-row"},{default:r((()=>[i(k,{class:"info-label"},{default:r((()=>[u("寄存网点")])),_:1}),i(k,{class:"info-value"},{default:r((()=>[u(f(l.orderInfo.storage_location_name),1)])),_:1})])),_:1}),i(I,{class:"info-row"},{default:r((()=>[i(k,{class:"info-label"},{default:r((()=>[u("柜子ID")])),_:1}),i(k,{class:"info-value"},{default:r((()=>[u(f(l.orderInfo.cabinet_id),1)])),_:1})])),_:1}),i(I,{class:"info-row"},{default:r((()=>[i(k,{class:"info-label"},{default:r((()=>[u("订单金额")])),_:1}),i(k,{class:"info-value amount"},{default:r((()=>[u("¥"+f(o.formatAmount(l.orderInfo.amount_paid)),1)])),_:1})])),_:1})])),_:1})])),_:1})):h("",!0),i(I,{class:"refund-notice"},{default:r((()=>[i(I,{class:"notice-header"},{default:r((()=>[i(k,{class:"notice-title"},{default:r((()=>[u("退款说明")])),_:1})])),_:1}),i(I,{class:"notice-content"},{default:r((()=>[i(k,{class:"notice-text"},{default:r((()=>[u("• 退款将在1-3个工作日内到账")])),_:1}),i(k,{class:"notice-text"},{default:r((()=>[u("• 退款金额将原路返回到您的支付账户")])),_:1}),i(k,{class:"notice-text"},{default:r((()=>[u("• 如有疑问，请联系客服")])),_:1}),i(k,{class:"notice-text"},{default:r((()=>[u("• 退款成功后，订单将被删除且无法恢复")])),_:1})])),_:1})])),_:1}),i(I,{class:"refund-reason-section"},{default:r((()=>[i(I,{class:"reason-header"},{default:r((()=>[i(k,{class:"reason-title"},{default:r((()=>[u("退款原因")])),_:1})])),_:1}),i(I,{class:"reason-options"},{default:r((()=>[(d(!0),m(g,null,p(l.refundReasons,((e,s)=>(d(),n(I,{key:s,class:_(["reason-option",{active:l.selectedReason===s}]),onClick:e=>o.selectReason(s)},{default:r((()=>[i(k,{class:"reason-text"},{default:r((()=>[u(f(e),1)])),_:2},1024),i(I,{class:_(["reason-radio",{checked:l.selectedReason===s}])},null,8,["class"])])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),i(I,{class:"action-buttons"},{default:r((()=>[i(C,{class:"cancel-btn",onClick:o.goBack},{default:r((()=>[u("取消")])),_:1},8,["onClick"]),i(C,{class:_(["confirm-btn",{disabled:l.processing||-1===l.selectedReason}]),disabled:l.processing||-1===l.selectedReason,onClick:o.confirmRefund},{default:r((()=>[u(f(l.processing?"处理中...":"确认退款"),1)])),_:1},8,["class","disabled","onClick"])])),_:1}),l.showResult?(d(),n(I,{key:2,class:"result-modal"},{default:r((()=>[i(I,{class:"modal-content"},{default:r((()=>[i(I,{class:_(["result-icon",l.resultSuccess?"success":"error"])},{default:r((()=>[i(k,null,{default:r((()=>[u(f(l.resultSuccess?"✓":"✗"),1)])),_:1})])),_:1},8,["class"]),i(k,{class:"result-title"},{default:r((()=>[u(f(l.resultSuccess?"退款成功":"退款失败"),1)])),_:1}),i(k,{class:"result-message"},{default:r((()=>[u(f(l.resultMessage),1)])),_:1}),i(C,{class:"result-btn",onClick:o.handleResultConfirm},{default:r((()=>[u("确定")])),_:1},8,["onClick"])])),_:1})])),_:1})):h("",!0)])),_:1})}],["__scopeId","data-v-a48b7cc1"]]);export{I as default};
