import{a as e,p as a,r as t,A as s,s as r,d as o,v as l,e as d,w as n,i,o as c,f as u,j as f,t as _,x as h,k as p,l as g}from"./index-BAOqw0gZ.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=b({data:()=>({orderId:null,order:null,loading:!0}),onLoad(t){const s=t.id?parseInt(t.id,10):null;s&&!isNaN(s)?(this.orderId=s,this.fetchOrderDetails()):(e({title:"无效的订单ID",icon:"none",duration:2e3}),setTimeout((()=>{a()}),2e3))},methods:{fetchOrderDetails(){if(!this.orderId)return e({title:"订单ID无效",icon:"none"}),void(this.loading=!1);t({url:"http://127.0.0.1:8000/v1/orders/show",method:"POST",header:{"Content-Type":"application/json"},data:JSON.stringify({id:this.orderId}),success:a=>{if(console.log("订单详情请求成功:",a),200!==a.statusCode)return void e({title:`请求失败：状态码 ${a.statusCode}`,icon:"none"});if(!a.data||!a.data.order||0===a.data.order.length)return e({title:"未找到订单详情",icon:"none"}),void console.warn("订单数据为空:",a.data);const t=a.data.order[0];this.order={id:t.id,order_number:t.orderNumber,user_id:t.userId,scheduled_duration:t.scheduledDuration,actual_duration:t.actualDuration,price:t.price,discount:t.discount,amount_paid:t.amountPaid,storage_location_name:t.storageLocationName,cabinet_id:t.cabinetId,status:t.status,deposit_status:t.depositStatus},this.order||e({title:"未找到订单详情",icon:"none"})},fail:a=>{console.error("获取订单详情失败 - 详细错误:",a),e({title:`获取订单详情失败：${a.errMsg||"未知错误"}`,icon:"none"})},complete:()=>{this.loading=!1}})},getOrderStatusText(e){switch(e){case 1:return"待支付";case 2:return"寄存中";case 3:return"已完成";case 4:return"已取消";case 5:return"超时";case 6:return"异常";default:return"未知状态"}},getDepositStatusText(e){switch(e){case 1:return"已支付";case 2:return"已退还";case 3:return"已扣除";default:return"未知状态"}},goBack(){try{s().length>1?a({delta:1,fail:e=>{console.error("返回失败:",e),r({url:"/pages/orders/orders",fail:()=>{o({url:"/pages/orders/orders"})}})}}):r({url:"/pages/orders/orders",fail:()=>{o({url:"/pages/orders/orders"})}})}catch(e){console.error("返回出错:",e),o({url:"/pages/orders/orders"})}},handlePickup(){e({title:"取出物品功能开发中",icon:"none"})},handleEvaluate(){e({title:"评价功能开发中",icon:"none"})},handleCustomAction(){this.order?l({url:`/pages/alipay/alipay?id=${this.order.id}`,fail:a=>{console.error("跳转支付页面失败:",a),e({title:"页面跳转失败",icon:"none"})}}):e({title:"订单数据不完整",icon:"none"})}}},[["render",function(e,a,t,s,r,o){const l=p,b=i,k=g;return c(),d(b,{class:"order-detail-container"},{default:n((()=>[u(b,{class:"header-bar"},{default:n((()=>[u(b,{class:"back-btn",onClick:o.goBack,"hover-class":"back-btn-hover"},{default:n((()=>[u(l,{class:"back-icon"},{default:n((()=>[f("←")])),_:1})])),_:1},8,["onClick"]),u(l,{class:"header-title"},{default:n((()=>[f("订单详情")])),_:1}),u(b,{class:"header-placeholder"})])),_:1}),r.loading?(c(),d(b,{key:0,class:"loading-container"},{default:n((()=>[u(l,{class:"loading-text"},{default:n((()=>[f("加载中...")])),_:1})])),_:1})):r.order?(c(),d(b,{key:1,class:"order-detail-content"},{default:n((()=>[u(b,{class:"order-status-banner"},{default:n((()=>[u(l,{class:"status-text"},{default:n((()=>[f(_(o.getOrderStatusText(r.order.status)),1)])),_:1})])),_:1}),u(b,{class:"order-info-card"},{default:n((()=>[u(b,{class:"info-row"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("订单号")])),_:1}),u(l,{class:"info-value"},{default:n((()=>[f(_(r.order.order_number),1)])),_:1})])),_:1}),u(b,{class:"info-row"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("寄存网点")])),_:1}),u(l,{class:"info-value"},{default:n((()=>[f(_(r.order.storage_location_name),1)])),_:1})])),_:1}),u(b,{class:"info-row"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("柜子ID")])),_:1}),u(l,{class:"info-value"},{default:n((()=>[f(_(r.order.cabinet_id),1)])),_:1})])),_:1})])),_:1}),u(b,{class:"order-time-fee-card"},{default:n((()=>[u(b,{class:"info-row"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("计划寄存时长")])),_:1}),u(l,{class:"info-value"},{default:n((()=>[f(_(r.order.scheduled_duration)+"小时",1)])),_:1})])),_:1}),u(b,{class:"info-row"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("实际寄存时长")])),_:1}),u(l,{class:"info-value"},{default:n((()=>[f(_(r.order.actual_duration)+"小时",1)])),_:1})])),_:1}),u(b,{class:"info-row"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("基础费用")])),_:1}),u(l,{class:"info-value"},{default:n((()=>[f("¥"+_(r.order.price.toFixed(2)),1)])),_:1})])),_:1}),u(b,{class:"info-row"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("优惠金额")])),_:1}),u(l,{class:"info-value"},{default:n((()=>[f("¥"+_(r.order.discount.toFixed(2)),1)])),_:1})])),_:1}),u(b,{class:"info-row total"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("实付金额")])),_:1}),u(l,{class:"info-value highlight"},{default:n((()=>[f("¥"+_(r.order.amount_paid.toFixed(2)),1)])),_:1})])),_:1})])),_:1}),u(b,{class:"order-deposit-card"},{default:n((()=>[u(b,{class:"info-row"},{default:n((()=>[u(l,{class:"info-label"},{default:n((()=>[f("押金状态")])),_:1}),u(l,{class:"info-value"},{default:n((()=>[f(_(o.getDepositStatusText(r.order.deposit_status)),1)])),_:1})])),_:1})])),_:1}),u(b,{class:"order-actions"},{default:n((()=>[2===r.order.status?(c(),d(k,{key:0,class:"action-btn primary",onClick:o.handlePickup},{default:n((()=>[f(" 取出物品 ")])),_:1},8,["onClick"])):h("",!0),3===r.order.status?(c(),d(k,{key:1,class:"action-btn default",onClick:o.handleEvaluate},{default:n((()=>[f(" 去评价 ")])),_:1},8,["onClick"])):h("",!0),u(k,{class:"action-btn secondary",onClick:o.handleCustomAction},{default:n((()=>[f(" 去支付 ")])),_:1},8,["onClick"])])),_:1})])),_:1})):(c(),d(b,{key:2,class:"error-container"},{default:n((()=>[u(l,{class:"error-text"},{default:n((()=>[f("未找到订单详情")])),_:1})])),_:1}))])),_:1})}],["__scopeId","data-v-d1b79254"]]);export{k as default};
