import{r as t,a,v as s,O as e,e as r,w as l,i as o,o as d,f as i,j as c,n,C as u,D as _,F as f,t as h,x as g,k as m,u as p,l as b}from"./index-BgeTyoVd.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=k({data:()=>({currentTab:0,orders:[],total:0,page:1,size:20,storage_location_name:"",loading:!1}),onLoad(){this.fetchOrders()},methods:{switchTab(t){this.currentTab!==t&&(this.currentTab=t,this.page=1,this.orders=[],this.fetchOrders())},fetchOrders(){this.loading=!0,t({url:"http://127.0.0.1:8000/v1/orders/list",method:"POST",header:{"Content-Type":"application/json"},data:JSON.stringify({page:this.page,size:this.size,storage_location_name:this.storage_location_name,status:0===this.currentTab?"1,2":"3"}),success:t=>{if(console.log("订单列表请求成功:",t),200!==t.statusCode)return void a({title:`请求失败：状态码 ${t.statusCode}`,icon:"none"});if(!t.data||!t.data.orders)return a({title:"未获取到订单数据",icon:"none"}),void console.warn("订单数据结构异常:",t.data);const s=t.data.orders.map((t=>({id:t.id,order_number:t.orderNumber,user_id:t.userId,scheduled_duration:t.scheduledDuration,actual_duration:t.actualDuration,price:t.price,discount:t.discount,amount_paid:t.amountPaid,storage_location_name:t.storageLocationName,cabinet_id:t.cabinetId,status:t.status,deposit_status:t.depositStatus})));this.orders=1===this.page?s:[...this.orders,...s],this.total=t.data.total||0,0===this.orders.length&&a({title:0===this.currentTab?"暂无当前订单":"暂无历史订单",icon:"none"})},fail:t=>{console.error("获取订单失败 - 详细错误:",t),a({title:`获取订单失败：${t.errMsg||"未知错误"}`,icon:"none"})},complete:()=>{this.loading=!1}})},handleHomeClick(){a({title:"首页",icon:"none"})},handleOrdersClick(){a({title:"订单页面",icon:"none"})},handleMyClick(){s({url:"/pages/my/my"})},onReachBottom(){this.orders.length<this.total&&(this.page++,this.fetchOrders())},onPullDownRefresh(){this.page=1,this.orders=[],this.fetchOrders(),e()},goToOrderDetail(t){s({url:`/pages/show/show?id=${t}`})}}},[["render",function(t,a,s,e,k,C){const v=m,y=o,T=p,O=b;return d(),r(y,{class:"order-page-container"},{default:l((()=>[i(y,{class:"header-bar"},{default:l((()=>[i(v,{class:"header-title"},{default:l((()=>[c("我的订单")])),_:1}),i(y,{class:"header-icons"},{default:l((()=>[i(v,{class:"iconfont"},{default:l((()=>[c("")])),_:1}),i(v,{class:"iconfont"},{default:l((()=>[c("")])),_:1})])),_:1})])),_:1}),i(y,{class:"order-tabs"},{default:l((()=>[i(y,{class:n(["tab-item",0===k.currentTab?"active":""]),onClick:a[0]||(a[0]=t=>C.switchTab(0))},{default:l((()=>[c("当前订单")])),_:1},8,["class"]),i(y,{class:n(["tab-item",1===k.currentTab?"active":""]),onClick:a[1]||(a[1]=t=>C.switchTab(1))},{default:l((()=>[c("历史订单")])),_:1},8,["class"])])),_:1}),0===k.currentTab||1===k.currentTab?(d(),r(y,{key:0,class:"order-list"},{default:l((()=>[k.loading?(d(),r(y,{key:0,class:"loading-container"},{default:l((()=>[i(v,{class:"loading-text"},{default:l((()=>[c("加载中...")])),_:1})])),_:1})):k.orders.length>0?(d(!0),u(f,{key:1},_(k.orders,((t,a)=>(d(),r(y,{key:t.id,class:"order-card",onClick:a=>C.goToOrderDetail(t.id)},{default:l((()=>[i(y,{class:"order-card-main"},{default:l((()=>[i(T,{src:"/static/locker-image.jpg",class:"order-img",mode:"aspectFill"},null,8,["src"]),i(y,{class:"order-info"},{default:l((()=>[i(y,{class:"order-title-row"},{default:l((()=>[i(v,{class:"order-title"},{default:l((()=>[c(h(t.storage_location_name),1)])),_:2},1024),i(v,{class:n(["order-status",1===t.status?"status-pending":3===t.status?"status-done":""])},{default:l((()=>[c(h(1===t.status?"待支付":2===t.status?"寄存中":3===t.status?"已完成":4===t.status?"已取消":5===t.status?"超时":6===t.status?"异常":""),1)])),_:2},1032,["class"]),1===t.deposit_status?(d(),r(v,{key:0,class:"order-badge"},{default:l((()=>[c("押金已支付")])),_:1})):2===t.deposit_status?(d(),r(v,{key:1,class:"order-badge"},{default:l((()=>[c("押金已退还")])),_:1})):3===t.deposit_status?(d(),r(v,{key:2,class:"order-badge"},{default:l((()=>[c("押金已扣除")])),_:1})):g("",!0)])),_:2},1024),i(v,{class:"order-desc"},{default:l((()=>[c("订单号："+h(t.order_number),1)])),_:2},1024),i(v,{class:"order-location"},{default:l((()=>[c("柜子ID："+h(t.cabinet_id),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),i(y,{class:"order-card-footer"},{default:l((()=>[i(v,{class:"order-timer"},{default:l((()=>[c("计划时长"+h(t.scheduled_duration)+"小时，实用"+h(t.actual_duration)+"小时",1)])),_:2},1024),i(y,{class:"order-actions"},{default:l((()=>[2===t.status?(d(),r(O,{key:0,class:"order-btn primary"},{default:l((()=>[c("取出")])),_:1})):g("",!0),3===t.status?(d(),r(O,{key:1,class:"order-btn default"},{default:l((()=>[c("去评价")])),_:1})):g("",!0),i(y,{class:n(["order-status-badge","status-"+t.status])},{default:l((()=>[i(v,{class:"status-text"},{default:l((()=>[c(h(1===t.status?"待支付":2===t.status?"寄存中":3===t.status?"已完成":4===t.status?"已取消":5===t.status?"超时":6===t.status?"异常":""),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)):(d(),r(y,{key:2,class:"order-list empty"},{default:l((()=>[i(v,{class:"empty-text"},{default:l((()=>[c(h(0===k.currentTab?"暂无当前订单":"暂无历史订单"),1)])),_:1})])),_:1}))])),_:1})):g("",!0),i(y,{class:"bottom-nav"},{default:l((()=>[i(y,{class:"nav-item",onClick:C.handleHomeClick},{default:l((()=>[i(v,{class:"nav-icon"},{default:l((()=>[c("🏠")])),_:1}),i(v,{class:"nav-text"},{default:l((()=>[c("首页")])),_:1})])),_:1},8,["onClick"]),i(y,{class:"nav-item active",onClick:C.handleOrdersClick},{default:l((()=>[i(v,{class:"nav-icon"},{default:l((()=>[c("📋")])),_:1}),i(v,{class:"nav-text"},{default:l((()=>[c("订单")])),_:1})])),_:1},8,["onClick"]),i(y,{class:"nav-item",onClick:C.handleMyClick},{default:l((()=>[i(v,{class:"nav-icon"},{default:l((()=>[c("👤")])),_:1}),i(v,{class:"nav-text"},{default:l((()=>[c("我的")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-66208322"]]);export{C as default};
