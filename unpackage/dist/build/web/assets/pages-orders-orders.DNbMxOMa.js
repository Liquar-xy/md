import{r as t,a,v as s,O as e,e as r,w as l,i as o,o as d,f as i,j as c,n,C as u,D as _,F as f,t as h,x as g,k as m,u as p,l as b}from"./index-BgeTyoVd.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=k({data:()=>({currentTab:0,orders:[],total:0,page:1,size:20,storage_location_name:"",loading:!1}),onLoad(){this.fetchOrders()},methods:{switchTab(t){this.currentTab!==t&&(this.currentTab=t,this.page=1,this.orders=[],this.fetchOrders())},fetchOrders(){this.loading=!0,t({url:"http://127.0.0.1:8000/v1/orders/list",method:"POST",header:{"Content-Type":"application/json"},data:JSON.stringify({page:this.page,size:this.size,storage_location_name:this.storage_location_name,status:0===this.currentTab?"1,2":"3"}),success:t=>{if(console.log("è®¢å•åˆ—è¡¨è¯·æ±‚æˆåŠŸ:",t),200!==t.statusCode)return void a({title:`è¯·æ±‚å¤±è´¥ï¼šçŠ¶æ€ç  ${t.statusCode}`,icon:"none"});if(!t.data||!t.data.orders)return a({title:"æœªè·å–åˆ°è®¢å•æ•°æ®",icon:"none"}),void console.warn("è®¢å•æ•°æ®ç»“æ„å¼‚å¸¸:",t.data);const s=t.data.orders.map((t=>({id:t.id,order_number:t.orderNumber,user_id:t.userId,scheduled_duration:t.scheduledDuration,actual_duration:t.actualDuration,price:t.price,discount:t.discount,amount_paid:t.amountPaid,storage_location_name:t.storageLocationName,cabinet_id:t.cabinetId,status:t.status,deposit_status:t.depositStatus})));this.orders=1===this.page?s:[...this.orders,...s],this.total=t.data.total||0,0===this.orders.length&&a({title:0===this.currentTab?"æš‚æ— å½“å‰è®¢å•":"æš‚æ— å†å²è®¢å•",icon:"none"})},fail:t=>{console.error("è·å–è®¢å•å¤±è´¥ - è¯¦ç»†é”™è¯¯:",t),a({title:`è·å–è®¢å•å¤±è´¥ï¼š${t.errMsg||"æœªçŸ¥é”™è¯¯"}`,icon:"none"})},complete:()=>{this.loading=!1}})},handleHomeClick(){a({title:"é¦–é¡µ",icon:"none"})},handleOrdersClick(){a({title:"è®¢å•é¡µé¢",icon:"none"})},handleMyClick(){s({url:"/pages/my/my"})},onReachBottom(){this.orders.length<this.total&&(this.page++,this.fetchOrders())},onPullDownRefresh(){this.page=1,this.orders=[],this.fetchOrders(),e()},goToOrderDetail(t){s({url:`/pages/show/show?id=${t}`})}}},[["render",function(t,a,s,e,k,C){const v=m,y=o,T=p,O=b;return d(),r(y,{class:"order-page-container"},{default:l((()=>[i(y,{class:"header-bar"},{default:l((()=>[i(v,{class:"header-title"},{default:l((()=>[c("æˆ‘çš„è®¢å•")])),_:1}),i(y,{class:"header-icons"},{default:l((()=>[i(v,{class:"iconfont"},{default:l((()=>[c("î˜‹")])),_:1}),i(v,{class:"iconfont"},{default:l((()=>[c("î˜")])),_:1})])),_:1})])),_:1}),i(y,{class:"order-tabs"},{default:l((()=>[i(y,{class:n(["tab-item",0===k.currentTab?"active":""]),onClick:a[0]||(a[0]=t=>C.switchTab(0))},{default:l((()=>[c("å½“å‰è®¢å•")])),_:1},8,["class"]),i(y,{class:n(["tab-item",1===k.currentTab?"active":""]),onClick:a[1]||(a[1]=t=>C.switchTab(1))},{default:l((()=>[c("å†å²è®¢å•")])),_:1},8,["class"])])),_:1}),0===k.currentTab||1===k.currentTab?(d(),r(y,{key:0,class:"order-list"},{default:l((()=>[k.loading?(d(),r(y,{key:0,class:"loading-container"},{default:l((()=>[i(v,{class:"loading-text"},{default:l((()=>[c("åŠ è½½ä¸­...")])),_:1})])),_:1})):k.orders.length>0?(d(!0),u(f,{key:1},_(k.orders,((t,a)=>(d(),r(y,{key:t.id,class:"order-card",onClick:a=>C.goToOrderDetail(t.id)},{default:l((()=>[i(y,{class:"order-card-main"},{default:l((()=>[i(T,{src:"/static/locker-image.jpg",class:"order-img",mode:"aspectFill"},null,8,["src"]),i(y,{class:"order-info"},{default:l((()=>[i(y,{class:"order-title-row"},{default:l((()=>[i(v,{class:"order-title"},{default:l((()=>[c(h(t.storage_location_name),1)])),_:2},1024),i(v,{class:n(["order-status",1===t.status?"status-pending":3===t.status?"status-done":""])},{default:l((()=>[c(h(1===t.status?"å¾…æ”¯ä»˜":2===t.status?"å¯„å­˜ä¸­":3===t.status?"å·²å®Œæˆ":4===t.status?"å·²å–æ¶ˆ":5===t.status?"è¶…æ—¶":6===t.status?"å¼‚å¸¸":""),1)])),_:2},1032,["class"]),1===t.deposit_status?(d(),r(v,{key:0,class:"order-badge"},{default:l((()=>[c("æŠ¼é‡‘å·²æ”¯ä»˜")])),_:1})):2===t.deposit_status?(d(),r(v,{key:1,class:"order-badge"},{default:l((()=>[c("æŠ¼é‡‘å·²é€€è¿˜")])),_:1})):3===t.deposit_status?(d(),r(v,{key:2,class:"order-badge"},{default:l((()=>[c("æŠ¼é‡‘å·²æ‰£é™¤")])),_:1})):g("",!0)])),_:2},1024),i(v,{class:"order-desc"},{default:l((()=>[c("è®¢å•å·ï¼š"+h(t.order_number),1)])),_:2},1024),i(v,{class:"order-location"},{default:l((()=>[c("æŸœå­IDï¼š"+h(t.cabinet_id),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),i(y,{class:"order-card-footer"},{default:l((()=>[i(v,{class:"order-timer"},{default:l((()=>[c("è®¡åˆ’æ—¶é•¿"+h(t.scheduled_duration)+"å°æ—¶ï¼Œå®ç”¨"+h(t.actual_duration)+"å°æ—¶",1)])),_:2},1024),i(y,{class:"order-actions"},{default:l((()=>[2===t.status?(d(),r(O,{key:0,class:"order-btn primary"},{default:l((()=>[c("å–å‡º")])),_:1})):g("",!0),3===t.status?(d(),r(O,{key:1,class:"order-btn default"},{default:l((()=>[c("å»è¯„ä»·")])),_:1})):g("",!0),i(y,{class:n(["order-status-badge","status-"+t.status])},{default:l((()=>[i(v,{class:"status-text"},{default:l((()=>[c(h(1===t.status?"å¾…æ”¯ä»˜":2===t.status?"å¯„å­˜ä¸­":3===t.status?"å·²å®Œæˆ":4===t.status?"å·²å–æ¶ˆ":5===t.status?"è¶…æ—¶":6===t.status?"å¼‚å¸¸":""),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)):(d(),r(y,{key:2,class:"order-list empty"},{default:l((()=>[i(v,{class:"empty-text"},{default:l((()=>[c(h(0===k.currentTab?"æš‚æ— å½“å‰è®¢å•":"æš‚æ— å†å²è®¢å•"),1)])),_:1})])),_:1}))])),_:1})):g("",!0),i(y,{class:"bottom-nav"},{default:l((()=>[i(y,{class:"nav-item",onClick:C.handleHomeClick},{default:l((()=>[i(v,{class:"nav-icon"},{default:l((()=>[c("ğŸ ")])),_:1}),i(v,{class:"nav-text"},{default:l((()=>[c("é¦–é¡µ")])),_:1})])),_:1},8,["onClick"]),i(y,{class:"nav-item active",onClick:C.handleOrdersClick},{default:l((()=>[i(v,{class:"nav-icon"},{default:l((()=>[c("ğŸ“‹")])),_:1}),i(v,{class:"nav-text"},{default:l((()=>[c("è®¢å•")])),_:1})])),_:1},8,["onClick"]),i(y,{class:"nav-item",onClick:C.handleMyClick},{default:l((()=>[i(v,{class:"nav-icon"},{default:l((()=>[c("ğŸ‘¤")])),_:1}),i(v,{class:"nav-text"},{default:l((()=>[c("æˆ‘çš„")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-66208322"]]);export{C as default};
