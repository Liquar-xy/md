import{r as e,a as t,s as a,O as s,v as r,e as l,w as o,i as d,o as c,f as i,j as n,n as u,C as _,D as f,F as h,t as g,x as m,k as p,l as b,u as k}from"./index-C_HCjYUn.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=C({data:()=>({currentTab:0,orders:[],total:0,page:1,size:20,storage_location_name:"",loading:!1}),onLoad(){this.fetchOrders()},methods:{switchTab(e){this.currentTab!==e&&(this.currentTab=e,this.page=1,this.orders=[],this.fetchOrders())},fetchOrders(){this.loading=!0,e({url:"http://127.0.0.1:8000/v1/orders/list",method:"POST",header:{"Content-Type":"application/json"},data:JSON.stringify({page:this.page,size:this.size,storage_location_name:this.storage_location_name,status:0===this.currentTab?"1,2":"3"}),success:e=>{if(console.log("订单列表请求成功:",e),200!==e.statusCode)return void t({title:`请求失败：状态码 ${e.statusCode}`,icon:"none"});if(!e.data||!e.data.orders)return t({title:"未获取到订单数据",icon:"none"}),void console.warn("订单数据结构异常:",e.data);const a=e.data.orders.map((e=>({id:e.id,order_number:e.orderNumber,user_id:e.userId,scheduled_duration:e.scheduledDuration,actual_duration:e.actualDuration,price:e.price,discount:e.discount,amount_paid:e.amountPaid,storage_location_name:e.storageLocationName,cabinet_id:e.cabinetId,status:e.status,deposit_status:e.depositStatus})));this.orders=1===this.page?a:[...this.orders,...a],this.total=e.data.total||0,0===this.orders.length&&t({title:0===this.currentTab?"暂无当前订单":"暂无历史订单",icon:"none"})},fail:e=>{console.error("获取订单失败 - 详细错误:",e),t({title:`获取订单失败：${e.errMsg||"未知错误"}`,icon:"none"})},complete:()=>{this.loading=!1}})},handleHomeClick(){a({url:"/pages/index/index",fail:e=>{console.error("切换到首页失败:",e),t({title:"页面跳转失败",icon:"none"})}})},handleOrdersClick(){console.log("当前已在订单页面")},handleMyClick(){a({url:"/pages/my/my",fail:e=>{console.error("切换到我的页面失败:",e),t({title:"页面跳转失败",icon:"none"})}})},onReachBottom(){this.orders.length<this.total&&(this.page++,this.fetchOrders())},onPullDownRefresh(){this.page=1,this.orders=[],this.fetchOrders(),s()},goToOrderDetail(e){r({url:`/pages/show/show?id=${e}`})},goToCreateOrder(){r({url:"/pages/ordercreate/ordercreate"})},goToCreateStorage(){r({url:"/pages/createtimetask/createtimetask"})},handleRefund(e){e&&e.id?r({url:`/pages/orderdel/orderdel?id=${e.id}&orderNumber=${e.order_number}&status=${e.status}`,fail:e=>{console.error("跳转退款页面失败:",e),t({title:"页面跳转失败",icon:"none"})}}):t({title:"订单信息异常",icon:"none"})}}},[["render",function(e,t,a,s,r,C){const T=p,y=b,v=d,x=k;return c(),l(v,{class:"order-page-container"},{default:o((()=>[i(v,{class:"fixed-header"},{default:o((()=>[i(v,{class:"header-bar"},{default:o((()=>[i(T,{class:"header-title"},{default:o((()=>[n("我的订单")])),_:1}),i(v,{class:"header-actions"},{default:o((()=>[i(y,{class:"create-order-btn",onClick:C.goToCreateOrder},{default:o((()=>[i(T,{class:"create-btn-text"},{default:o((()=>[n("+ 创建订单")])),_:1})])),_:1},8,["onClick"]),i(y,{class:"create-storage-btn",onClick:C.goToCreateStorage},{default:o((()=>[i(T,{class:"create-btn-text"},{default:o((()=>[n("+ 创建寄存")])),_:1})])),_:1},8,["onClick"]),i(v,{class:"header-icons"},{default:o((()=>[i(T,{class:"iconfont"},{default:o((()=>[n("")])),_:1}),i(T,{class:"iconfont"},{default:o((()=>[n("")])),_:1})])),_:1})])),_:1})])),_:1}),i(v,{class:"order-tabs"},{default:o((()=>[i(v,{class:u(["tab-item",0===r.currentTab?"active":""]),onClick:t[0]||(t[0]=e=>C.switchTab(0))},{default:o((()=>[n("当前订单")])),_:1},8,["class"]),i(v,{class:u(["tab-item",1===r.currentTab?"active":""]),onClick:t[1]||(t[1]=e=>C.switchTab(1))},{default:o((()=>[n("历史订单")])),_:1},8,["class"])])),_:1})])),_:1}),i(v,{class:"header-placeholder"}),0===r.currentTab||1===r.currentTab?(c(),l(v,{key:0,class:"order-list"},{default:o((()=>[r.loading?(c(),l(v,{key:0,class:"loading-container"},{default:o((()=>[i(T,{class:"loading-text"},{default:o((()=>[n("加载中...")])),_:1})])),_:1})):r.orders.length>0?(c(!0),_(h,{key:1},f(r.orders,((e,t)=>(c(),l(v,{key:e.id,class:"order-card",onClick:t=>C.goToOrderDetail(e.id)},{default:o((()=>[i(v,{class:"order-card-main"},{default:o((()=>[i(x,{src:"/static/locker-image.jpg",class:"order-img",mode:"aspectFill"},null,8,["src"]),i(v,{class:"order-info"},{default:o((()=>[i(v,{class:"order-title-row"},{default:o((()=>[i(T,{class:"order-title"},{default:o((()=>[n(g(e.storage_location_name),1)])),_:2},1024),i(T,{class:u(["order-status",1===e.status?"status-pending":3===e.status?"status-done":""])},{default:o((()=>[n(g(1===e.status?"待支付":2===e.status?"寄存中":3===e.status?"已完成":4===e.status?"已取消":5===e.status?"超时":6===e.status?"异常":""),1)])),_:2},1032,["class"]),1===e.deposit_status?(c(),l(T,{key:0,class:"order-badge"},{default:o((()=>[n("押金已支付")])),_:1})):2===e.deposit_status?(c(),l(T,{key:1,class:"order-badge"},{default:o((()=>[n("押金已退还")])),_:1})):3===e.deposit_status?(c(),l(T,{key:2,class:"order-badge"},{default:o((()=>[n("押金已扣除")])),_:1})):m("",!0)])),_:2},1024),i(T,{class:"order-desc"},{default:o((()=>[n("订单号："+g(e.order_number),1)])),_:2},1024),i(T,{class:"order-location"},{default:o((()=>[n("柜子ID："+g(e.cabinet_id),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),i(v,{class:"order-card-footer"},{default:o((()=>[i(T,{class:"order-timer"},{default:o((()=>[n("计划时长"+g(e.scheduled_duration)+"小时，实用"+g(e.actual_duration)+"小时",1)])),_:2},1024),i(v,{class:"order-actions"},{default:o((()=>[2===e.status?(c(),l(y,{key:0,class:"order-btn primary"},{default:o((()=>[n("取出")])),_:1})):m("",!0),3===e.status?(c(),l(y,{key:1,class:"order-btn default"},{default:o((()=>[n("去评价")])),_:1})):m("",!0),1===e.status||2===e.status?(c(),l(y,{key:2,class:"order-btn refund",onClick:t=>C.handleRefund(e)},{default:o((()=>[n("退款")])),_:2},1032,["onClick"])):m("",!0),i(v,{class:u(["order-status-badge","status-"+e.status])},{default:o((()=>[i(T,{class:"status-text"},{default:o((()=>[n(g(1===e.status?"待支付":2===e.status?"寄存中":3===e.status?"已完成":4===e.status?"已取消":5===e.status?"超时":6===e.status?"异常":""),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)):(c(),l(v,{key:2,class:"order-list empty"},{default:o((()=>[i(T,{class:"empty-text"},{default:o((()=>[n(g(0===r.currentTab?"暂无当前订单":"暂无历史订单"),1)])),_:1})])),_:1}))])),_:1})):m("",!0),i(v,{class:"bottom-nav"},{default:o((()=>[i(v,{class:"nav-item",onClick:C.handleHomeClick},{default:o((()=>[i(T,{class:"nav-icon"},{default:o((()=>[n("🏠")])),_:1}),i(T,{class:"nav-text"},{default:o((()=>[n("首页")])),_:1})])),_:1},8,["onClick"]),i(v,{class:"nav-item active",onClick:C.handleOrdersClick},{default:o((()=>[i(T,{class:"nav-icon"},{default:o((()=>[n("📋")])),_:1}),i(T,{class:"nav-text"},{default:o((()=>[n("订单")])),_:1})])),_:1},8,["onClick"]),i(v,{class:"nav-item",onClick:C.handleMyClick},{default:o((()=>[i(T,{class:"nav-icon"},{default:o((()=>[n("👤")])),_:1}),i(T,{class:"nav-text"},{default:o((()=>[n("我的")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-e1042bb9"]]);export{T as default};
