import{g as e,a as t,b as s,r as l,h as a,c as i,p as o,e as n,w as d,i as r,o as g,f as c,j as u,t as h,n as p,x as m,k as y,I as D,l as f}from"./index-BgeTyoVd.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=S({data:()=>({networkId:null,networkName:"",chargingMode:"timed",hasData:!1,timedSettings:{smallHourlyRate:"",smallDailyCap:"",largeHourlyRate:"",largeDailyCap:""},dailySettings:{smallDailyRate:"",largeDailyRate:""},freeDuration:"",depositSettings:{smallDeposit:"",largeDeposit:""}}),onLoad(e){this.networkId=e.id||1,this.networkName=decodeURIComponent(e.name||"æœªå‘½åç½‘ç‚¹"),console.log("æ”¶è´¹è§„åˆ™é¡µé¢åŠ è½½ - ç½‘ç‚¹ID:",this.networkId,"åç§°:",this.networkName),setTimeout((()=>{this.loadPriceData()}),100)},onShow(){console.log("é¡µé¢æ˜¾ç¤º - ç½‘ç‚¹ID:",this.networkId),this.loadPriceData()},methods:{loadPriceData(){console.log("å¼€å§‹åŠ è½½ä»·æ ¼æ•°æ®ï¼Œç½‘ç‚¹ID:",this.networkId);const s=e(`price_rule_${this.networkId}`);console.log("æœ¬åœ°å­˜å‚¨æ•°æ®:",s),s?(console.log("æ‰¾åˆ°æœ¬åœ°ä¿å­˜çš„æ•°æ®:",s),this.loadPriceRules(s),t({title:"åŠ è½½æœ¬åœ°ä¿å­˜çš„é…ç½®",icon:"success",duration:1e3})):(console.log("æ²¡æœ‰æœ¬åœ°æ•°æ®ï¼Œä»æœåŠ¡å™¨è·å–"),this.getPriceRule())},setChargingMode(e){this.chargingMode=e},onFreeDurationChange(e){const t=e.detail.value.replace(/[^0-9.]/g,""),s=t.split(".");s.length>2?this.freeDuration=s[0]+"."+s.slice(1).join(""):this.freeDuration=t,console.log("å…è´¹æ—¶é•¿å·²æ›´æ–°:",this.freeDuration)},getPriceRule(){console.log("æ­£åœ¨è·å–ä»·æ ¼è§„åˆ™ï¼Œç½‘ç‚¹ID:",this.networkId),s({title:"åŠ è½½ä¸­..."}),l({url:`http://localhost:8000/admin/getPriceRule?networkId=${this.networkId}`,method:"GET",header:{"Content-Type":"application/json"},success:s=>{if(a(),console.log("è·å–ä»·æ ¼è§„åˆ™è¿”å›:",s),s.data&&200===s.data.code&&s.data.rules&&s.data.rules.length>0)console.log("æ‰¾åˆ°ä»·æ ¼è§„åˆ™æ•°æ®ï¼Œå¼€å§‹åŠ è½½"),this.loadPriceRules(s.data.rules),this.hasData=!0,t({title:"æ•°æ®åŠ è½½æˆåŠŸ",icon:"success",duration:1e3});else{console.log("æ²¡æœ‰æ‰¾åˆ°ä»·æ ¼è§„åˆ™æ•°æ®æˆ–æ•°æ®ä¸ºç©º"),console.log("å“åº”æ•°æ®è¯¦æƒ…:",s.data);const l=e(`price_rule_${this.networkId}`);l?(console.log("ä»æœ¬åœ°å­˜å‚¨æ¢å¤æ•°æ®:",l),this.loadPriceRules(l),this.hasData=!0,t({title:"ä½¿ç”¨æœ¬åœ°ä¿å­˜çš„é…ç½®",icon:"success",duration:1e3})):(this.resetFormData(),this.hasData=!1,t({title:"æš‚æ— ä»·æ ¼è§„åˆ™æ•°æ®",icon:"none",duration:1500}))}},fail:s=>{a(),console.error("è·å–ä»·æ ¼è§„åˆ™å¤±è´¥:",s);const l=e(`price_rule_${this.networkId}`);l?(console.log("ç½‘ç»œå¤±è´¥ï¼Œä»æœ¬åœ°å­˜å‚¨æ¢å¤æ•°æ®:",l),this.loadPriceRules(l),this.hasData=!0,t({title:"ä½¿ç”¨æœ¬åœ°ä¿å­˜çš„é…ç½®",icon:"success",duration:1e3})):t({title:"è·å–æ•°æ®å¤±è´¥",icon:"none",duration:3e3})}})},loadPriceRules(e){if(console.log("å¼€å§‹åŠ è½½ä»·æ ¼è§„åˆ™:",e),this.hasData=!0,e.chargingMode)return console.log("åŠ è½½æœ¬åœ°å­˜å‚¨çš„æ•°æ®"),this.chargingMode=e.chargingMode,this.freeDuration=e.freeDuration||"",this.timedSettings=e.timedSettings||{smallHourlyRate:"",smallDailyCap:"",largeHourlyRate:"",largeDailyCap:""},this.dailySettings=e.dailySettings||{smallDailyRate:"",largeDailyRate:""},this.depositSettings=e.depositSettings||{smallDeposit:"",largeDeposit:""},console.log("=== æœ¬åœ°æ•°æ®åŠ è½½ç»“æœ ==="),console.log("è®¡æ—¶è®¾ç½®:",this.timedSettings),console.log("æŒ‰æ—¥è®¾ç½®:",this.dailySettings),console.log("æŠ¼é‡‘è®¾ç½®:",this.depositSettings),console.log("å…è´¹æ—¶é•¿:",this.freeDuration),console.log("æ”¶è´¹æ¨¡å¼:",this.chargingMode),console.log("æ•°æ®çŠ¶æ€:",this.hasData),void(this.hasData=!0);if(console.log("åŠ è½½åç«¯APIçš„æ•°æ®"),this.timedSettings={smallHourlyRate:"",smallDailyCap:"",largeHourlyRate:"",largeDailyCap:""},this.dailySettings={smallDailyRate:"",largeDailyRate:""},this.depositSettings={smallDeposit:"",largeDeposit:""},this.freeDuration="",e.length>0){const t=e[0];this.freeDuration=(t.freeDuration||0).toString(),this.chargingMode=1===t.feeType?"timed":"daily",console.log("è®¾ç½®å…è´¹æ—¶é•¿:",this.freeDuration),console.log("è®¾ç½®æ”¶è´¹æ¨¡å¼:",this.chargingMode)}e.forEach((e=>{console.log("å¤„ç†è§„åˆ™:",e),1===e.lockerType?(1===e.feeType?(this.timedSettings.smallHourlyRate=(e.hourlyRate||0).toString(),this.timedSettings.smallDailyCap=(e.dailyCap||0).toString(),console.log("å°æŸœå­è®¡æ—¶æ”¶è´¹è®¾ç½®:",this.timedSettings.smallHourlyRate,this.timedSettings.smallDailyCap)):(this.dailySettings.smallDailyRate=(e.dailyRate||0).toString(),console.log("å°æŸœå­æŒ‰æ—¥æ”¶è´¹è®¾ç½®:",this.dailySettings.smallDailyRate)),this.depositSettings.smallDeposit=(e.depositAmount||0).toString(),console.log("å°æŸœå­æŠ¼é‡‘è®¾ç½®:",this.depositSettings.smallDeposit)):2===e.lockerType&&(1===e.feeType?(this.timedSettings.largeHourlyRate=(e.hourlyRate||0).toString(),this.timedSettings.largeDailyCap=(e.dailyCap||0).toString(),console.log("å¤§æŸœå­è®¡æ—¶æ”¶è´¹è®¾ç½®:",this.timedSettings.largeHourlyRate,this.timedSettings.largeDailyCap)):(this.dailySettings.largeDailyRate=(e.dailyRate||0).toString(),console.log("å¤§æŸœå­æŒ‰æ—¥æ”¶è´¹è®¾ç½®:",this.dailySettings.largeDailyRate)),this.depositSettings.largeDeposit=(e.depositAmount||0).toString(),console.log("å¤§æŸœå­æŠ¼é‡‘è®¾ç½®:",this.depositSettings.largeDeposit))})),console.log("=== æœ€ç»ˆåŠ è½½ç»“æœ ==="),console.log("è®¡æ—¶è®¾ç½®:",this.timedSettings),console.log("æŒ‰æ—¥è®¾ç½®:",this.dailySettings),console.log("æŠ¼é‡‘è®¾ç½®:",this.depositSettings),console.log("å…è´¹æ—¶é•¿:",this.freeDuration),console.log("æ”¶è´¹æ¨¡å¼:",this.chargingMode),console.log("æ•°æ®çŠ¶æ€:",this.hasData)},savePriceRule(){if((parseFloat(this.freeDuration)||0)<0)return void t({title:"å…è´¹æ—¶é•¿ä¸èƒ½ä¸ºè´Ÿæ•°",icon:"none"});let o=!1;if("timed"===this.chargingMode){const e=parseFloat(this.timedSettings.smallHourlyRate)||0,t=parseFloat(this.timedSettings.largeHourlyRate)||0;o=e>0||t>0}else{const e=parseFloat(this.dailySettings.smallDailyRate)||0,t=parseFloat(this.dailySettings.largeDailyRate)||0;o=e>0||t>0}if(!o)return void t({title:"è¯·è‡³å°‘è®¾ç½®ä¸€ä¸ªæŸœå­çš„ä»·æ ¼",icon:"none"});s({title:"æ­£åœ¨ä¿å­˜..."});const n=[];"timed"===this.chargingMode?(n.push({ruleName:"å°æŸœå­è®¡æ—¶æ”¶è´¹",feeType:1,lockerType:1,freeDuration:parseFloat(this.freeDuration)||0,hourlyRate:parseFloat(this.timedSettings.smallHourlyRate)||0,dailyCap:parseFloat(this.timedSettings.smallDailyCap)||0,depositAmount:parseFloat(this.depositSettings.smallDeposit)||0,isDepositEnabled:parseFloat(this.depositSettings.smallDeposit)>0,isAdvancePay:!1}),n.push({ruleName:"å¤§æŸœå­è®¡æ—¶æ”¶è´¹",feeType:1,lockerType:2,freeDuration:parseFloat(this.freeDuration)||0,hourlyRate:parseFloat(this.timedSettings.largeHourlyRate)||0,dailyCap:parseFloat(this.timedSettings.largeDailyCap)||0,depositAmount:parseFloat(this.depositSettings.largeDeposit)||0,isDepositEnabled:parseFloat(this.depositSettings.largeDeposit)>0,isAdvancePay:!1})):(n.push({ruleName:"å°æŸœå­æŒ‰æ—¥æ”¶è´¹",feeType:2,lockerType:1,freeDuration:parseFloat(this.freeDuration)||0,dailyRate:parseFloat(this.dailySettings.smallDailyRate)||0,depositAmount:parseFloat(this.depositSettings.smallDeposit)||0,isDepositEnabled:parseFloat(this.depositSettings.smallDeposit)>0,isAdvancePay:!1}),n.push({ruleName:"å¤§æŸœå­æŒ‰æ—¥æ”¶è´¹",feeType:2,lockerType:2,freeDuration:parseFloat(this.freeDuration)||0,dailyRate:parseFloat(this.dailySettings.largeDailyRate)||0,depositAmount:parseFloat(this.depositSettings.largeDeposit)||0,isDepositEnabled:parseFloat(this.depositSettings.largeDeposit)>0,isAdvancePay:!1}));const d={networkId:parseInt(this.networkId),rules:n};console.log("=== ä¿å­˜ä»·æ ¼è§„åˆ™ ==="),console.log("ç½‘ç‚¹ID:",this.networkId),console.log("æ”¶è´¹æ¨¡å¼:",this.chargingMode),console.log("å…è´¹æ—¶é•¿:",this.freeDuration),console.log("è®¡æ—¶è®¾ç½®:",this.timedSettings),console.log("æŒ‰æ—¥è®¾ç½®:",this.dailySettings),console.log("æŠ¼é‡‘è®¾ç½®:",this.depositSettings),console.log("è¯·æ±‚æ•°æ®:",d),l({url:"http://localhost:8000/admin/setPriceRule",method:"POST",data:d,header:{"Content-Type":"application/json",Authorization:"Bearer "+e("adminToken")},success:s=>{var l;if(a(),console.log("ä¿å­˜ä»·æ ¼è§„åˆ™è¿”å›:",s),s.data&&200===s.data.code){this.hasData=!0,t({title:"ä¿å­˜æˆåŠŸ",icon:"success",duration:2e3}),console.log("=== ä¿å­˜æˆåŠŸï¼Œä¿å­˜åˆ°æœ¬åœ° ==="),console.log("è®¡æ—¶è®¾ç½®:",this.timedSettings),console.log("æŒ‰æ—¥è®¾ç½®:",this.dailySettings),console.log("æŠ¼é‡‘è®¾ç½®:",this.depositSettings),console.log("å…è´¹æ—¶é•¿:",this.freeDuration),console.log("æ”¶è´¹æ¨¡å¼:",this.chargingMode);const s={networkId:this.networkId,chargingMode:this.chargingMode,freeDuration:this.freeDuration,timedSettings:this.timedSettings,dailySettings:this.dailySettings,depositSettings:this.depositSettings};i(`price_rule_${this.networkId}`,s),console.log("æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨:",s);const l=e(`price_rule_${this.networkId}`);console.log("éªŒè¯ä¿å­˜ç»“æœ:",l),this.hasData=!0,t({title:"ä¿å­˜æˆåŠŸï¼Œæ•°æ®å·²å­˜å‚¨",icon:"success",duration:2e3})}else t({title:(null==(l=s.data)?void 0:l.msg)||"ä¿å­˜å¤±è´¥",icon:"none",duration:3e3})},fail:e=>{a(),console.error("ä¿å­˜ä»·æ ¼è§„åˆ™å¤±è´¥:",e),t({title:"ç½‘ç»œé”™è¯¯",icon:"none",duration:3e3})}})},resetFormData(){this.hasData=!1,this.timedSettings={smallHourlyRate:"",smallDailyCap:"",largeHourlyRate:"",largeDailyCap:""},this.dailySettings={smallDailyRate:"",largeDailyRate:""},this.depositSettings={smallDeposit:"",largeDeposit:""},this.freeDuration="",this.chargingMode="timed",console.log("è¡¨å•æ•°æ®å·²é‡ç½®")},refreshData(){console.log("æ‰‹åŠ¨åˆ·æ–°æ•°æ®"),this.hasData=!1,this.getPriceRule()},goBack(){o()}}},[["render",function(e,t,s,l,a,i){const o=y,S=r,_=D,R=f;return g(),n(S,{class:"price-rule"},{default:d((()=>[c(S,{class:"header"},{default:d((()=>[c(S,{class:"header-left",onClick:i.goBack},{default:d((()=>[c(o,{class:"back-icon"},{default:d((()=>[u("â†")])),_:1})])),_:1},8,["onClick"]),c(o,{class:"header-title"},{default:d((()=>[u("æ”¶è´¹è§„åˆ™")])),_:1}),c(S,{class:"header-right"},{default:d((()=>[c(o,{class:"menu-icon"},{default:d((()=>[u("â‹¯")])),_:1}),c(o,{class:"target-icon"},{default:d((()=>[u("â—‹")])),_:1})])),_:1})])),_:1}),c(S,{class:"network-info"},{default:d((()=>[c(o,{class:"network-title"},{default:d((()=>[u("ç½‘ç‚¹: "+h(a.networkName),1)])),_:1}),a.hasData?(g(),n(S,{key:0,class:"data-status"},{default:d((()=>[c(o,{class:"status-text"},{default:d((()=>[u("âœ… å·²åŠ è½½ä¿å­˜çš„é…ç½®")])),_:1})])),_:1})):(g(),n(S,{key:1,class:"data-status"},{default:d((()=>[c(o,{class:"status-text"},{default:d((()=>[u("ğŸ“ ä½¿ç”¨é»˜è®¤é…ç½®")])),_:1})])),_:1}))])),_:1}),c(S,{class:"charging-mode"},{default:d((()=>[c(o,{class:"section-title"},{default:d((()=>[u("æ”¶è´¹æ¨¡å¼")])),_:1}),c(S,{class:"mode-buttons"},{default:d((()=>[c(S,{class:p(["mode-btn",{active:"timed"===a.chargingMode}]),onClick:t[0]||(t[0]=e=>i.setChargingMode("timed"))},{default:d((()=>[u(" è®¡æ—¶æ”¶è´¹ ")])),_:1},8,["class"]),c(S,{class:p(["mode-btn",{active:"daily"===a.chargingMode}]),onClick:t[1]||(t[1]=e=>i.setChargingMode("daily"))},{default:d((()=>[u(" æŒ‰æ—¥æ”¶è´¹ ")])),_:1},8,["class"])])),_:1})])),_:1}),c(S,{class:"price-settings"},{default:d((()=>[c(o,{class:"section-title"},{default:d((()=>[u("ä»·æ ¼è®¾ç½®")])),_:1}),"timed"===a.chargingMode?(g(),n(S,{key:0,class:"timed-settings"},{default:d((()=>[c(S,{class:"setting-item"},{default:d((()=>[c(o,{class:"setting-label"},{default:d((()=>[u("å°æŸœå­:")])),_:1}),c(_,{class:"setting-input",type:"text",modelValue:a.timedSettings.smallHourlyRate,"onUpdate:modelValue":t[2]||(t[2]=e=>a.timedSettings.smallHourlyRate=e),placeholder:"0"},null,8,["modelValue"]),c(o,{class:"setting-unit"},{default:d((()=>[u("å…ƒ/å°æ—¶")])),_:1})])),_:1}),c(S,{class:"setting-item"},{default:d((()=>[c(o,{class:"setting-label"},{default:d((()=>[u("å°æŸœå­24å°æ—¶å†…å°é¡¶è´¹ç”¨:")])),_:1}),c(_,{class:"setting-input",type:"text",modelValue:a.timedSettings.smallDailyCap,"onUpdate:modelValue":t[3]||(t[3]=e=>a.timedSettings.smallDailyCap=e),placeholder:"0"},null,8,["modelValue"]),c(o,{class:"setting-unit"},{default:d((()=>[u("å…ƒ")])),_:1})])),_:1}),c(S,{class:"setting-item"},{default:d((()=>[c(o,{class:"setting-label"},{default:d((()=>[u("å¤§æŸœå­:")])),_:1}),c(_,{class:"setting-input",type:"text",modelValue:a.timedSettings.largeHourlyRate,"onUpdate:modelValue":t[4]||(t[4]=e=>a.timedSettings.largeHourlyRate=e),placeholder:"0"},null,8,["modelValue"]),c(o,{class:"setting-unit"},{default:d((()=>[u("å…ƒ/å°æ—¶")])),_:1})])),_:1}),c(S,{class:"setting-item"},{default:d((()=>[c(o,{class:"setting-label"},{default:d((()=>[u("å¤§æŸœå­24å°æ—¶å†…å°é¡¶è´¹ç”¨:")])),_:1}),c(_,{class:"setting-input",type:"text",modelValue:a.timedSettings.largeDailyCap,"onUpdate:modelValue":t[5]||(t[5]=e=>a.timedSettings.largeDailyCap=e),placeholder:"0"},null,8,["modelValue"]),c(o,{class:"setting-unit"},{default:d((()=>[u("å…ƒ")])),_:1})])),_:1})])),_:1})):m("",!0),"daily"===a.chargingMode?(g(),n(S,{key:1,class:"daily-settings"},{default:d((()=>[c(S,{class:"setting-item"},{default:d((()=>[c(o,{class:"setting-label"},{default:d((()=>[u("å°æŸœå­:")])),_:1}),c(_,{class:"setting-input",type:"text",modelValue:a.dailySettings.smallDailyRate,"onUpdate:modelValue":t[6]||(t[6]=e=>a.dailySettings.smallDailyRate=e),placeholder:"0"},null,8,["modelValue"]),c(o,{class:"setting-unit"},{default:d((()=>[u("å…ƒ/æ—¥")])),_:1})])),_:1}),c(S,{class:"setting-item"},{default:d((()=>[c(o,{class:"setting-label"},{default:d((()=>[u("å¤§æŸœå­:")])),_:1}),c(_,{class:"setting-input",type:"text",modelValue:a.dailySettings.largeDailyRate,"onUpdate:modelValue":t[7]||(t[7]=e=>a.dailySettings.largeDailyRate=e),placeholder:"0"},null,8,["modelValue"]),c(o,{class:"setting-unit"},{default:d((()=>[u("å…ƒ/æ—¥")])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1}),c(S,{class:"free-duration"},{default:d((()=>[c(o,{class:"section-title"},{default:d((()=>[u("å…è´¹æ—¶é•¿")])),_:1}),c(S,{class:"free-duration-row"},{default:d((()=>[c(o,{class:"free-duration-label"},{default:d((()=>[u("å¯„å­˜åå‰")])),_:1}),c(_,{class:"free-duration-input",type:"text",modelValue:a.freeDuration,"onUpdate:modelValue":t[8]||(t[8]=e=>a.freeDuration=e),placeholder:"0",onInput:i.onFreeDurationChange},null,8,["modelValue","onInput"]),"timed"===a.chargingMode?(g(),n(o,{key:0,class:"free-duration-unit"},{default:d((()=>[u("åˆ†é’Ÿå†…å–å‡ºç»“æŸè®¢å•ä¸æ”¶å–è´¹ç”¨ã€‚")])),_:1})):(g(),n(o,{key:1,class:"free-duration-unit"},{default:d((()=>[u("å°æ—¶å†…å–å‡ºç»“æŸè®¢å•ä¸æ”¶å–è´¹ç”¨ã€‚")])),_:1}))])),_:1})])),_:1}),c(S,{class:"deposit"},{default:d((()=>[c(o,{class:"section-title"},{default:d((()=>[u("æŠ¼é‡‘")])),_:1}),c(S,{class:"setting-item"},{default:d((()=>[c(o,{class:"setting-label"},{default:d((()=>[u("å°æŸœå­:")])),_:1}),c(_,{class:"setting-input",type:"text",modelValue:a.depositSettings.smallDeposit,"onUpdate:modelValue":t[9]||(t[9]=e=>a.depositSettings.smallDeposit=e),placeholder:"0"},null,8,["modelValue"]),c(o,{class:"setting-unit"},{default:d((()=>[u("å…ƒ")])),_:1})])),_:1}),c(S,{class:"setting-item"},{default:d((()=>[c(o,{class:"setting-label"},{default:d((()=>[u("å¤§æŸœå­:")])),_:1}),c(_,{class:"setting-input",type:"text",modelValue:a.depositSettings.largeDeposit,"onUpdate:modelValue":t[10]||(t[10]=e=>a.depositSettings.largeDeposit=e),placeholder:"0"},null,8,["modelValue"]),c(o,{class:"setting-unit"},{default:d((()=>[u("å…ƒ")])),_:1})])),_:1})])),_:1}),c(S,{class:"bottom-buttons"},{default:d((()=>[c(R,{class:"cancel-btn",onClick:i.goBack},{default:d((()=>[u("å–æ¶ˆ")])),_:1},8,["onClick"]),c(R,{class:"refresh-btn",onClick:i.refreshData},{default:d((()=>[u("åˆ·æ–°")])),_:1},8,["onClick"]),c(R,{class:"save-btn",onClick:i.savePriceRule},{default:d((()=>[u("ä¿å­˜")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-3f010499"]]);export{_ as default};
