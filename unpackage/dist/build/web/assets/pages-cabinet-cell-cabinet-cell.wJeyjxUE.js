import{g as e,a as l,p as t,q as s,m as a,c as o,r as i,e as n,w as c,i as d,o as u,f as r,j as g,t as h,C as m,D as _,F as C,n as f,x as p,L as S,k as b,l as k,Q as w}from"./index-C_HCjYUn.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=T({data:()=>({groupId:"",groupName:"",cellList:[],selectedCell:null,showCellModal:!1,totalCells:0,availableCells:0,occupiedCells:0,maintenanceCells:0,loading:!1,showCellStatus:!0,showCellSize:!0,viewMode:"grid",showStatusModal:!1,selectedStatus:"",showSingleStatusModal:!1,selectedCellForStatus:null,statusOptions:[{value:"normal",label:"æ­£å¸¸",color:"#52c41a",icon:"âœ“"},{value:"inUse",label:"ä½¿ç”¨ä¸­",color:"#faad14",icon:"ğŸ”’"},{value:"abnormal",label:"å¼‚å¸¸",color:"#ff7875",icon:"âš ï¸"},{value:"disabled",label:"åœç”¨",color:"#d9d9d9",icon:"ğŸš«"},{value:"damaged",label:"æŸå",color:"#ff4d4f",icon:"ğŸ’¥"}],apiBaseUrl:"http://localhost:8000"}),computed:{canManageCell(){return!!this.selectedCell&&["normal","abnormal","damaged"].includes(this.selectedCell.status)},sortedCellList(){return[...this.cellList].sort(((e,l)=>parseInt(e.cell_no)-parseInt(l.cell_no)))},allCellsOpened(){const e=this.cellList.filter((e=>["normal","inUse"].includes(e.status))),l=this.cellList.filter((e=>"inUse"===e.status));return e.length>0&&l.length===e.length}},onLoad(t){console.log("æŸœæ ¼ç®¡ç†é¡µé¢åŠ è½½:",t),this.groupId=t.groupId||"",this.groupName=decodeURIComponent(t.groupName||"æœªçŸ¥æŸœç»„");const s=e("cellViewMode");s&&(this.viewMode=s),this.groupId?this.loadCellList():l({title:"å‚æ•°é”™è¯¯",icon:"none"})},onShow(){this.groupId&&(console.log("é¡µé¢æ˜¾ç¤ºï¼Œåˆ·æ–°æŸœæ ¼æ•°æ®"),this.loadCellList())},methods:{goBack(){t()},refreshData(){this.loadCellList()},async loadCellList(){if(!this.loading){this.loading=!0;try{const e=await this.requestCellList();if(console.log("=== å¤„ç†æŸœæ ¼åˆ—è¡¨å“åº”æ•°æ® ==="),console.log("å“åº”å¯¹è±¡:",e),200!==e.code&&"200"!==e.code)throw new Error(e.msg||`æœåŠ¡å™¨è¿”å›é”™è¯¯: ${e.code}`);{const t=e.cells||[];if(console.log("è·å–åˆ°çš„æŸœæ ¼æ•°æ®:",t),console.log("æŸœæ ¼æ•°é‡:",t.length),console.log("è·å–åˆ°çš„æŸœæ ¼æ•°æ®:",t),console.log("æŸœæ ¼æ•°é‡:",t.length),!Array.isArray(t))throw new Error("æœåŠ¡å™¨è¿”å›çš„æŸœæ ¼æ•°æ®æ ¼å¼é”™è¯¯");t.forEach((e=>{e.cellSize&&!e.cell_size&&(e.cell_size=e.cellSize),e.cellNo&&!e.cell_no&&(e.cell_no=e.cellNo),e.cabinetGroupId&&!e.cabinet_group_id&&(e.cabinet_group_id=e.cabinetGroupId)})),t.length>0&&(console.log("=== æŸœæ ¼å°ºå¯¸è°ƒè¯•ä¿¡æ¯ ==="),t.forEach(((e,l)=>{console.log(`æŸœæ ¼${l+1}:`,{id:e.id,cell_no:e.cell_no,cell_size:e.cell_size,cellSize:e.cellSize,cell_size_type:typeof e.cell_size,status:e.status,"å…¨éƒ¨å­—æ®µ":e});const t=this.getCellSizeText(e.cell_size);console.log(`æŸœæ ¼${l+1}çš„å°ºå¯¸æ–‡æœ¬:`,t)}))),this.cellList=t,this.updateStats(),console.log(`âœ… åŠ è½½æŸœæ ¼åˆ—è¡¨æˆåŠŸï¼Œæ•°æ®é‡ï¼š${t.length}`),t.length>0?l({title:`åŠ è½½æˆåŠŸï¼Œå…±${t.length}ä¸ªæŸœæ ¼`,icon:"success",duration:1500}):l({title:"è¯¥æŸœç»„æš‚æ— æŸœæ ¼",icon:"none",duration:2e3})}}catch(e){console.error("âŒ åŠ è½½æŸœæ ¼åˆ—è¡¨å¤±è´¥:",e),console.log("âš ï¸ ä½¿ç”¨æ¨¡æ‹ŸæŸœæ ¼æ•°æ®ä½œä¸ºé™çº§æ–¹æ¡ˆ"),this.loadMockCellData(),l({title:"ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®",icon:"none",duration:2e3})}finally{this.loading=!1}}},updateStats(){this.totalCells=this.cellList.length,this.availableCells=this.cellList.filter((e=>"normal"===e.status)).length,this.occupiedCells=this.cellList.filter((e=>"inUse"===e.status)).length,this.maintenanceCells=this.cellList.filter((e=>["abnormal","disabled","damaged"].includes(e.status))).length,console.log("ç»Ÿè®¡æ•°æ®æ›´æ–°:",{total:this.totalCells,available:this.availableCells,occupied:this.occupiedCells,maintenance:this.maintenanceCells}),this.adjustGridColumns()},adjustGridColumns(){console.log("æŸœæ ¼æ•°æ®å·²æ›´æ–°ï¼Œå½“å‰æŸœæ ¼æ•°é‡:",this.cellList.length)},formatCellNumber(e){const l=parseInt(e);return l<10?`0${l}`:`${l}`},getCellClass:e=>({normal:"cell-available",inUse:"cell-occupied",abnormal:"cell-maintenance",disabled:"cell-maintenance",damaged:"cell-damaged"}[e]||"cell-unknown"),getCellStatusText:e=>({normal:"æ­£å¸¸",inUse:"ä½¿ç”¨ä¸­",abnormal:"å¼‚å¸¸",disabled:"ç¦ç”¨",damaged:"æŸå"}[e]||"æœªçŸ¥"),getCellSizeText:e=>({small:"å°",medium:"ä¸­",large:"å¤§"}[e]||"æœªçŸ¥"),getCellSizeClass:e=>({small:"cell-size-small",medium:"cell-size-medium",large:"cell-size-large"}[e]||"cell-size-medium"),getSizeBadgeClass:e=>({small:"size-badge-small",medium:"size-badge-medium",large:"size-badge-large"}[e]||"size-badge-medium"),getSizeIcon:e=>({small:"ğŸ“¦",medium:"ğŸ“‹",large:"ğŸ—ƒï¸"}[e]||"ğŸ“‹"),getStatusDotClass:e=>({normal:"status-dot-normal",inUse:"status-dot-inuse",abnormal:"status-dot-abnormal",disabled:"status-dot-disabled",damaged:"status-dot-damaged"}[e]||"status-dot-normal"),getStatusIndicatorClass:e=>({normal:"status-indicator-normal",inUse:"status-indicator-inuse",abnormal:"status-indicator-abnormal",disabled:"status-indicator-disabled",damaged:"status-indicator-damaged"}[e]||"status-indicator-normal"),getStatusIcon:e=>({normal:"âœ“",inUse:"ğŸ”’",abnormal:"âš ï¸",disabled:"ğŸš«",damaged:"ğŸ’¥"}[e]||"?"),getCellStyle(e){const l={small:{gridColumn:"span 1",gridRow:"span 1"},medium:{gridColumn:"span 1",gridRow:"span 1"},large:{gridColumn:"span 2",gridRow:"span 1"}};return l[e]||l.medium},handleCellClick(e){console.log("ç‚¹å‡»æŸœæ ¼:",e),"normal"===e.status?this.openCell(e):"inUse"===e.status?this.closeCell(e):l({title:`æŸœæ ¼${e.cell_no}: ${this.getCellStatusText(e.status)}`,icon:"none",duration:2e3})},handleCellLongPress(e){console.log("é•¿æŒ‰æŸœæ ¼:",e),this.selectedCell=e,s({itemList:["æŸ¥çœ‹è¯¦æƒ…","ä¿®æ”¹çŠ¶æ€"],success:l=>{0===l.tapIndex?this.showCellModal=!0:1===l.tapIndex&&this.showSingleCellStatusModal(e)}})},async openCell(e){try{const t=await this.requestOpenCell(e.id);if(200!==t.code&&"200"!==t.code)throw new Error(t.msg||"å¼€å¯å¤±è´¥");{const t=this.cellList.findIndex((l=>l.id===e.id));-1!==t&&(this.cellList[t].status="inUse",this.cellList[t].last_open_time=(new Date).toISOString(),this.updateStats()),l({title:`ç¬¬${this.getCellSequence(e)}ä¸ªæŸœæ ¼å·²å¼€å¯`,icon:"success"})}}catch(t){console.error("å¼€å¯æŸœæ ¼å¤±è´¥:",t),l({title:t.message||"å¼€å¯å¤±è´¥",icon:"none"})}},async closeCell(e){try{const t=await this.requestCloseCell(e.id);if(200!==t.code&&"200"!==t.code)throw new Error(t.msg||"å…³é—­å¤±è´¥");{const t=this.cellList.findIndex((l=>l.id===e.id));-1!==t&&(this.cellList[t].status="normal",this.updateStats()),l({title:`ç¬¬${this.getCellSequence(e)}ä¸ªæŸœæ ¼å·²å…³é—­`,icon:"success"})}}catch(t){console.error("å…³é—­æŸœæ ¼å¤±è´¥:",t),l({title:t.message||"å…³é—­å¤±è´¥",icon:"none"})}},showCellDetails(e){this.selectedCell=e,this.showCellModal=!0},toggleAllCells(){this.allCellsOpened?this.closeAllCells():this.openAllCells()},openAllCells(){const e=this.cellList.filter((e=>"normal"===e.status));0!==e.length?a({title:"ç¡®è®¤æ“ä½œ",content:`ç¡®å®šè¦å¼€å¯æ‰€æœ‰${e.length}ä¸ªæ­£å¸¸æŸœæ ¼å—ï¼Ÿ`,success:l=>{l.confirm&&this.batchOpenCells(e)}}):l({title:"æ²¡æœ‰å¯å¼€å¯çš„æŸœæ ¼",icon:"none"})},closeAllCells(){const e=this.cellList.filter((e=>"inUse"===e.status));0!==e.length?a({title:"ç¡®è®¤æ“ä½œ",content:`ç¡®å®šè¦å…³é—­æ‰€æœ‰${e.length}ä¸ªä½¿ç”¨ä¸­çš„æŸœæ ¼å—ï¼Ÿ`,success:l=>{l.confirm&&this.batchCloseCells(e)}}):l({title:"æ²¡æœ‰å¯å…³é—­çš„æŸœæ ¼",icon:"none"})},async batchOpenCells(e){try{this.loading=!0;const t=e.map((e=>this.requestOpenCell(e.id))),s=(await Promise.allSettled(t)).filter((e=>"fulfilled"===e.status&&(200===e.value.code||"200"===e.value.code))).length,a=e.length-s;e.forEach((e=>{const l=this.cellList.findIndex((l=>l.id===e.id));-1!==l&&(this.cellList[l].status="inUse",this.cellList[l].last_open_time=(new Date).toISOString())})),this.updateStats(),l(0===a?{title:`æˆåŠŸå¼€å¯${s}ä¸ªæŸœæ ¼`,icon:"success"}:{title:`å¼€å¯${s}ä¸ªæˆåŠŸï¼Œ${a}ä¸ªå¤±è´¥`,icon:"none"})}catch(t){console.error("æ‰¹é‡å¼€å¯å¤±è´¥:",t),l({title:"æ‰¹é‡å¼€å¯å¤±è´¥",icon:"none"})}finally{this.loading=!1}},async batchCloseCells(e){try{this.loading=!0;const t=e.map((e=>this.requestCloseCell(e.id))),s=(await Promise.allSettled(t)).filter((e=>"fulfilled"===e.status&&(200===e.value.code||"200"===e.value.code))).length,a=e.length-s;e.forEach((e=>{const l=this.cellList.findIndex((l=>l.id===e.id));-1!==l&&(this.cellList[l].status="normal")})),this.updateStats(),l(0===a?{title:`æˆåŠŸå…³é—­${s}ä¸ªæŸœæ ¼`,icon:"success"}:{title:`å…³é—­${s}ä¸ªæˆåŠŸï¼Œ${a}ä¸ªå¤±è´¥`,icon:"none"})}catch(t){console.error("æ‰¹é‡å…³é—­å¤±è´¥:",t),l({title:"æ‰¹é‡å…³é—­å¤±è´¥",icon:"none"})}finally{this.loading=!1}},showReport(){const e=this.totalCells,l=this.availableCells,t=this.occupiedCells,s=this.maintenanceCells,o=this.totalCells>0?(this.occupiedCells/this.totalCells*100).toFixed(1):0;a({title:"æŸœç»„çŠ¶æ€æŠ¥å‘Š",content:`æ€»æŸœæ ¼: ${e}ä¸ª\nå¯ç”¨: ${l}ä¸ª\nä½¿ç”¨ä¸­: ${t}ä¸ª\nç»´æŠ¤ä¸­: ${s}ä¸ª\nä½¿ç”¨ç‡: ${o}%`,showCancel:!1,confirmText:"ç¡®å®š"})},toggleViewMode(){this.viewMode="grid"===this.viewMode?"list":"grid",o("cellViewMode",this.viewMode),l({title:`å·²åˆ‡æ¢åˆ°${"grid"===this.viewMode?"ç½‘æ ¼":"åˆ—è¡¨"}æ¨¡å¼`,icon:"none",duration:1500})},getListItemClass:e=>`list-item-${e}`,getCellSequence(e){return this.sortedCellList.findIndex((l=>l.id===e.id))+1},showStatusModalDialog(){console.log("=== ç‚¹å‡»ä¿®æ”¹çŠ¶æ€æŒ‰é’® ==="),console.log("å½“å‰showStatusModalå€¼:",this.showStatusModal),l({title:"ä¿®æ”¹çŠ¶æ€æŒ‰é’®è¢«ç‚¹å‡»",icon:"none",duration:1e3}),this.showStatusModal=!0,this.selectedStatus="",console.log("è®¾ç½®åshowStatusModalå€¼:",this.showStatusModal),setTimeout((()=>{console.log("å»¶è¿Ÿæ£€æŸ¥showStatusModalå€¼:",this.showStatusModal)}),100)},hideStatusModal(){this.showStatusModal=!1,this.selectedStatus=""},showSingleCellStatusModal(e){console.log("æ˜¾ç¤ºå•ä¸ªæŸœæ ¼çŠ¶æ€ä¿®æ”¹å¼¹çª—:",e),this.selectedCellForStatus=e,this.selectedStatus=e.status,this.showSingleStatusModal=!0},hideSingleStatusModal(){this.showSingleStatusModal=!1,this.selectedCellForStatus=null,this.selectedStatus=""},selectStatus(e){this.selectedStatus=e},async confirmStatusChange(){if(this.selectedStatus)try{this.loading=!0;const e=this.cellList.map((e=>this.requestUpdateCellStatus(e.id,this.selectedStatus))),t=(await Promise.allSettled(e)).filter((e=>"fulfilled"===e.status&&(200===e.value.code||"200"===e.value.code))).length,s=this.cellList.length-t;this.cellList.forEach((e=>{e.status=this.selectedStatus,e.update_time=(new Date).toISOString()})),this.updateStats(),this.hideStatusModal(),l(0===s?{title:`æˆåŠŸä¿®æ”¹${t}ä¸ªæŸœæ ¼çŠ¶æ€`,icon:"success"}:{title:`ä¿®æ”¹${t}ä¸ªæˆåŠŸï¼Œ${s}ä¸ªå¤±è´¥`,icon:"none"})}catch(e){console.error("æ‰¹é‡ä¿®æ”¹çŠ¶æ€å¤±è´¥:",e),l({title:"æ‰¹é‡ä¿®æ”¹çŠ¶æ€å¤±è´¥",icon:"none"})}finally{this.loading=!1}else l({title:"è¯·é€‰æ‹©è¦ä¿®æ”¹çš„çŠ¶æ€",icon:"none"})},async confirmSingleStatusChange(){if(!this.selectedStatus||!this.selectedCellForStatus)return void l({title:"è¯·é€‰æ‹©è¦ä¿®æ”¹çš„çŠ¶æ€",icon:"none"});const e=this.selectedCellForStatus,t=e.status,s=this.selectedStatus;if(t===s)return l({title:"çŠ¶æ€æœªå‘ç”Ÿå˜åŒ–",icon:"none"}),void this.hideSingleStatusModal();try{const t=await this.requestUpdateCellStatus(e.id,s);if(200!==t.code&&"200"!==t.code)throw new Error(t.msg||"ä¿®æ”¹çŠ¶æ€å¤±è´¥");{const t=this.cellList.findIndex((l=>l.id===e.id));-1!==t&&(this.cellList[t].status=s,this.cellList[t].update_time=(new Date).toISOString(),this.updateStats()),this.hideSingleStatusModal(),l({title:`ç¬¬${this.getCellSequence(e)}ä¸ªæŸœæ ¼çŠ¶æ€å·²ä¿®æ”¹ä¸º${this.getCellStatusText(s)}`,icon:"success"})}}catch(a){console.error("ä¿®æ”¹å•ä¸ªæŸœæ ¼çŠ¶æ€å¤±è´¥:",a),l({title:a.message||"ä¿®æ”¹çŠ¶æ€å¤±è´¥",icon:"none"})}},hideCellModal(){this.showCellModal=!1,this.selectedCell=null},getCellActionText:e=>({normal:"è®¾ä¸ºç»´æŠ¤",abnormal:"è®¾ä¸ºæ­£å¸¸",disabled:"å¯ç”¨æŸœæ ¼",damaged:"æ ‡è®°ä¿®å¤"}[e]||"æ“ä½œ"),manageCellAction(){if(!this.selectedCell)return;const e=this.selectedCell;let l="",t="";switch(e.status){case"normal":l="abnormal",t="è®¾ä¸ºå¼‚å¸¸çŠ¶æ€";break;case"abnormal":l="normal",t="è®¾ä¸ºæ­£å¸¸çŠ¶æ€";break;case"disabled":l="normal",t="å¯ç”¨æŸœæ ¼";break;case"damaged":l="normal",t="æ ‡è®°ä¸ºå·²ä¿®å¤";break;default:return}a({title:"ç¡®è®¤æ“ä½œ",content:`ç¡®å®šè¦å°†æŸœæ ¼ ${this.formatCellNumber(e.cell_no)} ${t}å—ï¼Ÿ`,success:t=>{t.confirm&&this.updateCellStatus(e.id,l)}})},requestOpenCell(l){return new Promise(((t,s)=>{console.log("=== å¼€å§‹è¯·æ±‚å¼€å¯æŸœæ ¼ ==="),console.log("æŸœæ ¼ID:",l);const a=e("token")||e("adminToken")||"",o={id:l};console.log("å¼€é—¨è¯·æ±‚å‚æ•°:",o),i({url:`${this.apiBaseUrl}/v1/cabinet-cell/open`,method:"POST",header:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""},data:o,timeout:1e4,success:e=>{var l;console.log("=== å¼€é—¨APIå“åº” ==="),console.log("HTTPçŠ¶æ€ç :",e.statusCode),console.log("å“åº”æ•°æ®:",e.data),200===e.statusCode?t(e.data):s(new Error(`HTTP ${e.statusCode}: ${(null==(l=e.data)?void 0:l.msg)||"å¼€é—¨å¤±è´¥"}`))},fail:e=>{console.error("=== å¼€é—¨APIè¯·æ±‚å¤±è´¥ ==="),console.error("é”™è¯¯:",e),s(new Error(e.errMsg||"ç½‘ç»œè¯·æ±‚å¤±è´¥"))}})}))},requestCloseCell(l){return new Promise(((t,s)=>{console.log("=== å¼€å§‹è¯·æ±‚å…³é—­æŸœæ ¼ ==="),console.log("æŸœæ ¼ID:",l);const a=e("token")||e("adminToken")||"",o={id:l};console.log("å…³é—¨è¯·æ±‚å‚æ•°:",o),i({url:`${this.apiBaseUrl}/v1/cabinet-cell/close`,method:"POST",header:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""},data:o,timeout:1e4,success:e=>{var l;console.log("=== å…³é—¨APIå“åº” ==="),console.log("HTTPçŠ¶æ€ç :",e.statusCode),console.log("å“åº”æ•°æ®:",e.data),200===e.statusCode?t(e.data):s(new Error(`HTTP ${e.statusCode}: ${(null==(l=e.data)?void 0:l.msg)||"å…³é—¨å¤±è´¥"}`))},fail:e=>{console.error("=== å…³é—¨APIè¯·æ±‚å¤±è´¥ ==="),console.error("é”™è¯¯:",e),s(new Error(e.errMsg||"ç½‘ç»œè¯·æ±‚å¤±è´¥"))}})}))},requestUpdateCellStatus(l,t){return new Promise(((s,a)=>{console.log("=== å¼€å§‹è¯·æ±‚æ›´æ–°æŸœæ ¼çŠ¶æ€ ==="),console.log("æŸœæ ¼ID:",l,"æ–°çŠ¶æ€:",t);const o=e("token")||e("adminToken")||"",n={id:l,status:t};console.log("æ›´æ–°çŠ¶æ€è¯·æ±‚å‚æ•°:",n),i({url:`${this.apiBaseUrl}/v1/cabinet-cell/update`,method:"PUT",header:{"Content-Type":"application/json",Authorization:o?`Bearer ${o}`:""},data:n,timeout:1e4,success:e=>{var l;console.log("=== æ›´æ–°çŠ¶æ€APIå“åº” ==="),console.log("HTTPçŠ¶æ€ç :",e.statusCode),console.log("å“åº”æ•°æ®:",e.data),200===e.statusCode?s(e.data):a(new Error(`HTTP ${e.statusCode}: ${(null==(l=e.data)?void 0:l.msg)||"æ›´æ–°çŠ¶æ€å¤±è´¥"}`))},fail:e=>{console.error("=== æ›´æ–°çŠ¶æ€APIè¯·æ±‚å¤±è´¥ ==="),console.error("é”™è¯¯:",e),a(new Error(e.errMsg||"ç½‘ç»œè¯·æ±‚å¤±è´¥"))}})}))},loadMockCellData(){console.log("ğŸ­ ä½¿ç”¨æ¨¡æ‹ŸæŸœæ ¼æ•°æ®ä½œä¸ºé™çº§æ–¹æ¡ˆ");const e=[{id:1,cabinet_group_id:1,cell_no:1,cell_size:"small",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:2,cabinet_group_id:1,cell_no:2,cell_size:"medium",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:3,cabinet_group_id:1,cell_no:3,cell_size:"large",status:"inUse",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:4,cabinet_group_id:1,cell_no:4,cell_size:"small",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:5,cabinet_group_id:1,cell_no:5,cell_size:"medium",status:"abnormal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:6,cabinet_group_id:1,cell_no:6,cell_size:"large",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:7,cabinet_group_id:1,cell_no:7,cell_size:"small",status:"disabled",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:8,cabinet_group_id:1,cell_no:8,cell_size:"medium",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:9,cabinet_group_id:1,cell_no:9,cell_size:"large",status:"damaged",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:10,cabinet_group_id:1,cell_no:10,cell_size:"medium",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"}];this.cellList=e,this.updateStats(),console.log("âœ… æ¨¡æ‹Ÿæ•°æ®åŠ è½½å®Œæˆï¼Œå…±",e.length,"ä¸ªæŸœæ ¼"),console.log("æ¨¡æ‹Ÿæ•°æ®è¯¦æƒ…:",e)},requestCellList(){return new Promise(((l,t)=>{console.log("=== å¼€å§‹è¯·æ±‚æŸœæ ¼åˆ—è¡¨ ===");const s=e("token")||e("adminToken")||"";console.log("groupIdåŸå§‹å€¼:",this.groupId),console.log("groupIdè½¬æ¢å:",parseInt(this.groupId)),console.log("è¯·æ±‚URL:",`${this.apiBaseUrl}/v1/cabinet-cell/by-group?cabinet_group_id=${this.groupId}`),console.log("ä½¿ç”¨Token:",s?"å·²è®¾ç½®":"æœªè®¾ç½®"),i({url:`${this.apiBaseUrl}/v1/cabinet-cell/by-group?cabinet_group_id=${this.groupId}`,method:"GET",header:{"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:""},timeout:15e3,success:e=>{var s;console.log("=== æŸœæ ¼åˆ—è¡¨APIå“åº” ==="),console.log("HTTPçŠ¶æ€ç :",e.statusCode),console.log("å“åº”å¤´:",e.header),console.log("å“åº”æ•°æ®ç±»å‹:",typeof e.data),console.log("å“åº”æ•°æ®:",e.data),200===e.statusCode?e.data&&"object"==typeof e.data?(console.log("âœ… å“åº”æ•°æ®æ ¼å¼æ­£ç¡®"),l(e.data)):(console.error("âŒ å“åº”æ•°æ®æ ¼å¼é”™è¯¯:",e.data),t(new Error("å“åº”æ•°æ®æ ¼å¼é”™è¯¯"))):(console.error("âŒ HTTPçŠ¶æ€ç é”™è¯¯:",e.statusCode),t(new Error(`HTTP ${e.statusCode}: ${(null==(s=e.data)?void 0:s.msg)||"è¯·æ±‚å¤±è´¥"}`)))},fail:e=>{console.error("=== æŸœæ ¼åˆ—è¡¨APIè¯·æ±‚å¤±è´¥ ==="),console.error("é”™è¯¯å¯¹è±¡:",e),console.error("é”™è¯¯æ¶ˆæ¯:",e.errMsg);let l="ç½‘ç»œè¯·æ±‚å¤±è´¥";e.errMsg&&(l=e.errMsg.includes("timeout")?"è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":e.errMsg.includes("fail")?"æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨":e.errMsg),t(new Error(l))}})}))},updateCellStatus(e,t){const s=this.cellList.findIndex((l=>l.id===e));-1!==s&&(this.cellList[s].status=t,this.cellList[s].update_time=(new Date).toISOString(),this.updateStats(),this.selectedCell&&this.selectedCell.id===e&&(this.selectedCell.status=t),l({title:"çŠ¶æ€æ›´æ–°æˆåŠŸ",icon:"success"}))},formatTime(e){if(!e)return"";return new Date(e).toLocaleString("zh-CN")},testMockData(){console.log("ğŸ§ª å¼ºåˆ¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®è¿›è¡Œæµ‹è¯•"),this.loadMockCellData(),l({title:"å·²åŠ è½½æ¨¡æ‹Ÿæ•°æ®",icon:"success",duration:2e3})}}},[["render",function(e,l,t,s,a,o){const i=b,T=d,y=k;return u(),n(T,{class:"page"},{default:c((()=>[r(T,{class:"navbar"},{default:c((()=>[r(T,{class:"nav-left",onClick:o.goBack},{default:c((()=>[r(i,{class:"nav-icon"},{default:c((()=>[g("â€¹")])),_:1})])),_:1},8,["onClick"]),r(T,{class:"nav-center"},{default:c((()=>[r(i,{class:"nav-title"},{default:c((()=>[g(h(a.groupName)+" - æŸœæ ¼ç®¡ç†",1)])),_:1})])),_:1}),r(T,{class:"nav-right"},{default:c((()=>[r(i,{class:"nav-icon",onClick:o.refreshData},{default:c((()=>[g("âŸ²")])),_:1},8,["onClick"])])),_:1})])),_:1}),r(T,{class:"stats-section"},{default:c((()=>[r(T,{class:"stat-item"},{default:c((()=>[r(i,{class:"stat-value"},{default:c((()=>[g(h(a.totalCells),1)])),_:1}),r(i,{class:"stat-label"},{default:c((()=>[g("æ€»æŸœæ ¼")])),_:1})])),_:1}),r(T,{class:"stat-item"},{default:c((()=>[r(i,{class:"stat-value available"},{default:c((()=>[g(h(a.availableCells),1)])),_:1}),r(i,{class:"stat-label"},{default:c((()=>[g("å¯ç”¨")])),_:1})])),_:1}),r(T,{class:"stat-item"},{default:c((()=>[r(i,{class:"stat-value occupied"},{default:c((()=>[g(h(a.occupiedCells),1)])),_:1}),r(i,{class:"stat-label"},{default:c((()=>[g("å ç”¨")])),_:1})])),_:1}),r(T,{class:"stat-item"},{default:c((()=>[r(i,{class:"stat-value maintenance"},{default:c((()=>[g(h(a.maintenanceCells),1)])),_:1}),r(i,{class:"stat-label"},{default:c((()=>[g("ç»´æŠ¤")])),_:1})])),_:1})])),_:1}),r(T,{class:"action-section-enhanced"},{default:c((()=>[r(T,{class:"primary-actions"},{default:c((()=>[r(y,{class:"action-btn-primary refresh",onClick:o.refreshData},{default:c((()=>[r(i,{class:"btn-icon"},{default:c((()=>[g("âŸ²")])),_:1}),r(i,{class:"btn-text"},{default:c((()=>[g("åˆ·æ–°")])),_:1})])),_:1},8,["onClick"]),r(y,{class:"action-btn-primary toggle-all",onClick:o.toggleAllCells},{default:c((()=>[r(i,{class:"btn-icon"},{default:c((()=>[g(h(o.allCellsOpened?"ğŸ”’":"ğŸ”“"),1)])),_:1}),r(i,{class:"btn-text"},{default:c((()=>[g(h(o.allCellsOpened?"å…¨éƒ¨å…³é—­":"å…¨éƒ¨æ‰“å¼€"),1)])),_:1})])),_:1},8,["onClick"]),r(y,{class:"action-btn-primary view-mode",onClick:o.toggleViewMode},{default:c((()=>[r(i,{class:"btn-icon"},{default:c((()=>[g(h("grid"===a.viewMode?"ğŸ“‹":"âŠ"),1)])),_:1}),r(i,{class:"btn-text"},{default:c((()=>[g(h("grid"===a.viewMode?"åˆ—è¡¨":"ç½‘æ ¼"),1)])),_:1})])),_:1},8,["onClick"])])),_:1}),r(T,{class:"secondary-actions"},{default:c((()=>[r(y,{class:"action-btn-secondary report",onClick:o.showReport},{default:c((()=>[r(i,{class:"btn-icon-secondary"},{default:c((()=>[g("ğŸ“Š")])),_:1})])),_:1},8,["onClick"]),r(y,{class:"action-btn-secondary modify-status",onClick:o.showStatusModalDialog},{default:c((()=>[r(i,{class:"btn-icon-secondary"},{default:c((()=>[g("ğŸ”§")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),r(T,{class:"status-legend"},{default:c((()=>[r(i,{class:"legend-title"},{default:c((()=>[g("å•å‡»å¼€é—¨/å…³é—¨ï¼Œé•¿æŒ‰é€‰æ‹©æ“ä½œ")])),_:1}),r(T,{class:"legend-items"},{default:c((()=>[r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color normal"}),r(i,{class:"legend-text"},{default:c((()=>[g("æ­£å¸¸")])),_:1})])),_:1}),r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color in-use"}),r(i,{class:"legend-text"},{default:c((()=>[g("ä½¿ç”¨ä¸­")])),_:1})])),_:1}),r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color abnormal"}),r(i,{class:"legend-text"},{default:c((()=>[g("å¼‚å¸¸")])),_:1})])),_:1}),r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color disabled"}),r(i,{class:"legend-text"},{default:c((()=>[g("åœç”¨")])),_:1})])),_:1}),r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color damaged"}),r(i,{class:"legend-text"},{default:c((()=>[g("æŸå")])),_:1})])),_:1})])),_:1})])),_:1}),r(T,{class:"cells-container"},{default:c((()=>[a.loading?(u(),n(T,{key:0,class:"loading-state"},{default:c((()=>[r(i,{class:"loading-icon"},{default:c((()=>[g("âŸ³")])),_:1}),r(i,{class:"loading-text"},{default:c((()=>[g("å¤„ç†ä¸­...")])),_:1})])),_:1})):0===a.cellList.length?(u(),n(T,{key:1,class:"empty-state"},{default:c((()=>[r(i,{class:"empty-icon"},{default:c((()=>[g("ğŸ“¦")])),_:1}),r(i,{class:"empty-title"},{default:c((()=>[g("æš‚æ— æŸœæ ¼æ•°æ®")])),_:1}),r(i,{class:"empty-desc"},{default:c((()=>[g("è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜")])),_:1}),r(y,{class:"empty-retry-btn",onClick:o.loadCellList},{default:c((()=>[g("é‡æ–°åŠ è½½")])),_:1},8,["onClick"])])),_:1})):"grid"===a.viewMode?(u(),n(T,{key:2,class:"cells-grid-optimized"},{default:c((()=>[(u(!0),m(C,null,_(o.sortedCellList,(e=>(u(),n(T,{class:f(["cell-item-enhanced",[o.getCellClass(e.status),o.getCellSizeClass(e.cell_size)]]),key:e.id,onClick:l=>o.handleCellClick(e),onLongpress:l=>o.handleCellLongPress(e)},{default:c((()=>[r(T,{class:"cell-main-content"},{default:c((()=>[r(T,{class:"cell-header"},{default:c((()=>[r(T,{class:f(["cell-size-badge",o.getSizeBadgeClass(e.cell_size)])},{default:c((()=>[r(i,{class:"size-badge-icon"},{default:c((()=>[g(h(o.getSizeIcon(e.cell_size)),1)])),_:2},1024),r(i,{class:"size-badge-text"},{default:c((()=>[g(h(o.getCellSizeText(e.cell_size)),1)])),_:2},1024)])),_:2},1032,["class"]),r(T,{class:f(["cell-status-dot",o.getStatusDotClass(e.status)])},null,8,["class"])])),_:2},1024),r(T,{class:"cell-body"},{default:c((()=>[r(i,{class:"cell-number-enhanced"},{default:c((()=>[g(h(o.formatCellNumber(e.cell_no)),1)])),_:2},1024),r(i,{class:"cell-status-text"},{default:c((()=>[g(h(o.getCellStatusText(e.status)),1)])),_:2},1024)])),_:2},1024),r(T,{class:"cell-footer"},{default:c((()=>[r(i,{class:"cell-sequence-text"},{default:c((()=>[g("ç¬¬"+h(o.getCellSequence(e))+"ä¸ª",1)])),_:2},1024),"normal"===e.status||"inUse"===e.status?(u(),n(T,{key:0,class:"cell-action-hint"},{default:c((()=>[r(i,{class:"action-hint-text"},{default:c((()=>[g(h("normal"===e.status?"ç‚¹å‡»å¼€é—¨":"ç‚¹å‡»å…³é—¨"),1)])),_:2},1024)])),_:2},1024)):p("",!0)])),_:2},1024)])),_:2},1024),r(T,{class:f(["cell-status-indicator",o.getStatusIndicatorClass(e.status)])},{default:c((()=>[r(i,{class:"status-indicator-icon"},{default:c((()=>[g(h(o.getStatusIcon(e.status)),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1032,["class","onClick","onLongpress"])))),128))])),_:1})):(u(),n(T,{key:3,class:"cells-list"},{default:c((()=>[(u(!0),m(C,null,_(o.sortedCellList,(e=>(u(),n(T,{class:f(["list-item",o.getListItemClass(e.status)]),key:e.id,onClick:l=>o.handleCellClick(e),onLongpress:l=>o.handleCellLongPress(e)},{default:c((()=>[r(T,{class:"list-item-left"},{default:c((()=>[r(T,{class:f(["list-cell-number",o.getCellSizeClass(e.cell_size)])},{default:c((()=>[g(h(o.formatCellNumber(e.cell_no)),1)])),_:2},1032,["class"]),r(T,{class:"list-cell-info"},{default:c((()=>[r(i,{class:"list-cell-sequence"},{default:c((()=>[g("ç¬¬"+h(o.getCellSequence(e))+"ä¸ªæŸœæ ¼",1)])),_:2},1024),r(i,{class:"list-cell-size"},{default:c((()=>[g(h(o.getCellSizeText(e.cell_size))+"æ ¼",1)])),_:2},1024),e.last_open_time?(u(),n(i,{key:0,class:"list-cell-time"},{default:c((()=>[g(h(o.formatTime(e.last_open_time)),1)])),_:2},1024)):p("",!0)])),_:2},1024)])),_:2},1024),r(T,{class:"list-item-right"},{default:c((()=>[r(T,{class:f(["list-status-badge",o.getCellClass(e.status)])},{default:c((()=>[g(h(o.getCellStatusText(e.status)),1)])),_:2},1032,["class"]),r(i,{class:"list-arrow"},{default:c((()=>[g("â€º")])),_:1})])),_:2},1024)])),_:2},1032,["class","onClick","onLongpress"])))),128))])),_:1}))])),_:1}),a.showCellModal?(u(),n(T,{key:0,class:"modal-overlay",onClick:o.hideCellModal},{default:c((()=>[r(T,{class:"modal-content",onClick:l[0]||(l[0]=S((()=>{}),["stop"]))},{default:c((()=>[r(T,{class:"modal-header"},{default:c((()=>[r(i,{class:"modal-title"},{default:c((()=>{var e;return[g("æŸœæ ¼ "+h(null==(e=a.selectedCell)?void 0:e.cell_no)+" è¯¦æƒ…",1)]})),_:1}),r(i,{class:"modal-close",onClick:o.hideCellModal},{default:c((()=>[g("Ã—")])),_:1},8,["onClick"])])),_:1}),a.selectedCell?(u(),n(T,{key:0,class:"modal-body"},{default:c((()=>[r(T,{class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("æŸœæ ¼ç¼–å·:")])),_:1}),r(i,{class:"detail-value"},{default:c((()=>[g(h(a.selectedCell.cell_no),1)])),_:1})])),_:1}),r(T,{class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("æŸœæ ¼çŠ¶æ€:")])),_:1}),r(i,{class:f(["detail-value",o.getCellClass(a.selectedCell.status)])},{default:c((()=>[g(h(o.getCellStatusText(a.selectedCell.status)),1)])),_:1},8,["class"])])),_:1}),r(T,{class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("æŸœæ ¼å°ºå¯¸:")])),_:1}),r(i,{class:"detail-value"},{default:c((()=>[g(h(o.getCellSizeText(a.selectedCell.cell_size)),1)])),_:1})])),_:1}),a.selectedCell.current_order_id?(u(),n(T,{key:0,class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("å½“å‰è®¢å•:")])),_:1}),r(i,{class:"detail-value"},{default:c((()=>[g(h(a.selectedCell.current_order_id),1)])),_:1})])),_:1})):p("",!0),a.selectedCell.last_open_time?(u(),n(T,{key:1,class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("æœ€åå¼€å¯:")])),_:1}),r(i,{class:"detail-value"},{default:c((()=>[g(h(o.formatTime(a.selectedCell.last_open_time)),1)])),_:1})])),_:1})):p("",!0)])),_:1})):p("",!0),r(T,{class:"modal-actions"},{default:c((()=>[r(y,{class:"action-btn secondary",onClick:o.hideCellModal},{default:c((()=>[g("å…³é—­")])),_:1},8,["onClick"]),o.canManageCell?(u(),n(y,{key:0,class:"action-btn primary",onClick:o.manageCellAction},{default:c((()=>{var e;return[g(h(o.getCellActionText(null==(e=a.selectedCell)?void 0:e.status)),1)]})),_:1},8,["onClick"])):p("",!0)])),_:1})])),_:1})])),_:1},8,["onClick"])):p("",!0),a.showStatusModal?(u(),n(T,{key:1,class:"modal-overlay",onClick:o.hideStatusModal},{default:c((()=>[r(T,{class:"status-modal-content",onClick:l[1]||(l[1]=S((()=>{}),["stop"]))},{default:c((()=>[r(T,{class:"status-modal-header"},{default:c((()=>[r(i,{class:"status-modal-title"},{default:c((()=>[g("æ‰¹é‡ä¿®æ”¹æŸœé—¨çŠ¶æ€")])),_:1}),r(i,{class:"status-modal-subtitle"},{default:c((()=>[g("å°†ä¿®æ”¹æ‰€æœ‰æŸœæ ¼çš„çŠ¶æ€")])),_:1})])),_:1}),r(T,{class:"status-options"},{default:c((()=>[(u(!0),m(C,null,_(a.statusOptions,(e=>(u(),n(T,{class:f(["status-option",{"status-option-selected":a.selectedStatus===e.value}]),key:e.value,onClick:l=>o.selectStatus(e.value)},{default:c((()=>[r(T,{class:"status-option-content"},{default:c((()=>[r(i,{class:"status-option-icon"},{default:c((()=>[g(h(e.icon),1)])),_:2},1024),r(i,{class:"status-option-label",style:w({color:e.color})},{default:c((()=>[g(h(e.label),1)])),_:2},1032,["style"])])),_:2},1024),a.selectedStatus===e.value?(u(),n(T,{key:0,class:"status-option-check"},{default:c((()=>[r(i,{class:"check-icon"},{default:c((()=>[g("âœ“")])),_:1})])),_:1})):p("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(T,{class:"status-modal-actions"},{default:c((()=>[r(y,{class:"status-btn cancel",onClick:o.hideStatusModal},{default:c((()=>[g("å–æ¶ˆ")])),_:1},8,["onClick"]),r(y,{class:"status-btn confirm",onClick:o.confirmStatusChange,disabled:!a.selectedStatus},{default:c((()=>[g("ç¡®å®š")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["onClick"])):p("",!0),a.showSingleStatusModal?(u(),n(T,{key:2,class:"modal-overlay",onClick:o.hideSingleStatusModal},{default:c((()=>[r(T,{class:"status-modal-content",onClick:l[2]||(l[2]=S((()=>{}),["stop"]))},{default:c((()=>[r(T,{class:"status-modal-header"},{default:c((()=>[r(i,{class:"status-modal-title"},{default:c((()=>[g("ä¿®æ”¹æŸœæ ¼çŠ¶æ€")])),_:1}),a.selectedCellForStatus?(u(),n(i,{key:0,class:"status-modal-subtitle"},{default:c((()=>[g(" ç¬¬"+h(o.getCellSequence(a.selectedCellForStatus))+"ä¸ªæŸœæ ¼ ("+h(o.formatCellNumber(a.selectedCellForStatus.cell_no))+") ",1)])),_:1})):p("",!0)])),_:1}),r(T,{class:"status-options"},{default:c((()=>[(u(!0),m(C,null,_(a.statusOptions,(e=>(u(),n(T,{class:f(["status-option",{"status-option-selected":a.selectedStatus===e.value}]),key:e.value,onClick:l=>o.selectStatus(e.value)},{default:c((()=>[r(T,{class:"status-option-content"},{default:c((()=>[r(i,{class:"status-option-icon"},{default:c((()=>[g(h(e.icon),1)])),_:2},1024),r(i,{class:"status-option-label",style:w({color:e.color})},{default:c((()=>[g(h(e.label),1)])),_:2},1032,["style"])])),_:2},1024),a.selectedStatus===e.value?(u(),n(T,{key:0,class:"status-option-check"},{default:c((()=>[r(i,{class:"check-icon"},{default:c((()=>[g("âœ“")])),_:1})])),_:1})):p("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(T,{class:"status-modal-actions"},{default:c((()=>[r(y,{class:"status-btn cancel",onClick:o.hideSingleStatusModal},{default:c((()=>[g("å–æ¶ˆ")])),_:1},8,["onClick"]),r(y,{class:"status-btn confirm",onClick:o.confirmSingleStatusChange,disabled:!a.selectedStatus},{default:c((()=>[g("ç¡®å®š")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["onClick"])):p("",!0)])),_:1})}],["__scopeId","data-v-ee7161d5"]]);export{y as default};
