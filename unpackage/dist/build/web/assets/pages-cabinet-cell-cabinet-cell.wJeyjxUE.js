import{g as e,a as l,p as t,q as s,m as a,c as o,r as i,e as n,w as c,i as d,o as u,f as r,j as g,t as h,C as m,D as _,F as C,n as f,x as p,L as S,k as b,l as k,Q as w}from"./index-C_HCjYUn.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=T({data:()=>({groupId:"",groupName:"",cellList:[],selectedCell:null,showCellModal:!1,totalCells:0,availableCells:0,occupiedCells:0,maintenanceCells:0,loading:!1,showCellStatus:!0,showCellSize:!0,viewMode:"grid",showStatusModal:!1,selectedStatus:"",showSingleStatusModal:!1,selectedCellForStatus:null,statusOptions:[{value:"normal",label:"正常",color:"#52c41a",icon:"✓"},{value:"inUse",label:"使用中",color:"#faad14",icon:"🔒"},{value:"abnormal",label:"异常",color:"#ff7875",icon:"⚠️"},{value:"disabled",label:"停用",color:"#d9d9d9",icon:"🚫"},{value:"damaged",label:"损坏",color:"#ff4d4f",icon:"💥"}],apiBaseUrl:"http://localhost:8000"}),computed:{canManageCell(){return!!this.selectedCell&&["normal","abnormal","damaged"].includes(this.selectedCell.status)},sortedCellList(){return[...this.cellList].sort(((e,l)=>parseInt(e.cell_no)-parseInt(l.cell_no)))},allCellsOpened(){const e=this.cellList.filter((e=>["normal","inUse"].includes(e.status))),l=this.cellList.filter((e=>"inUse"===e.status));return e.length>0&&l.length===e.length}},onLoad(t){console.log("柜格管理页面加载:",t),this.groupId=t.groupId||"",this.groupName=decodeURIComponent(t.groupName||"未知柜组");const s=e("cellViewMode");s&&(this.viewMode=s),this.groupId?this.loadCellList():l({title:"参数错误",icon:"none"})},onShow(){this.groupId&&(console.log("页面显示，刷新柜格数据"),this.loadCellList())},methods:{goBack(){t()},refreshData(){this.loadCellList()},async loadCellList(){if(!this.loading){this.loading=!0;try{const e=await this.requestCellList();if(console.log("=== 处理柜格列表响应数据 ==="),console.log("响应对象:",e),200!==e.code&&"200"!==e.code)throw new Error(e.msg||`服务器返回错误: ${e.code}`);{const t=e.cells||[];if(console.log("获取到的柜格数据:",t),console.log("柜格数量:",t.length),console.log("获取到的柜格数据:",t),console.log("柜格数量:",t.length),!Array.isArray(t))throw new Error("服务器返回的柜格数据格式错误");t.forEach((e=>{e.cellSize&&!e.cell_size&&(e.cell_size=e.cellSize),e.cellNo&&!e.cell_no&&(e.cell_no=e.cellNo),e.cabinetGroupId&&!e.cabinet_group_id&&(e.cabinet_group_id=e.cabinetGroupId)})),t.length>0&&(console.log("=== 柜格尺寸调试信息 ==="),t.forEach(((e,l)=>{console.log(`柜格${l+1}:`,{id:e.id,cell_no:e.cell_no,cell_size:e.cell_size,cellSize:e.cellSize,cell_size_type:typeof e.cell_size,status:e.status,"全部字段":e});const t=this.getCellSizeText(e.cell_size);console.log(`柜格${l+1}的尺寸文本:`,t)}))),this.cellList=t,this.updateStats(),console.log(`✅ 加载柜格列表成功，数据量：${t.length}`),t.length>0?l({title:`加载成功，共${t.length}个柜格`,icon:"success",duration:1500}):l({title:"该柜组暂无柜格",icon:"none",duration:2e3})}}catch(e){console.error("❌ 加载柜格列表失败:",e),console.log("⚠️ 使用模拟柜格数据作为降级方案"),this.loadMockCellData(),l({title:"使用模拟数据",icon:"none",duration:2e3})}finally{this.loading=!1}}},updateStats(){this.totalCells=this.cellList.length,this.availableCells=this.cellList.filter((e=>"normal"===e.status)).length,this.occupiedCells=this.cellList.filter((e=>"inUse"===e.status)).length,this.maintenanceCells=this.cellList.filter((e=>["abnormal","disabled","damaged"].includes(e.status))).length,console.log("统计数据更新:",{total:this.totalCells,available:this.availableCells,occupied:this.occupiedCells,maintenance:this.maintenanceCells}),this.adjustGridColumns()},adjustGridColumns(){console.log("柜格数据已更新，当前柜格数量:",this.cellList.length)},formatCellNumber(e){const l=parseInt(e);return l<10?`0${l}`:`${l}`},getCellClass:e=>({normal:"cell-available",inUse:"cell-occupied",abnormal:"cell-maintenance",disabled:"cell-maintenance",damaged:"cell-damaged"}[e]||"cell-unknown"),getCellStatusText:e=>({normal:"正常",inUse:"使用中",abnormal:"异常",disabled:"禁用",damaged:"损坏"}[e]||"未知"),getCellSizeText:e=>({small:"小",medium:"中",large:"大"}[e]||"未知"),getCellSizeClass:e=>({small:"cell-size-small",medium:"cell-size-medium",large:"cell-size-large"}[e]||"cell-size-medium"),getSizeBadgeClass:e=>({small:"size-badge-small",medium:"size-badge-medium",large:"size-badge-large"}[e]||"size-badge-medium"),getSizeIcon:e=>({small:"📦",medium:"📋",large:"🗃️"}[e]||"📋"),getStatusDotClass:e=>({normal:"status-dot-normal",inUse:"status-dot-inuse",abnormal:"status-dot-abnormal",disabled:"status-dot-disabled",damaged:"status-dot-damaged"}[e]||"status-dot-normal"),getStatusIndicatorClass:e=>({normal:"status-indicator-normal",inUse:"status-indicator-inuse",abnormal:"status-indicator-abnormal",disabled:"status-indicator-disabled",damaged:"status-indicator-damaged"}[e]||"status-indicator-normal"),getStatusIcon:e=>({normal:"✓",inUse:"🔒",abnormal:"⚠️",disabled:"🚫",damaged:"💥"}[e]||"?"),getCellStyle(e){const l={small:{gridColumn:"span 1",gridRow:"span 1"},medium:{gridColumn:"span 1",gridRow:"span 1"},large:{gridColumn:"span 2",gridRow:"span 1"}};return l[e]||l.medium},handleCellClick(e){console.log("点击柜格:",e),"normal"===e.status?this.openCell(e):"inUse"===e.status?this.closeCell(e):l({title:`柜格${e.cell_no}: ${this.getCellStatusText(e.status)}`,icon:"none",duration:2e3})},handleCellLongPress(e){console.log("长按柜格:",e),this.selectedCell=e,s({itemList:["查看详情","修改状态"],success:l=>{0===l.tapIndex?this.showCellModal=!0:1===l.tapIndex&&this.showSingleCellStatusModal(e)}})},async openCell(e){try{const t=await this.requestOpenCell(e.id);if(200!==t.code&&"200"!==t.code)throw new Error(t.msg||"开启失败");{const t=this.cellList.findIndex((l=>l.id===e.id));-1!==t&&(this.cellList[t].status="inUse",this.cellList[t].last_open_time=(new Date).toISOString(),this.updateStats()),l({title:`第${this.getCellSequence(e)}个柜格已开启`,icon:"success"})}}catch(t){console.error("开启柜格失败:",t),l({title:t.message||"开启失败",icon:"none"})}},async closeCell(e){try{const t=await this.requestCloseCell(e.id);if(200!==t.code&&"200"!==t.code)throw new Error(t.msg||"关闭失败");{const t=this.cellList.findIndex((l=>l.id===e.id));-1!==t&&(this.cellList[t].status="normal",this.updateStats()),l({title:`第${this.getCellSequence(e)}个柜格已关闭`,icon:"success"})}}catch(t){console.error("关闭柜格失败:",t),l({title:t.message||"关闭失败",icon:"none"})}},showCellDetails(e){this.selectedCell=e,this.showCellModal=!0},toggleAllCells(){this.allCellsOpened?this.closeAllCells():this.openAllCells()},openAllCells(){const e=this.cellList.filter((e=>"normal"===e.status));0!==e.length?a({title:"确认操作",content:`确定要开启所有${e.length}个正常柜格吗？`,success:l=>{l.confirm&&this.batchOpenCells(e)}}):l({title:"没有可开启的柜格",icon:"none"})},closeAllCells(){const e=this.cellList.filter((e=>"inUse"===e.status));0!==e.length?a({title:"确认操作",content:`确定要关闭所有${e.length}个使用中的柜格吗？`,success:l=>{l.confirm&&this.batchCloseCells(e)}}):l({title:"没有可关闭的柜格",icon:"none"})},async batchOpenCells(e){try{this.loading=!0;const t=e.map((e=>this.requestOpenCell(e.id))),s=(await Promise.allSettled(t)).filter((e=>"fulfilled"===e.status&&(200===e.value.code||"200"===e.value.code))).length,a=e.length-s;e.forEach((e=>{const l=this.cellList.findIndex((l=>l.id===e.id));-1!==l&&(this.cellList[l].status="inUse",this.cellList[l].last_open_time=(new Date).toISOString())})),this.updateStats(),l(0===a?{title:`成功开启${s}个柜格`,icon:"success"}:{title:`开启${s}个成功，${a}个失败`,icon:"none"})}catch(t){console.error("批量开启失败:",t),l({title:"批量开启失败",icon:"none"})}finally{this.loading=!1}},async batchCloseCells(e){try{this.loading=!0;const t=e.map((e=>this.requestCloseCell(e.id))),s=(await Promise.allSettled(t)).filter((e=>"fulfilled"===e.status&&(200===e.value.code||"200"===e.value.code))).length,a=e.length-s;e.forEach((e=>{const l=this.cellList.findIndex((l=>l.id===e.id));-1!==l&&(this.cellList[l].status="normal")})),this.updateStats(),l(0===a?{title:`成功关闭${s}个柜格`,icon:"success"}:{title:`关闭${s}个成功，${a}个失败`,icon:"none"})}catch(t){console.error("批量关闭失败:",t),l({title:"批量关闭失败",icon:"none"})}finally{this.loading=!1}},showReport(){const e=this.totalCells,l=this.availableCells,t=this.occupiedCells,s=this.maintenanceCells,o=this.totalCells>0?(this.occupiedCells/this.totalCells*100).toFixed(1):0;a({title:"柜组状态报告",content:`总柜格: ${e}个\n可用: ${l}个\n使用中: ${t}个\n维护中: ${s}个\n使用率: ${o}%`,showCancel:!1,confirmText:"确定"})},toggleViewMode(){this.viewMode="grid"===this.viewMode?"list":"grid",o("cellViewMode",this.viewMode),l({title:`已切换到${"grid"===this.viewMode?"网格":"列表"}模式`,icon:"none",duration:1500})},getListItemClass:e=>`list-item-${e}`,getCellSequence(e){return this.sortedCellList.findIndex((l=>l.id===e.id))+1},showStatusModalDialog(){console.log("=== 点击修改状态按钮 ==="),console.log("当前showStatusModal值:",this.showStatusModal),l({title:"修改状态按钮被点击",icon:"none",duration:1e3}),this.showStatusModal=!0,this.selectedStatus="",console.log("设置后showStatusModal值:",this.showStatusModal),setTimeout((()=>{console.log("延迟检查showStatusModal值:",this.showStatusModal)}),100)},hideStatusModal(){this.showStatusModal=!1,this.selectedStatus=""},showSingleCellStatusModal(e){console.log("显示单个柜格状态修改弹窗:",e),this.selectedCellForStatus=e,this.selectedStatus=e.status,this.showSingleStatusModal=!0},hideSingleStatusModal(){this.showSingleStatusModal=!1,this.selectedCellForStatus=null,this.selectedStatus=""},selectStatus(e){this.selectedStatus=e},async confirmStatusChange(){if(this.selectedStatus)try{this.loading=!0;const e=this.cellList.map((e=>this.requestUpdateCellStatus(e.id,this.selectedStatus))),t=(await Promise.allSettled(e)).filter((e=>"fulfilled"===e.status&&(200===e.value.code||"200"===e.value.code))).length,s=this.cellList.length-t;this.cellList.forEach((e=>{e.status=this.selectedStatus,e.update_time=(new Date).toISOString()})),this.updateStats(),this.hideStatusModal(),l(0===s?{title:`成功修改${t}个柜格状态`,icon:"success"}:{title:`修改${t}个成功，${s}个失败`,icon:"none"})}catch(e){console.error("批量修改状态失败:",e),l({title:"批量修改状态失败",icon:"none"})}finally{this.loading=!1}else l({title:"请选择要修改的状态",icon:"none"})},async confirmSingleStatusChange(){if(!this.selectedStatus||!this.selectedCellForStatus)return void l({title:"请选择要修改的状态",icon:"none"});const e=this.selectedCellForStatus,t=e.status,s=this.selectedStatus;if(t===s)return l({title:"状态未发生变化",icon:"none"}),void this.hideSingleStatusModal();try{const t=await this.requestUpdateCellStatus(e.id,s);if(200!==t.code&&"200"!==t.code)throw new Error(t.msg||"修改状态失败");{const t=this.cellList.findIndex((l=>l.id===e.id));-1!==t&&(this.cellList[t].status=s,this.cellList[t].update_time=(new Date).toISOString(),this.updateStats()),this.hideSingleStatusModal(),l({title:`第${this.getCellSequence(e)}个柜格状态已修改为${this.getCellStatusText(s)}`,icon:"success"})}}catch(a){console.error("修改单个柜格状态失败:",a),l({title:a.message||"修改状态失败",icon:"none"})}},hideCellModal(){this.showCellModal=!1,this.selectedCell=null},getCellActionText:e=>({normal:"设为维护",abnormal:"设为正常",disabled:"启用柜格",damaged:"标记修复"}[e]||"操作"),manageCellAction(){if(!this.selectedCell)return;const e=this.selectedCell;let l="",t="";switch(e.status){case"normal":l="abnormal",t="设为异常状态";break;case"abnormal":l="normal",t="设为正常状态";break;case"disabled":l="normal",t="启用柜格";break;case"damaged":l="normal",t="标记为已修复";break;default:return}a({title:"确认操作",content:`确定要将柜格 ${this.formatCellNumber(e.cell_no)} ${t}吗？`,success:t=>{t.confirm&&this.updateCellStatus(e.id,l)}})},requestOpenCell(l){return new Promise(((t,s)=>{console.log("=== 开始请求开启柜格 ==="),console.log("柜格ID:",l);const a=e("token")||e("adminToken")||"",o={id:l};console.log("开门请求参数:",o),i({url:`${this.apiBaseUrl}/v1/cabinet-cell/open`,method:"POST",header:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""},data:o,timeout:1e4,success:e=>{var l;console.log("=== 开门API响应 ==="),console.log("HTTP状态码:",e.statusCode),console.log("响应数据:",e.data),200===e.statusCode?t(e.data):s(new Error(`HTTP ${e.statusCode}: ${(null==(l=e.data)?void 0:l.msg)||"开门失败"}`))},fail:e=>{console.error("=== 开门API请求失败 ==="),console.error("错误:",e),s(new Error(e.errMsg||"网络请求失败"))}})}))},requestCloseCell(l){return new Promise(((t,s)=>{console.log("=== 开始请求关闭柜格 ==="),console.log("柜格ID:",l);const a=e("token")||e("adminToken")||"",o={id:l};console.log("关门请求参数:",o),i({url:`${this.apiBaseUrl}/v1/cabinet-cell/close`,method:"POST",header:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""},data:o,timeout:1e4,success:e=>{var l;console.log("=== 关门API响应 ==="),console.log("HTTP状态码:",e.statusCode),console.log("响应数据:",e.data),200===e.statusCode?t(e.data):s(new Error(`HTTP ${e.statusCode}: ${(null==(l=e.data)?void 0:l.msg)||"关门失败"}`))},fail:e=>{console.error("=== 关门API请求失败 ==="),console.error("错误:",e),s(new Error(e.errMsg||"网络请求失败"))}})}))},requestUpdateCellStatus(l,t){return new Promise(((s,a)=>{console.log("=== 开始请求更新柜格状态 ==="),console.log("柜格ID:",l,"新状态:",t);const o=e("token")||e("adminToken")||"",n={id:l,status:t};console.log("更新状态请求参数:",n),i({url:`${this.apiBaseUrl}/v1/cabinet-cell/update`,method:"PUT",header:{"Content-Type":"application/json",Authorization:o?`Bearer ${o}`:""},data:n,timeout:1e4,success:e=>{var l;console.log("=== 更新状态API响应 ==="),console.log("HTTP状态码:",e.statusCode),console.log("响应数据:",e.data),200===e.statusCode?s(e.data):a(new Error(`HTTP ${e.statusCode}: ${(null==(l=e.data)?void 0:l.msg)||"更新状态失败"}`))},fail:e=>{console.error("=== 更新状态API请求失败 ==="),console.error("错误:",e),a(new Error(e.errMsg||"网络请求失败"))}})}))},loadMockCellData(){console.log("🎭 使用模拟柜格数据作为降级方案");const e=[{id:1,cabinet_group_id:1,cell_no:1,cell_size:"small",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:2,cabinet_group_id:1,cell_no:2,cell_size:"medium",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:3,cabinet_group_id:1,cell_no:3,cell_size:"large",status:"inUse",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:4,cabinet_group_id:1,cell_no:4,cell_size:"small",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:5,cabinet_group_id:1,cell_no:5,cell_size:"medium",status:"abnormal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:6,cabinet_group_id:1,cell_no:6,cell_size:"large",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:7,cabinet_group_id:1,cell_no:7,cell_size:"small",status:"disabled",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:8,cabinet_group_id:1,cell_no:8,cell_size:"medium",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:9,cabinet_group_id:1,cell_no:9,cell_size:"large",status:"damaged",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"},{id:10,cabinet_group_id:1,cell_no:10,cell_size:"medium",status:"normal",last_open_time:"2024-01-15T10:00:00Z",create_time:"2024-01-15T10:00:00Z",update_time:"2024-01-15T10:00:00Z"}];this.cellList=e,this.updateStats(),console.log("✅ 模拟数据加载完成，共",e.length,"个柜格"),console.log("模拟数据详情:",e)},requestCellList(){return new Promise(((l,t)=>{console.log("=== 开始请求柜格列表 ===");const s=e("token")||e("adminToken")||"";console.log("groupId原始值:",this.groupId),console.log("groupId转换后:",parseInt(this.groupId)),console.log("请求URL:",`${this.apiBaseUrl}/v1/cabinet-cell/by-group?cabinet_group_id=${this.groupId}`),console.log("使用Token:",s?"已设置":"未设置"),i({url:`${this.apiBaseUrl}/v1/cabinet-cell/by-group?cabinet_group_id=${this.groupId}`,method:"GET",header:{"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:""},timeout:15e3,success:e=>{var s;console.log("=== 柜格列表API响应 ==="),console.log("HTTP状态码:",e.statusCode),console.log("响应头:",e.header),console.log("响应数据类型:",typeof e.data),console.log("响应数据:",e.data),200===e.statusCode?e.data&&"object"==typeof e.data?(console.log("✅ 响应数据格式正确"),l(e.data)):(console.error("❌ 响应数据格式错误:",e.data),t(new Error("响应数据格式错误"))):(console.error("❌ HTTP状态码错误:",e.statusCode),t(new Error(`HTTP ${e.statusCode}: ${(null==(s=e.data)?void 0:s.msg)||"请求失败"}`)))},fail:e=>{console.error("=== 柜格列表API请求失败 ==="),console.error("错误对象:",e),console.error("错误消息:",e.errMsg);let l="网络请求失败";e.errMsg&&(l=e.errMsg.includes("timeout")?"请求超时，请检查网络连接":e.errMsg.includes("fail")?"无法连接到服务器，请检查后端服务是否启动":e.errMsg),t(new Error(l))}})}))},updateCellStatus(e,t){const s=this.cellList.findIndex((l=>l.id===e));-1!==s&&(this.cellList[s].status=t,this.cellList[s].update_time=(new Date).toISOString(),this.updateStats(),this.selectedCell&&this.selectedCell.id===e&&(this.selectedCell.status=t),l({title:"状态更新成功",icon:"success"}))},formatTime(e){if(!e)return"";return new Date(e).toLocaleString("zh-CN")},testMockData(){console.log("🧪 强制使用模拟数据进行测试"),this.loadMockCellData(),l({title:"已加载模拟数据",icon:"success",duration:2e3})}}},[["render",function(e,l,t,s,a,o){const i=b,T=d,y=k;return u(),n(T,{class:"page"},{default:c((()=>[r(T,{class:"navbar"},{default:c((()=>[r(T,{class:"nav-left",onClick:o.goBack},{default:c((()=>[r(i,{class:"nav-icon"},{default:c((()=>[g("‹")])),_:1})])),_:1},8,["onClick"]),r(T,{class:"nav-center"},{default:c((()=>[r(i,{class:"nav-title"},{default:c((()=>[g(h(a.groupName)+" - 柜格管理",1)])),_:1})])),_:1}),r(T,{class:"nav-right"},{default:c((()=>[r(i,{class:"nav-icon",onClick:o.refreshData},{default:c((()=>[g("⟲")])),_:1},8,["onClick"])])),_:1})])),_:1}),r(T,{class:"stats-section"},{default:c((()=>[r(T,{class:"stat-item"},{default:c((()=>[r(i,{class:"stat-value"},{default:c((()=>[g(h(a.totalCells),1)])),_:1}),r(i,{class:"stat-label"},{default:c((()=>[g("总柜格")])),_:1})])),_:1}),r(T,{class:"stat-item"},{default:c((()=>[r(i,{class:"stat-value available"},{default:c((()=>[g(h(a.availableCells),1)])),_:1}),r(i,{class:"stat-label"},{default:c((()=>[g("可用")])),_:1})])),_:1}),r(T,{class:"stat-item"},{default:c((()=>[r(i,{class:"stat-value occupied"},{default:c((()=>[g(h(a.occupiedCells),1)])),_:1}),r(i,{class:"stat-label"},{default:c((()=>[g("占用")])),_:1})])),_:1}),r(T,{class:"stat-item"},{default:c((()=>[r(i,{class:"stat-value maintenance"},{default:c((()=>[g(h(a.maintenanceCells),1)])),_:1}),r(i,{class:"stat-label"},{default:c((()=>[g("维护")])),_:1})])),_:1})])),_:1}),r(T,{class:"action-section-enhanced"},{default:c((()=>[r(T,{class:"primary-actions"},{default:c((()=>[r(y,{class:"action-btn-primary refresh",onClick:o.refreshData},{default:c((()=>[r(i,{class:"btn-icon"},{default:c((()=>[g("⟲")])),_:1}),r(i,{class:"btn-text"},{default:c((()=>[g("刷新")])),_:1})])),_:1},8,["onClick"]),r(y,{class:"action-btn-primary toggle-all",onClick:o.toggleAllCells},{default:c((()=>[r(i,{class:"btn-icon"},{default:c((()=>[g(h(o.allCellsOpened?"🔒":"🔓"),1)])),_:1}),r(i,{class:"btn-text"},{default:c((()=>[g(h(o.allCellsOpened?"全部关闭":"全部打开"),1)])),_:1})])),_:1},8,["onClick"]),r(y,{class:"action-btn-primary view-mode",onClick:o.toggleViewMode},{default:c((()=>[r(i,{class:"btn-icon"},{default:c((()=>[g(h("grid"===a.viewMode?"📋":"⊞"),1)])),_:1}),r(i,{class:"btn-text"},{default:c((()=>[g(h("grid"===a.viewMode?"列表":"网格"),1)])),_:1})])),_:1},8,["onClick"])])),_:1}),r(T,{class:"secondary-actions"},{default:c((()=>[r(y,{class:"action-btn-secondary report",onClick:o.showReport},{default:c((()=>[r(i,{class:"btn-icon-secondary"},{default:c((()=>[g("📊")])),_:1})])),_:1},8,["onClick"]),r(y,{class:"action-btn-secondary modify-status",onClick:o.showStatusModalDialog},{default:c((()=>[r(i,{class:"btn-icon-secondary"},{default:c((()=>[g("🔧")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),r(T,{class:"status-legend"},{default:c((()=>[r(i,{class:"legend-title"},{default:c((()=>[g("单击开门/关门，长按选择操作")])),_:1}),r(T,{class:"legend-items"},{default:c((()=>[r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color normal"}),r(i,{class:"legend-text"},{default:c((()=>[g("正常")])),_:1})])),_:1}),r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color in-use"}),r(i,{class:"legend-text"},{default:c((()=>[g("使用中")])),_:1})])),_:1}),r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color abnormal"}),r(i,{class:"legend-text"},{default:c((()=>[g("异常")])),_:1})])),_:1}),r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color disabled"}),r(i,{class:"legend-text"},{default:c((()=>[g("停用")])),_:1})])),_:1}),r(T,{class:"legend-item"},{default:c((()=>[r(T,{class:"legend-color damaged"}),r(i,{class:"legend-text"},{default:c((()=>[g("损坏")])),_:1})])),_:1})])),_:1})])),_:1}),r(T,{class:"cells-container"},{default:c((()=>[a.loading?(u(),n(T,{key:0,class:"loading-state"},{default:c((()=>[r(i,{class:"loading-icon"},{default:c((()=>[g("⟳")])),_:1}),r(i,{class:"loading-text"},{default:c((()=>[g("处理中...")])),_:1})])),_:1})):0===a.cellList.length?(u(),n(T,{key:1,class:"empty-state"},{default:c((()=>[r(i,{class:"empty-icon"},{default:c((()=>[g("📦")])),_:1}),r(i,{class:"empty-title"},{default:c((()=>[g("暂无柜格数据")])),_:1}),r(i,{class:"empty-desc"},{default:c((()=>[g("请检查网络连接或联系管理员")])),_:1}),r(y,{class:"empty-retry-btn",onClick:o.loadCellList},{default:c((()=>[g("重新加载")])),_:1},8,["onClick"])])),_:1})):"grid"===a.viewMode?(u(),n(T,{key:2,class:"cells-grid-optimized"},{default:c((()=>[(u(!0),m(C,null,_(o.sortedCellList,(e=>(u(),n(T,{class:f(["cell-item-enhanced",[o.getCellClass(e.status),o.getCellSizeClass(e.cell_size)]]),key:e.id,onClick:l=>o.handleCellClick(e),onLongpress:l=>o.handleCellLongPress(e)},{default:c((()=>[r(T,{class:"cell-main-content"},{default:c((()=>[r(T,{class:"cell-header"},{default:c((()=>[r(T,{class:f(["cell-size-badge",o.getSizeBadgeClass(e.cell_size)])},{default:c((()=>[r(i,{class:"size-badge-icon"},{default:c((()=>[g(h(o.getSizeIcon(e.cell_size)),1)])),_:2},1024),r(i,{class:"size-badge-text"},{default:c((()=>[g(h(o.getCellSizeText(e.cell_size)),1)])),_:2},1024)])),_:2},1032,["class"]),r(T,{class:f(["cell-status-dot",o.getStatusDotClass(e.status)])},null,8,["class"])])),_:2},1024),r(T,{class:"cell-body"},{default:c((()=>[r(i,{class:"cell-number-enhanced"},{default:c((()=>[g(h(o.formatCellNumber(e.cell_no)),1)])),_:2},1024),r(i,{class:"cell-status-text"},{default:c((()=>[g(h(o.getCellStatusText(e.status)),1)])),_:2},1024)])),_:2},1024),r(T,{class:"cell-footer"},{default:c((()=>[r(i,{class:"cell-sequence-text"},{default:c((()=>[g("第"+h(o.getCellSequence(e))+"个",1)])),_:2},1024),"normal"===e.status||"inUse"===e.status?(u(),n(T,{key:0,class:"cell-action-hint"},{default:c((()=>[r(i,{class:"action-hint-text"},{default:c((()=>[g(h("normal"===e.status?"点击开门":"点击关门"),1)])),_:2},1024)])),_:2},1024)):p("",!0)])),_:2},1024)])),_:2},1024),r(T,{class:f(["cell-status-indicator",o.getStatusIndicatorClass(e.status)])},{default:c((()=>[r(i,{class:"status-indicator-icon"},{default:c((()=>[g(h(o.getStatusIcon(e.status)),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1032,["class","onClick","onLongpress"])))),128))])),_:1})):(u(),n(T,{key:3,class:"cells-list"},{default:c((()=>[(u(!0),m(C,null,_(o.sortedCellList,(e=>(u(),n(T,{class:f(["list-item",o.getListItemClass(e.status)]),key:e.id,onClick:l=>o.handleCellClick(e),onLongpress:l=>o.handleCellLongPress(e)},{default:c((()=>[r(T,{class:"list-item-left"},{default:c((()=>[r(T,{class:f(["list-cell-number",o.getCellSizeClass(e.cell_size)])},{default:c((()=>[g(h(o.formatCellNumber(e.cell_no)),1)])),_:2},1032,["class"]),r(T,{class:"list-cell-info"},{default:c((()=>[r(i,{class:"list-cell-sequence"},{default:c((()=>[g("第"+h(o.getCellSequence(e))+"个柜格",1)])),_:2},1024),r(i,{class:"list-cell-size"},{default:c((()=>[g(h(o.getCellSizeText(e.cell_size))+"格",1)])),_:2},1024),e.last_open_time?(u(),n(i,{key:0,class:"list-cell-time"},{default:c((()=>[g(h(o.formatTime(e.last_open_time)),1)])),_:2},1024)):p("",!0)])),_:2},1024)])),_:2},1024),r(T,{class:"list-item-right"},{default:c((()=>[r(T,{class:f(["list-status-badge",o.getCellClass(e.status)])},{default:c((()=>[g(h(o.getCellStatusText(e.status)),1)])),_:2},1032,["class"]),r(i,{class:"list-arrow"},{default:c((()=>[g("›")])),_:1})])),_:2},1024)])),_:2},1032,["class","onClick","onLongpress"])))),128))])),_:1}))])),_:1}),a.showCellModal?(u(),n(T,{key:0,class:"modal-overlay",onClick:o.hideCellModal},{default:c((()=>[r(T,{class:"modal-content",onClick:l[0]||(l[0]=S((()=>{}),["stop"]))},{default:c((()=>[r(T,{class:"modal-header"},{default:c((()=>[r(i,{class:"modal-title"},{default:c((()=>{var e;return[g("柜格 "+h(null==(e=a.selectedCell)?void 0:e.cell_no)+" 详情",1)]})),_:1}),r(i,{class:"modal-close",onClick:o.hideCellModal},{default:c((()=>[g("×")])),_:1},8,["onClick"])])),_:1}),a.selectedCell?(u(),n(T,{key:0,class:"modal-body"},{default:c((()=>[r(T,{class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("柜格编号:")])),_:1}),r(i,{class:"detail-value"},{default:c((()=>[g(h(a.selectedCell.cell_no),1)])),_:1})])),_:1}),r(T,{class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("柜格状态:")])),_:1}),r(i,{class:f(["detail-value",o.getCellClass(a.selectedCell.status)])},{default:c((()=>[g(h(o.getCellStatusText(a.selectedCell.status)),1)])),_:1},8,["class"])])),_:1}),r(T,{class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("柜格尺寸:")])),_:1}),r(i,{class:"detail-value"},{default:c((()=>[g(h(o.getCellSizeText(a.selectedCell.cell_size)),1)])),_:1})])),_:1}),a.selectedCell.current_order_id?(u(),n(T,{key:0,class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("当前订单:")])),_:1}),r(i,{class:"detail-value"},{default:c((()=>[g(h(a.selectedCell.current_order_id),1)])),_:1})])),_:1})):p("",!0),a.selectedCell.last_open_time?(u(),n(T,{key:1,class:"detail-row"},{default:c((()=>[r(i,{class:"detail-label"},{default:c((()=>[g("最后开启:")])),_:1}),r(i,{class:"detail-value"},{default:c((()=>[g(h(o.formatTime(a.selectedCell.last_open_time)),1)])),_:1})])),_:1})):p("",!0)])),_:1})):p("",!0),r(T,{class:"modal-actions"},{default:c((()=>[r(y,{class:"action-btn secondary",onClick:o.hideCellModal},{default:c((()=>[g("关闭")])),_:1},8,["onClick"]),o.canManageCell?(u(),n(y,{key:0,class:"action-btn primary",onClick:o.manageCellAction},{default:c((()=>{var e;return[g(h(o.getCellActionText(null==(e=a.selectedCell)?void 0:e.status)),1)]})),_:1},8,["onClick"])):p("",!0)])),_:1})])),_:1})])),_:1},8,["onClick"])):p("",!0),a.showStatusModal?(u(),n(T,{key:1,class:"modal-overlay",onClick:o.hideStatusModal},{default:c((()=>[r(T,{class:"status-modal-content",onClick:l[1]||(l[1]=S((()=>{}),["stop"]))},{default:c((()=>[r(T,{class:"status-modal-header"},{default:c((()=>[r(i,{class:"status-modal-title"},{default:c((()=>[g("批量修改柜门状态")])),_:1}),r(i,{class:"status-modal-subtitle"},{default:c((()=>[g("将修改所有柜格的状态")])),_:1})])),_:1}),r(T,{class:"status-options"},{default:c((()=>[(u(!0),m(C,null,_(a.statusOptions,(e=>(u(),n(T,{class:f(["status-option",{"status-option-selected":a.selectedStatus===e.value}]),key:e.value,onClick:l=>o.selectStatus(e.value)},{default:c((()=>[r(T,{class:"status-option-content"},{default:c((()=>[r(i,{class:"status-option-icon"},{default:c((()=>[g(h(e.icon),1)])),_:2},1024),r(i,{class:"status-option-label",style:w({color:e.color})},{default:c((()=>[g(h(e.label),1)])),_:2},1032,["style"])])),_:2},1024),a.selectedStatus===e.value?(u(),n(T,{key:0,class:"status-option-check"},{default:c((()=>[r(i,{class:"check-icon"},{default:c((()=>[g("✓")])),_:1})])),_:1})):p("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(T,{class:"status-modal-actions"},{default:c((()=>[r(y,{class:"status-btn cancel",onClick:o.hideStatusModal},{default:c((()=>[g("取消")])),_:1},8,["onClick"]),r(y,{class:"status-btn confirm",onClick:o.confirmStatusChange,disabled:!a.selectedStatus},{default:c((()=>[g("确定")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["onClick"])):p("",!0),a.showSingleStatusModal?(u(),n(T,{key:2,class:"modal-overlay",onClick:o.hideSingleStatusModal},{default:c((()=>[r(T,{class:"status-modal-content",onClick:l[2]||(l[2]=S((()=>{}),["stop"]))},{default:c((()=>[r(T,{class:"status-modal-header"},{default:c((()=>[r(i,{class:"status-modal-title"},{default:c((()=>[g("修改柜格状态")])),_:1}),a.selectedCellForStatus?(u(),n(i,{key:0,class:"status-modal-subtitle"},{default:c((()=>[g(" 第"+h(o.getCellSequence(a.selectedCellForStatus))+"个柜格 ("+h(o.formatCellNumber(a.selectedCellForStatus.cell_no))+") ",1)])),_:1})):p("",!0)])),_:1}),r(T,{class:"status-options"},{default:c((()=>[(u(!0),m(C,null,_(a.statusOptions,(e=>(u(),n(T,{class:f(["status-option",{"status-option-selected":a.selectedStatus===e.value}]),key:e.value,onClick:l=>o.selectStatus(e.value)},{default:c((()=>[r(T,{class:"status-option-content"},{default:c((()=>[r(i,{class:"status-option-icon"},{default:c((()=>[g(h(e.icon),1)])),_:2},1024),r(i,{class:"status-option-label",style:w({color:e.color})},{default:c((()=>[g(h(e.label),1)])),_:2},1032,["style"])])),_:2},1024),a.selectedStatus===e.value?(u(),n(T,{key:0,class:"status-option-check"},{default:c((()=>[r(i,{class:"check-icon"},{default:c((()=>[g("✓")])),_:1})])),_:1})):p("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(T,{class:"status-modal-actions"},{default:c((()=>[r(y,{class:"status-btn cancel",onClick:o.hideSingleStatusModal},{default:c((()=>[g("取消")])),_:1},8,["onClick"]),r(y,{class:"status-btn confirm",onClick:o.confirmSingleStatusChange,disabled:!a.selectedStatus},{default:c((()=>[g("确定")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["onClick"])):p("",!0)])),_:1})}],["__scopeId","data-v-ee7161d5"]]);export{y as default};
