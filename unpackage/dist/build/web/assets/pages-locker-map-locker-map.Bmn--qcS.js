import{g as t,r as e,a,m as s,p as l,v as o,e as i,w as n,i as c,o as r,f as d,j as u,t as h,x as p,G as g,H as m,n as k,C as f,D as y,F as _,k as w,S as L,l as M}from"./index-BgeTyoVd.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=C({data:()=>({currentCity:"éƒ‘å·",totalLockers:0,mapInstance:null,mapReady:!1,isLoading:!0,loadingText:"æ­£åœ¨åŠ è½½åœ°å›¾...",lockers:[],selectedLocker:null,mapMarkers:[],showFilter:!1,statusFilter:"all",showList:!1}),computed:{filteredLockers(){let t=this.lockers;return"all"!==this.statusFilter&&(t=t.filter((t=>(t.status||"available")===this.statusFilter))),t}},onLoad(){console.log("å¯„å­˜ç‚¹åˆ†å¸ƒå›¾é¡µé¢åŠ è½½");const e=t("selectedCity");e&&(this.currentCity=e.name),this.$nextTick((()=>{this.initMap().catch((t=>{console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",t),this.handleError("åœ°å›¾åˆå§‹åŒ–å¤±è´¥: "+t.message)}))}))},onUnload(){console.log("é¡µé¢å¸è½½ï¼Œæ¸…ç†åœ°å›¾èµ„æº"),this.mapInstance&&(this.mapInstance=null)},methods:{async initMap(){console.log("ğŸ—ºï¸ å¼€å§‹åˆå§‹åŒ–å¯„å­˜ç‚¹åˆ†å¸ƒå›¾"),this.loadingText="æ­£åœ¨åŠ è½½ç™¾åº¦åœ°å›¾...",this.isLoading=!0;try{await this.loadBaiduMapAPI(),this.createMapInstance(),setTimeout((()=>{this.mapReady?this.loadLockersData():console.log("ç­‰å¾…åœ°å›¾åŠ è½½å®Œæˆ...")}),1500)}catch(t){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",t),this.isLoading=!1,this.handleNetworkError()}},loadBaiduMapAPI:()=>new Promise(((t,e)=>{if(void 0!==window.BMap)return void t();console.log("ğŸ“¡ åŠ è½½ç™¾åº¦åœ°å›¾JavaScript API");const a=setTimeout((()=>{e(new Error("ç™¾åº¦åœ°å›¾APIåŠ è½½è¶…æ—¶"))}),1e4),s=document.createElement("script");s.type="text/javascript",s.src="https://api.map.baidu.com/api?v=3.0&ak=9jnxn6bIxVgX1u4KffC5Cc83dTMzzYIA&callback=initLockerMapCallback",s.onerror=()=>{clearTimeout(a),e(new Error("ç™¾åº¦åœ°å›¾APIåŠ è½½å¤±è´¥"))},window.initLockerMapCallback=()=>{clearTimeout(a),console.log("âœ… ç™¾åº¦åœ°å›¾APIåŠ è½½å®Œæˆ"),delete window.initLockerMapCallback,t()},document.head.appendChild(s)})),createMapInstance(){console.log("ğŸ—ºï¸ åˆ›å»ºç™¾åº¦åœ°å›¾å®ä¾‹"),this.loadingText="æ­£åœ¨åˆ›å»ºåœ°å›¾...";try{if(void 0===window.BMap)throw new Error("ç™¾åº¦åœ°å›¾APIæœªåŠ è½½");const e=document.getElementById("lockerMapContainer");if(!e)throw new Error("åœ°å›¾å®¹å™¨æœªæ‰¾åˆ°");const a=t("selectedCity"),s=(null==a?void 0:a.coordinates)||{longitude:113.6253,latitude:34.7466};this.mapInstance=new window.BMap.Map(e);const l=new window.BMap.Point(s.longitude,s.latitude);this.mapInstance.centerAndZoom(l,12),this.mapInstance.enableScrollWheelZoom(!0),this.mapInstance.addControl(new window.BMap.NavigationControl),this.mapInstance.addControl(new window.BMap.ScaleControl),this.mapInstance.addEventListener("tilesloaded",(()=>{console.log("âœ… åœ°å›¾ç“¦ç‰‡åŠ è½½å®Œæˆ"),this.mapReady=!0,this.loadingText="",0===this.lockers.length&&setTimeout((()=>{this.loadLockersData()}),500)})),setTimeout((()=>{this.mapReady||(console.log("âš ï¸ åœ°å›¾ç“¦ç‰‡åŠ è½½è¶…æ—¶ï¼Œå¼ºåˆ¶è®¾ç½®ä¸ºå°±ç»ªçŠ¶æ€"),this.mapReady=!0,this.loadingText="",0===this.lockers.length&&this.loadLockersData())}),5e3),console.log("âœ… ç™¾åº¦åœ°å›¾å®ä¾‹åˆ›å»ºå®Œæˆ")}catch(e){console.error("âŒ åˆ›å»ºåœ°å›¾å®ä¾‹å¤±è´¥:",e),this.handleError("åˆ›å»ºåœ°å›¾å®ä¾‹å¤±è´¥: "+e.message)}},loadLockersData(){console.log("ğŸ“ å¼€å§‹åŠ è½½å¯„å­˜ç‚¹åˆ†å¸ƒæ•°æ®"),this.loadingText="æ­£åœ¨åŠ è½½å¯„å­˜ç‚¹æ•°æ®...",this.isLoading=!0;const e=t("selectedCity"),a=(null==e?void 0:e.coordinates)||{longitude:113.6253,latitude:34.7466};this.tryLoadFromAPI(a)},tryLoadFromAPI(t){const l=.1,o={northLat:t.latitude+l,southLat:t.latitude-l,eastLng:t.longitude+l,westLng:t.longitude-l},i=`http://localhost:8000/api/nearby/city/map?${new URLSearchParams({city_name:this.currentCity,north_lat:o.northLat.toString(),south_lat:o.southLat.toString(),east_lng:o.eastLng.toString(),west_lng:o.westLng.toString(),zoom_level:"12",enable_cluster:"false"}).toString()}`;console.log("ğŸ“¡ å°è¯•è°ƒç”¨å¯„å­˜ç‚¹åˆ†å¸ƒå›¾æ¥å£:",{url:i,method:"GET",params:{city_name:this.currentCity,bounds:o,zoom_level:12,enable_cluster:!1}}),console.log("ğŸ” APIè°ƒç”¨è¯¦æƒ…:"),console.log("- åŸå¸‚åç§°:",this.currentCity),console.log("- è¾¹ç•Œåæ ‡:",o),console.log("- å®Œæ•´URL:",i),e({url:i,method:"GET",header:{"Content-Type":"application/json",Accept:"application/json"},timeout:8e3,success:t=>{if(console.log("=== å¯„å­˜ç‚¹åˆ†å¸ƒå›¾æ¥å£å“åº” ==="),console.log("HTTPçŠ¶æ€ç :",t.statusCode),console.log("å“åº”æ•°æ®:",t.data),console.log("å“åº”æ•°æ®ç±»å‹:",typeof t.data),console.log("å“åº”æ•°æ®ç»“æ„:",Object.keys(t.data||{})),this.isLoading=!1,200===t.statusCode&&t.data)this.handleLockersDataSuccess(t.data);else if(401===t.statusCode)console.log("âš ï¸ APIéœ€è¦è®¤è¯ï¼Œåç«¯æœåŠ¡å¯èƒ½éœ€è¦é‡å¯"),this.loadingText="æ­£åœ¨è¿æ¥æœåŠ¡å™¨ï¼Œè¯·ç¨åé‡è¯•...",a({title:"æ­£åœ¨è¿æ¥æœåŠ¡å™¨...",icon:"loading",duration:3e3}),setTimeout((()=>{this.handleNetworkError()}),3e3);else{console.log("âš ï¸ APIè¿”å›é200çŠ¶æ€ç :",t.statusCode),console.log("âš ï¸ é”™è¯¯å“åº”æ•°æ®:",t.data),this.loadingText=`æœåŠ¡å™¨è¿”å›é”™è¯¯: ${t.statusCode}`;let e=`æœåŠ¡å™¨é”™è¯¯ (${t.statusCode})`;t.data&&t.data.message?e+=`: ${t.data.message}`:t.data&&t.data.error&&(e+=`: ${t.data.error}`),s({title:"è¯·æ±‚å¤±è´¥",content:e,showCancel:!1,confirmText:"ç¡®å®š"}),this.handleNetworkError()}},fail:t=>{console.log("âš ï¸ APIè°ƒç”¨å¤±è´¥:",t),console.log("é”™è¯¯è¯¦æƒ…:",{errMsg:t.errMsg,statusCode:t.statusCode,data:t.data}),this.isLoading=!1,this.loadingText="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œæ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®",a({title:"ç½‘ç»œè¿æ¥å¤±è´¥",icon:"none",duration:2e3}),this.handleNetworkError()}})},handleLockersDataSuccess(t){console.log("âœ… å¯„å­˜ç‚¹æ•°æ®åŠ è½½æˆåŠŸ"),console.log("åŸå§‹å“åº”æ•°æ®:",t);try{let e=[];if(t.points&&Array.isArray(t.points))e=t.points;else{if(t.clusters&&Array.isArray(t.clusters))return console.log("âš ï¸ æ”¶åˆ°èšåˆæ•°æ®ï¼Œä½†å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒèšåˆæ˜¾ç¤º"),this.loadingText="ä¸æ”¯æŒèšåˆæ•°æ®æ˜¾ç¤º",this.isLoading=!1,this.lockers=[],this.totalLockers=0,void a({title:"æ•°æ®æ ¼å¼ä¸æ”¯æŒ",icon:"none",duration:2e3});t.data&&Array.isArray(t.data)?e=t.data:t.locker_points&&Array.isArray(t.locker_points)?e=t.locker_points:t.results&&Array.isArray(t.results)?e=t.results:t.lockers&&Array.isArray(t.lockers)?e=t.lockers:Array.isArray(t)?e=t:(console.log("âš ï¸ æœªè¯†åˆ«çš„å“åº”æ•°æ®æ ¼å¼ï¼Œå°è¯•æå–æ‰€æœ‰å¯èƒ½çš„æ•°ç»„å­—æ®µ"),Object.keys(t).forEach((a=>{Array.isArray(t[a])&&t[a].length>0&&(console.log(`å‘ç°æ•°ç»„å­—æ®µ: ${a}`,t[a]),0===e.length&&(e=t[a]))})))}const s=this.processMapPointsData(e);this.lockers=s,this.totalLockers=s.length,console.log(`ğŸ“ æˆåŠŸåŠ è½½ ${this.totalLockers} ä¸ªå¯„å­˜ç‚¹`),console.log("å¤„ç†åçš„å¯„å­˜ç‚¹æ•°æ®:",s),s.length>0?(this.displayLockersOnMap(),a({title:`åŠ è½½äº†${this.totalLockers}ä¸ªå¯„å­˜ç‚¹`,icon:"success",duration:2e3})):(console.log("âš ï¸ å¤„ç†åæ— æœ‰æ•ˆå¯„å­˜ç‚¹æ•°æ®"),this.loadingText="æœªæ‰¾åˆ°å¯„å­˜ç‚¹æ•°æ®",this.isLoading=!1,this.lockers=[],this.totalLockers=0,a({title:"æœªæ‰¾åˆ°å¯„å­˜ç‚¹",icon:"none",duration:2e3}))}catch(e){console.error("âŒ å¤„ç†å¯„å­˜ç‚¹æ•°æ®å¤±è´¥:",e),this.handleError("å¤„ç†å¯„å­˜ç‚¹æ•°æ®å¤±è´¥: "+e.message)}},processLockersData:t=>(console.log("ğŸ”„ å¤„ç†å¯„å­˜ç‚¹æ•°æ®æ ¼å¼"),Array.isArray(t)&&0!==t.length?t.map(((t,e)=>{console.log(`å¤„ç†ç¬¬${e+1}ä¸ªå¯„å­˜ç‚¹:`,t);const a={id:t.id||t.locker_id||t.point_id||`map_${e+1}`,name:t.name||t.locker_name||t.point_name||t.location_name||`å¯„å­˜ç‚¹${e+1}`,address:t.address||t.location||t.location_address||t.full_address||"åœ°å€ä¿¡æ¯å¾…å®Œå–„",longitude:parseFloat(t.longitude||t.lng||t.lon||113.6253),latitude:parseFloat(t.latitude||t.lat||34.7466),large:parseInt(t.large_count||t.large||t.large_capacity||t.big_count||0),medium:parseInt(t.medium_count||t.medium||t.medium_capacity||t.mid_count||0),small:parseInt(t.small_count||t.small||t.small_capacity||0),status:t.status||t.state||(t.available?"available":"unavailable")||"available",distance:t.distance||t.dist||"0km",rating:t.rating||t.score||0,rawData:t};return console.log(`å¤„ç†åçš„ç¬¬${e+1}ä¸ªå¯„å­˜ç‚¹:`,a),a})):[]),processMapPointsData(t){return console.log("ğŸ”„ å¤„ç†åœ°å›¾APIç‚¹ä½æ•°æ®æ ¼å¼"),Array.isArray(t)&&0!==t.length?t.map(((t,e)=>{console.log(`å¤„ç†ç¬¬${e+1}ä¸ªåœ°å›¾ç‚¹ä½:`,t);const a={id:t.id||`map_${e+1}`,name:t.name||`å¯„å­˜ç‚¹${e+1}`,address:t.address||"åœ°å€ä¿¡æ¯å¾…å®Œå–„",longitude:parseFloat(t.longitude||113.6253),latitude:parseFloat(t.latitude||34.7466),totalAvailable:parseInt(t.total_available||0),large:Math.floor(.3*(t.total_available||0)),medium:Math.floor(.4*(t.total_available||0)),small:Math.floor(.3*(t.total_available||0)),status:this.mapPointStatusToLockerStatus(t.status),distance:"0km",rating:0,rawData:t};return console.log(`å¤„ç†åçš„ç¬¬${e+1}ä¸ªåœ°å›¾ç‚¹ä½:`,a),a})):[]},mapPointStatusToLockerStatus(t){switch(t){case"available":case"busy":default:return"available";case"full":return"unavailable"}},handleNetworkError(){console.log("âŒ åç«¯APIè°ƒç”¨å¤±è´¥"),this.loadingText="åç«¯æœåŠ¡è¿æ¥å¤±è´¥",this.isLoading=!1,this.lockers=[],this.totalLockers=0;const t=`æ— æ³•è·å–${this.currentCity}çš„å¯„å­˜ç‚¹æ•°æ®ã€‚\n\nå¯èƒ½çš„åŸå› ï¼š\n1. åç«¯æœåŠ¡æœªå¯åŠ¨\n2. æ•°æ®åº“ä¸­æ²¡æœ‰è¯¥åŸå¸‚çš„æ•°æ®\n3. ç½‘ç»œè¿æ¥é—®é¢˜\n\nè¯·è”ç³»ç®¡ç†å‘˜æˆ–é‡è¯•ã€‚`;s({title:"åŠ è½½å¤±è´¥",content:t,showCancel:!0,cancelText:"è¿”å›",confirmText:"é‡è¯•",success:t=>{t.confirm?this.refreshMap():l()}}),console.log("ğŸ’¡ è°ƒè¯•ä¿¡æ¯:"),console.log("- å½“å‰åŸå¸‚:",this.currentCity),console.log("- APIåœ°å€: http://localhost:8000/api/nearby/city/map"),console.log("- å»ºè®®: æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼Œæ•°æ®åº“æ˜¯å¦æœ‰åŸå¸‚æ•°æ®")},generateMockLockers(t){const e=[],a=["éƒ‘å·ä¸œç«™å¯„å­˜ç‚¹","äºŒä¸ƒå¹¿åœºå¯„å­˜ç‚¹","éƒ‘å·å¤§å­¦å¯„å­˜ç‚¹","CBDå•†åŠ¡åŒºå¯„å­˜ç‚¹","ç«è½¦ç«™å¯„å­˜ç‚¹","ç´«è†å±±å¯„å­˜ç‚¹","é‡‘æ°´è·¯å¯„å­˜ç‚¹","èŠ±å›­è·¯å¯„å­˜ç‚¹","ä¸­åŸä¸‡è¾¾å¯„å­˜ç‚¹","éƒ‘å·æœºåœºå¯„å­˜ç‚¹","é«˜é“ç«™å¯„å­˜ç‚¹","å¸‚æ”¿åºœå¯„å­˜ç‚¹"],s=["éƒ‘å·ä¸œç«™è¥¿å¹¿åœº","äºŒä¸ƒå¹¿åœºåœ°é“ç«™","éƒ‘å·å¤§å­¦å—é—¨","CBDå•†åŠ¡å†…ç¯è·¯","éƒ‘å·ç«è½¦ç«™ä¸œå¹¿åœº","ç´«è†å±±åœ°é“ç«™","é‡‘æ°´è·¯ç‰å‡¤è·¯","èŠ±å›­è·¯å†œä¸šè·¯","ä¸­åŸä¸‡è¾¾å¹¿åœº","æ–°éƒ‘å›½é™…æœºåœº","éƒ‘å·ä¸œç«™","å¸‚æ”¿åºœå¤§æ¥¼"];for(let l=0;l<12;l++){const o=.1*(Math.random()-.5),i=.1*(Math.random()-.5);e.push({id:l+1,name:a[l],address:s[l],longitude:t.longitude+o,latitude:t.latitude+i,large:Math.floor(10*Math.random())+5,medium:Math.floor(15*Math.random())+10,small:Math.floor(20*Math.random())+15,status:Math.random()>.2?"available":"unavailable",distance:(10*Math.random()+.5).toFixed(1)+"km",rating:(2*Math.random()+3).toFixed(1)})}return e},displayLockersOnMap(){this.mapInstance?(console.log("ğŸ“ åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºå¯„å­˜ç‚¹æ ‡è®°"),this.clearMapMarkers(),this.lockers.forEach(((t,e)=>{this.createLockerMarker(t,e)})),this.fitMapToMarkers()):console.error("âŒ åœ°å›¾å®ä¾‹ä¸å­˜åœ¨")},createLockerMarker(t,e){try{const e=new BMap.Point(t.longitude,t.latitude),a="available"===t.status?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent('\n\t\t\t\t\t\t\t<svg width="32" height="40" viewBox="0 0 32 40" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t<path d="M16 0C7.2 0 0 7.2 0 16c0 16 16 24 16 24s16-8 16-24C32 7.2 24.8 0 16 0z" fill="#007AFF"/>\n\t\t\t\t\t\t\t\t<circle cx="16" cy="16" r="8" fill="white"/>\n\t\t\t\t\t\t\t\t<circle cx="16" cy="16" r="4" fill="#007AFF"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t'):"data:image/svg+xml;charset=utf-8,"+encodeURIComponent('\n\t\t\t\t\t\t\t<svg width="32" height="40" viewBox="0 0 32 40" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t<path d="M16 0C7.2 0 0 7.2 0 16c0 16 16 24 16 24s16-8 16-24C32 7.2 24.8 0 16 0z" fill="#FF3B30"/>\n\t\t\t\t\t\t\t\t<circle cx="16" cy="16" r="8" fill="white"/>\n\t\t\t\t\t\t\t\t<path d="M12 12 L20 20 M20 12 L12 20" stroke="#FF3B30" stroke-width="2"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t');if(void 0===window.BMap)return void console.error("ç™¾åº¦åœ°å›¾APIä¸å¯ç”¨");const s=new window.BMap.Icon(a,new window.BMap.Size(32,40),{anchor:new window.BMap.Size(16,40)}),l=new window.BMap.Marker(e,{icon:s});l.addEventListener("click",(()=>{this.onMarkerClick(t)}));const o=`\n\t\t\t\t\t\t<div style="padding: 10px; min-width: 200px;">\n\t\t\t\t\t\t\t<h4 style="margin: 0 0 8px 0; color: #333;">${t.name||"æœªçŸ¥å¯„å­˜ç‚¹"}</h4>\n\t\t\t\t\t\t\t<p style="margin: 4px 0; color: #666; font-size: 12px;">åœ°å€: ${t.address||"åœ°å€æœªçŸ¥"}</p>\n\t\t\t\t\t\t\t<div style="margin: 8px 0;">\n\t\t\t\t\t\t\t\t<span style="margin-right: 10px; font-size: 12px;">å¤§æŸœ: ${t.large||0}</span>\n\t\t\t\t\t\t\t\t<span style="margin-right: 10px; font-size: 12px;">ä¸­æŸœ: ${t.medium||0}</span>\n\t\t\t\t\t\t\t\t<span style="font-size: 12px;">å°æŸœ: ${t.small||0}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="margin-top: 8px;">\n\t\t\t\t\t\t\t\t<span style="padding: 2px 6px; border-radius: 4px; font-size: 11px; color: white; background: ${"available"===t.status?"#007AFF":"#FF3B30"};">\n\t\t\t\t\t\t\t\t\t${"available"===t.status?"è¥ä¸šä¸­":"æš‚åœæœåŠ¡"}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,i=new window.BMap.InfoWindow(o);l.addEventListener("click",(()=>{this.mapInstance&&this.mapInstance.openInfoWindow(i,e)})),this.mapInstance&&(this.mapInstance.addOverlay(l),this.mapMarkers.push(l))}catch(a){console.error("âŒ åˆ›å»ºæ ‡è®°å¤±è´¥:",a)}},clearMapMarkers(){this.mapInstance&&this.mapMarkers.length>0&&this.mapMarkers.forEach((t=>{try{this.mapInstance.removeOverlay(t)}catch(e){console.warn("æ¸…é™¤æ ‡è®°å¤±è´¥:",e)}})),this.mapMarkers=[]},fitMapToMarkers(){if(this.mapInstance&&0!==this.lockers.length)try{if(void 0===window.BMap)return void console.error("ç™¾åº¦åœ°å›¾APIä¸å¯ç”¨");const t=this.lockers.map((t=>new window.BMap.Point(t.longitude,t.latitude)));if(t.length>0){const e=this.mapInstance.getViewport(t);this.mapInstance.centerAndZoom(e.center,e.zoom)}}catch(t){console.error("âŒ è°ƒæ•´åœ°å›¾è§†é‡å¤±è´¥:",t)}},onMarkerClick(t){console.log("ğŸ“ ç‚¹å‡»å¯„å­˜ç‚¹:",t.name),this.selectedLocker=t},selectCity(){o({url:"/pages/city-select/city-select"})},refreshMap(){console.log("ğŸ”„ åˆ·æ–°å¯„å­˜ç‚¹åˆ†å¸ƒå›¾"),this.isLoading=!0,this.loadingText="æ­£åœ¨åˆ·æ–°æ•°æ®...",this.lockers=[],this.totalLockers=0,this.selectedLocker=null,this.clearMapMarkers(),this.loadLockersData(),a({title:"æ­£åœ¨åˆ·æ–°...",icon:"loading",duration:1e3})},centerToCity(){if(this.mapInstance&&void 0!==window.BMap)try{const e=t("selectedCity"),s=(null==e?void 0:e.coordinates)||{longitude:113.6253,latitude:34.7466},l=new window.BMap.Point(s.longitude,s.latitude);this.mapInstance.centerAndZoom(l,12),a({title:"å·²å±…ä¸­åˆ°"+this.currentCity,icon:"success",duration:1500})}catch(e){console.error("å±…ä¸­åˆ°åŸå¸‚å¤±è´¥:",e)}else console.warn("åœ°å›¾å®ä¾‹ä¸å¯ç”¨")},showFilterPanel(){this.showFilter=!0},hideFilterPanel(){this.showFilter=!1},setStatusFilter(t){this.statusFilter=t,this.updateMapMarkers(),a({title:"ç­›é€‰å·²æ›´æ–°",icon:"success",duration:1e3})},updateMapMarkers(){this.clearMapMarkers(),this.filteredLockers.forEach(((t,e)=>{this.createLockerMarker(t,e)})),this.totalLockers=this.filteredLockers.length},showLockerList(){this.showList=!0},hideLockerList(){this.showList=!1},testAPI(){console.log("ğŸ”§ æµ‹è¯•APIè°ƒç”¨");const e=t("selectedCity"),a=(null==e?void 0:e.coordinates)||{longitude:113.6253,latitude:34.7466},l=`å½“å‰åŸå¸‚: ${this.currentCity}\nåæ ‡: ${a.longitude}, ${a.latitude}\nAPI: /api/nearby/city/map`;s({title:"æµ‹è¯•API",content:l+"\n\næ˜¯å¦é‡æ–°è°ƒç”¨åç«¯APIï¼Ÿ",showCancel:!0,cancelText:"å–æ¶ˆ",confirmText:"æµ‹è¯•",success:t=>{t.confirm&&this.refreshMap()}})},selectLocker(t){if(console.log("ğŸ“ é€‰æ‹©å¯„å­˜ç‚¹:",t.name),this.selectedLocker=t,this.showList=!1,this.mapInstance&&void 0!==window.BMap)try{const e=new window.BMap.Point(t.longitude,t.latitude);this.mapInstance.centerAndZoom(e,15)}catch(e){console.error("åœ°å›¾å±…ä¸­å¤±è´¥:",e)}},clearSelection(){this.selectedLocker=null},goToDetail(){this.selectedLocker&&o({url:`/pages/locker-detail/locker-detail?id=${this.selectedLocker.id}`})},getDirections(){this.selectedLocker&&s({title:"è·å–è·¯çº¿",content:`æ˜¯å¦æ‰“å¼€åœ°å›¾åº”ç”¨è·å–åˆ°"${this.selectedLocker.name}"çš„è·¯çº¿ï¼Ÿ`,success:t=>{if(t.confirm){const t=`https://uri.amap.com/navigation?to=${this.selectedLocker.longitude},${this.selectedLocker.latitude}&toname=${this.selectedLocker.name}&mode=car`;window.open(t)}}})},handleError(t){console.error("âŒ é”™è¯¯:",t),console.log("ğŸ”„ è‡ªåŠ¨åˆ‡æ¢åˆ°æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼"),this.handleNetworkError()}}},[["render",function(t,e,a,s,l,o){const C=w,v=c,b=L,x=M;return r(),i(v,{class:"page"},{default:n((()=>[d(v,{class:"header-section"},{default:n((()=>[d(v,{class:"city-info"},{default:n((()=>[d(v,{class:"city-selector",onClick:o.selectCity},{default:n((()=>[d(C,{class:"city-icon"},{default:n((()=>[u("ğŸ“")])),_:1}),d(C,{class:"city-name"},{default:n((()=>[u(h(l.currentCity),1)])),_:1}),d(C,{class:"dropdown-icon"},{default:n((()=>[u("â–¼")])),_:1})])),_:1},8,["onClick"]),d(v,{class:"locker-stats"},{default:n((()=>[d(C,{class:"stats-text"},{default:n((()=>[u("å…±æ‰¾åˆ° "+h(l.totalLockers)+" ä¸ªå¯„å­˜ç‚¹",1)])),_:1})])),_:1})])),_:1}),d(v,{class:"refresh-btn",onClick:o.refreshMap},{default:n((()=>[d(C,{class:"refresh-icon"},{default:n((()=>[u("ğŸ”„")])),_:1}),d(C,{class:"refresh-text"},{default:n((()=>[u("åˆ·æ–°")])),_:1})])),_:1},8,["onClick"])])),_:1}),d(v,{class:"map-container"},{default:n((()=>[l.mapReady?p("",!0):(r(),i(v,{key:0,class:"map-placeholder"},{default:n((()=>[d(v,{class:"placeholder-content"},{default:n((()=>[d(C,{class:"placeholder-icon"},{default:n((()=>[u("ğŸ—ºï¸")])),_:1}),d(C,{class:"placeholder-text"},{default:n((()=>[u(h(l.loadingText),1)])),_:1}),l.isLoading?(r(),i(v,{key:0,class:"loading-spinner"})):p("",!0)])),_:1})])),_:1})),g(d(v,{id:"lockerMapContainer",class:"baidu-map-container"},null,512),[[m,l.mapReady]]),d(v,{class:"map-controls"},{default:n((()=>[d(v,{class:"control-btn center-btn",onClick:o.centerToCity},{default:n((()=>[d(C,{class:"btn-icon"},{default:n((()=>[u("ğŸ¯")])),_:1}),d(C,{class:"btn-text"},{default:n((()=>[u("å±…ä¸­")])),_:1})])),_:1},8,["onClick"]),d(v,{class:"control-btn filter-btn",onClick:o.showFilterPanel},{default:n((()=>[d(C,{class:"btn-icon"},{default:n((()=>[u("ğŸ”")])),_:1}),d(C,{class:"btn-text"},{default:n((()=>[u("ç­›é€‰")])),_:1})])),_:1},8,["onClick"]),d(v,{class:"control-btn list-btn",onClick:o.showLockerList},{default:n((()=>[d(C,{class:"btn-icon"},{default:n((()=>[u("ğŸ“‹")])),_:1}),d(C,{class:"btn-text"},{default:n((()=>[u("åˆ—è¡¨")])),_:1})])),_:1},8,["onClick"]),d(v,{class:"control-btn debug-btn",onClick:o.testAPI,style:{background:"#FF6B35"}},{default:n((()=>[d(C,{class:"btn-icon"},{default:n((()=>[u("ğŸ”§")])),_:1}),d(C,{class:"btn-text"},{default:n((()=>[u("æµ‹è¯•API")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),l.showFilter?(r(),i(v,{key:0,class:"filter-panel"},{default:n((()=>[d(v,{class:"filter-header"},{default:n((()=>[d(C,{class:"filter-title"},{default:n((()=>[u("ç­›é€‰æ¡ä»¶")])),_:1}),d(C,{class:"close-btn",onClick:o.hideFilterPanel},{default:n((()=>[u("âœ•")])),_:1},8,["onClick"])])),_:1}),d(v,{class:"filter-content"},{default:n((()=>[d(v,{class:"filter-item"},{default:n((()=>[d(C,{class:"filter-label"},{default:n((()=>[u("è¥ä¸šçŠ¶æ€")])),_:1}),d(v,{class:"filter-options"},{default:n((()=>[d(v,{class:k(["filter-option",{active:"all"===l.statusFilter}]),onClick:e[0]||(e[0]=t=>o.setStatusFilter("all"))},{default:n((()=>[d(C,{class:"option-text"},{default:n((()=>[u("å…¨éƒ¨")])),_:1})])),_:1},8,["class"]),d(v,{class:k(["filter-option",{active:"available"===l.statusFilter}]),onClick:e[1]||(e[1]=t=>o.setStatusFilter("available"))},{default:n((()=>[d(C,{class:"option-text"},{default:n((()=>[u("è¥ä¸šä¸­")])),_:1})])),_:1},8,["class"]),d(v,{class:k(["filter-option",{active:"unavailable"===l.statusFilter}]),onClick:e[2]||(e[2]=t=>o.setStatusFilter("unavailable"))},{default:n((()=>[d(C,{class:"option-text"},{default:n((()=>[u("æš‚åœæœåŠ¡")])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})])),_:1})):p("",!0),l.showList?(r(),i(v,{key:1,class:"locker-list-panel"},{default:n((()=>[d(v,{class:"list-header"},{default:n((()=>[d(C,{class:"list-title"},{default:n((()=>[u(h(l.currentCity)+"å¯„å­˜ç‚¹åˆ—è¡¨",1)])),_:1}),d(C,{class:"close-btn",onClick:o.hideLockerList},{default:n((()=>[u("âœ•")])),_:1},8,["onClick"])])),_:1}),d(b,{class:"list-content","scroll-y":"true"},{default:n((()=>[(r(!0),f(_,null,y(o.filteredLockers,((t,e)=>(r(),i(v,{class:"locker-item",key:e,onClick:e=>o.selectLocker(t)},{default:n((()=>[d(v,{class:"locker-info"},{default:n((()=>[d(C,{class:"locker-name"},{default:n((()=>[u(h(t.name),1)])),_:2},1024),d(C,{class:"locker-address"},{default:n((()=>[u("ğŸ“ "+h(t.address),1)])),_:2},1024),d(v,{class:"locker-capacity"},{default:n((()=>[d(C,{class:"capacity-item large"},{default:n((()=>[u("å¤§"+h(t.large||0),1)])),_:2},1024),d(C,{class:"capacity-item medium"},{default:n((()=>[u("ä¸­"+h(t.medium||0),1)])),_:2},1024),d(C,{class:"capacity-item small"},{default:n((()=>[u("å°"+h(t.small||0),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),d(v,{class:k(["locker-status",t.status||"available"])},{default:n((()=>[d(C,{class:"status-text"},{default:n((()=>[u(h("available"!==t.status&&t.status?"æš‚åœæœåŠ¡":"è¥ä¸šä¸­"),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):p("",!0),l.selectedLocker?(r(),i(v,{key:2,class:"selected-locker-info"},{default:n((()=>[d(v,{class:"info-header"},{default:n((()=>[d(C,{class:"locker-name"},{default:n((()=>[u(h(l.selectedLocker.name),1)])),_:1}),d(C,{class:"close-btn",onClick:o.clearSelection},{default:n((()=>[u("âœ•")])),_:1},8,["onClick"])])),_:1}),d(v,{class:"info-content"},{default:n((()=>[d(C,{class:"locker-address"},{default:n((()=>[u("ğŸ“ "+h(l.selectedLocker.address),1)])),_:1}),d(v,{class:"capacity-info"},{default:n((()=>[d(v,{class:"capacity-item"},{default:n((()=>[d(C,{class:"capacity-label"},{default:n((()=>[u("å¤§æŸœ")])),_:1}),d(C,{class:"capacity-value"},{default:n((()=>[u(h(l.selectedLocker.large||0),1)])),_:1})])),_:1}),d(v,{class:"capacity-item"},{default:n((()=>[d(C,{class:"capacity-label"},{default:n((()=>[u("ä¸­æŸœ")])),_:1}),d(C,{class:"capacity-value"},{default:n((()=>[u(h(l.selectedLocker.medium||0),1)])),_:1})])),_:1}),d(v,{class:"capacity-item"},{default:n((()=>[d(C,{class:"capacity-label"},{default:n((()=>[u("å°æŸœ")])),_:1}),d(C,{class:"capacity-value"},{default:n((()=>[u(h(l.selectedLocker.small||0),1)])),_:1})])),_:1})])),_:1}),d(v,{class:"info-actions"},{default:n((()=>[d(x,{class:"action-btn primary",onClick:o.goToDetail},{default:n((()=>[u("æŸ¥çœ‹è¯¦æƒ…")])),_:1},8,["onClick"]),d(x,{class:"action-btn secondary",onClick:o.getDirections},{default:n((()=>[u("è·å–è·¯çº¿")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):p("",!0),l.isLoading?(r(),i(v,{key:3,class:"loading-overlay"},{default:n((()=>[d(v,{class:"loading-content"},{default:n((()=>[d(v,{class:"loading-spinner"}),d(C,{class:"loading-text"},{default:n((()=>[u(h(l.loadingText),1)])),_:1})])),_:1})])),_:1})):p("",!0)])),_:1})}],["__scopeId","data-v-55d2acda"]]);export{v as default};
