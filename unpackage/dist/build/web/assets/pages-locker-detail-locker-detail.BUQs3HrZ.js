import{p as e,r as s,a,v as l,e as t,w as o,i as c,o as r,f as i,j as d,t as n,C as u,D as k,F as p,x as f,k as h,u as _,E as m,l as y}from"./index-BgeTyoVd.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=g({data:()=>({lockerInfo:{name:"",address:"",locker:[]},lockerTypes:[],selectedLockerType:0,hours:["1小时","2小时","3小时","4小时","8小时"],selectedHour:0,pickupWays:["柜门扫码取件","柜门密码取件","柜台人工取件"],selectedPickupWay:0,depositResult:null,showDepositResult:!1,showChangeLocker:!1,newLockerId:null}),computed:{calcPrice(){var e;if(!this.lockerTypes.length)return"0.0";const s=this.lockerTypes[this.selectedLockerType];if(!s)return"0.0";const a=s.hourlyRate||0,l=this.hours[this.selectedHour],t=parseInt((null==(e=l.match(/\d+/))?void 0:e[0])||"1");return 0===a?"免费":(a*t).toFixed(2)}},onLoad(e){const s=e.locker_id||1;this.fetchLockerInfo(s)},methods:{goBack(){e()},onLockerTypeChange(e){this.selectedLockerType=e.detail.value},onHourChange(e){this.selectedHour=e.detail.value},onPickupWayChange(e){this.selectedPickupWay=e.detail.value},onConfirmDeposit(){const e=parseInt(this.hours[this.selectedHour].match(/\d+/)[0]),l=this.lockerTypes[this.selectedLockerType].lockerType,t=this.lockerInfo.id||1;s({url:"http://127.0.0.1:8000/deposit/createDeposit",method:"POST",data:{scheduled_duration:e,locker_type:l,cabinet_id:t},header:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTM3NTUyNDMsImlkIjoiMTIzIiwieW91cl9jdXN0b21fY2xhaW0iOiJ5b3VyX2N1c3RvbV92YWx1ZSJ9.qcdoe8dSYtfQBZgCP30Yln4r8z9ovPDEF1fNVlviWX4"},success:e=>{!e.data||200!==e.data.code&&"200"!==e.data.code?a({title:e.data.msg||"寄存失败",icon:"none"}):(this.depositResult={order_no:e.data.data.orderNo,locker_id:e.data.data.lockerId},this.showDepositResult=!0)}})},onChangeLocker(){s({url:"http://127.0.0.1:8000/deposit/updateDepositLockerId",method:"POST",data:{order_id:this.depositResult.order_no},header:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTM3NTUyNDMsImlkIjoiMTIzIiwieW91cl9jdXN0b21fY2xhaW0iOiJ5b3VyX2N1c3RvbV92YWx1ZSJ9.qcdoe8dSYtfQBZgCP30Yln4r8z9ovPDEF1fNVlviWX4"},success:e=>{!e.data||200!==e.data.code&&"200"!==e.data.code?a({title:e.data.msg||"换柜失败",icon:"none"}):(this.newLockerId=e.data.lockerId,this.showChangeLocker=!0)}})},onConfirmChangeLocker(){this.showChangeLocker=!1,this.depositResult.locker_id=this.newLockerId},goOrderDetail(){l({url:`/pages/order-detail/order-detail?order_no=${this.depositResult.order_no}`})},fetchLockerInfo(e){console.log("🔄 获取寄存柜信息，ID:",e),console.log("📦 使用模拟寄存柜数据");const s=this.generateMockLockerData(e);setTimeout((()=>{this.lockerInfo=s,this.lockerTypes=(s.locker||[]).filter((e=>e.num>0)),this.selectedLockerType=0,console.log("✅ 寄存柜信息加载完成:",this.lockerInfo)}),300)},generateMockLockerData(e){const s=[{name:"郑州火车站寄存柜",address:"郑州火车站西广场路北100米KFC门口"},{name:"郑州东站寄存柜",address:"郑州东站南广场地下一层"},{name:"二七广场寄存柜",address:"二七广场地铁站B出口"},{name:"中原福塔寄存柜",address:"中原福塔景区入口处"},{name:"河南博物院寄存柜",address:"河南博物院正门左侧"}],a=s[e%s.length]||s[0];return{id:e,name:a.name,address:a.address,status:"online",locker:[{name:"小柜子",description:"适合背包、手提包等小件物品",size:"33L(298*429*430mm)",num:Math.floor(5*Math.random())+1,hourlyRate:2,lockerType:1,freeDuration:0},{name:"中柜子",description:"适合行李箱、购物袋等中等物品",size:"53L(298*429*630mm)",num:Math.floor(3*Math.random())+1,hourlyRate:3,lockerType:2,freeDuration:0},{name:"大柜子",description:"适合大型行李箱、多件物品",size:"73L(298*429*830mm)",num:Math.floor(2*Math.random())+1,hourlyRate:5,lockerType:3,freeDuration:0}]}},useMockData(e){const s=this.generateMockLockerData(e);this.lockerInfo=s,this.lockerTypes=s.locker.filter((e=>e.num>0)),this.selectedLockerType=0},getLockerImg:e=>2===e?"https://img.icons8.com/ios-filled/100/000000/box.png":"https://img.icons8.com/ios-filled/100/000000/parcel.png"}},[["render",function(e,s,a,l,g,I){const C=h,L=c,T=_,v=m,D=y;return r(),t(L,{class:"locker-detail-container"},{default:o((()=>[i(L,{class:"header-bar"},{default:o((()=>[i(C,{class:"back-btn",onClick:I.goBack},{default:o((()=>[d("〈")])),_:1},8,["onClick"]),i(C,{class:"header-title"},{default:o((()=>[d("柜子信息")])),_:1})])),_:1}),i(L,{class:"site-info"},{default:o((()=>[i(L,{class:"site-title"},{default:o((()=>[d(n(g.lockerInfo.name),1)])),_:1}),i(L,{class:"site-address"},{default:o((()=>[i(C,{class:"iconfont"},{default:o((()=>[d("📍")])),_:1}),d(" "+n(g.lockerInfo.address),1)])),_:1}),i(L,{class:"site-map-btn"},{default:o((()=>[d("导航")])),_:1})])),_:1}),i(L,{class:"available-section"},{default:o((()=>[i(L,{class:"section-title"},{default:o((()=>[d("当前可用 "),i(C,{class:"device-status"},{default:o((()=>[d("设备在线")])),_:1})])),_:1}),i(L,{class:"locker-list"},{default:o((()=>[(r(!0),u(p,null,k(g.lockerInfo.locker,(e=>(r(),t(L,{class:"locker-item",key:e.name},{default:o((()=>[i(T,{class:"locker-img",src:I.getLockerImg(e.lockerType)},null,8,["src"]),i(L,{class:"locker-desc"},{default:o((()=>[i(L,{class:"locker-name"},{default:o((()=>[d(n(e.name)+" ",1),e.num>0?(r(),t(C,{key:0,class:"locker-status"},{default:o((()=>[d("(可用)")])),_:1})):(r(),t(C,{key:1,class:"locker-status",style:{color:"#e74c3c"}},{default:o((()=>[d("(已满)")])),_:1}))])),_:2},1024),i(L,{class:"locker-size"},{default:o((()=>[d(n(e.size),1)])),_:2},1024),i(L,{class:"locker-rate"},{default:o((()=>[d(n(0===e.hourlyRate?"免费":e.hourlyRate+"元/小时"),1)])),_:2},1024),i(L,{class:"locker-desc-text"},{default:o((()=>[d(n(e.description),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),i(L,{class:"select-section"},{default:o((()=>[i(L,{class:"section-title"},{default:o((()=>[d("选择寄存")])),_:1}),i(L,{class:"select-row"},{default:o((()=>[i(C,null,{default:o((()=>[d("选择柜子型号")])),_:1}),i(v,{range:g.lockerTypes.map((e=>e.name)),value:g.selectedLockerType,onChange:I.onLockerTypeChange},{default:o((()=>[i(L,{class:"picker-value"},{default:o((()=>[d(n(g.lockerTypes[g.selectedLockerType]?g.lockerTypes[g.selectedLockerType].name:"无可用柜子"),1)])),_:1})])),_:1},8,["range","value","onChange"])])),_:1}),i(L,{class:"select-row"},{default:o((()=>[i(C,null,{default:o((()=>[d("选择寄存时长")])),_:1}),i(v,{range:g.hours,value:g.selectedHour,onChange:I.onHourChange},{default:o((()=>[i(L,{class:"picker-value"},{default:o((()=>[d(n(g.hours[g.selectedHour]),1)])),_:1})])),_:1},8,["range","value","onChange"])])),_:1}),i(L,{class:"select-row"},{default:o((()=>[i(C,null,{default:o((()=>[d("选择取件方式")])),_:1}),i(v,{range:g.pickupWays,value:g.selectedPickupWay,onChange:I.onPickupWayChange},{default:o((()=>[i(L,{class:"picker-value"},{default:o((()=>[d(n(g.pickupWays[g.selectedPickupWay]),1)])),_:1})])),_:1},8,["range","value","onChange"])])),_:1}),i(L,{class:"select-row price-row"},{default:o((()=>[i(C,null,{default:o((()=>[d("预计费用（优惠后）：")])),_:1}),i(C,{class:"price"},{default:o((()=>[d("￥"+n(I.calcPrice),1)])),_:1})])),_:1})])),_:1}),i(L,{class:"pickup-section"},{default:o((()=>[i(L,{class:"section-title"},{default:o((()=>[d("取件方式")])),_:1}),i(L,{class:"pickup-list"},{default:o((()=>[(r(!0),u(p,null,k(g.pickupWays,((e,s)=>(r(),t(L,{class:"pickup-item",key:e},{default:o((()=>[i(C,null,{default:o((()=>[d(n(e),1)])),_:2},1024),i(D,{size:"mini",type:s===g.selectedPickupWay?"primary":"default"},{default:o((()=>[d(n(s===g.selectedPickupWay?"已选":"选用"),1)])),_:2},1032,["type"])])),_:2},1024)))),128))])),_:1})])),_:1}),i(L,{class:"footer-bar"},{default:o((()=>[i(L,{class:"footer-price"},{default:o((()=>[d("合计￥"+n(I.calcPrice),1)])),_:1}),i(D,{class:"footer-btn",type:"primary",onClick:I.onConfirmDeposit},{default:o((()=>[d("确认寄存")])),_:1},8,["onClick"])])),_:1}),g.showDepositResult?(r(),t(L,{key:0,class:"deposit-result-modal"},{default:o((()=>[i(T,{src:"https://img.icons8.com/ios-filled/100/000000/box.png",class:"result-img"}),i(L,{class:"result-title"},{default:o((()=>[d("柜门已开，请存放您的物品")])),_:1}),i(L,{class:"result-locker-id"},{default:o((()=>[d(n(g.depositResult.locker_id)+"号",1)])),_:1}),i(D,{class:"order-btn",onClick:I.goOrderDetail},{default:o((()=>[d("查看订单")])),_:1},8,["onClick"]),i(L,{class:"change-locker-tip"},{default:o((()=>[d(" 柜子异常？"),i(C,{class:"change-link",onClick:I.onChangeLocker},{default:o((()=>[d("点击换个柜子>>")])),_:1},8,["onClick"])])),_:1})])),_:1})):f("",!0),g.showChangeLocker?(r(),t(L,{key:1,class:"change-locker-modal"},{default:o((()=>[i(L,{class:"modal-title"},{default:o((()=>[d("更换柜门")])),_:1}),i(L,{class:"modal-locker-id"},{default:o((()=>[d(n(g.newLockerId)+"号",1)])),_:1}),i(L,{class:"modal-desc"},{default:o((()=>[d(" 原"+n(g.depositResult.locker_id)+"号柜门异常，即将为您打开新的柜门。请您取出原柜门个人物品，存放在新柜门内。 ",1)])),_:1}),i(D,{class:"confirm-btn",onClick:I.onConfirmChangeLocker},{default:o((()=>[d("确认")])),_:1},8,["onClick"])])),_:1})):f("",!0)])),_:1})}],["__scopeId","data-v-41be151c"]]);export{I as default};
