import{g as t,J as e,a as i,r as a,c as o,v as l,d as s,p as n,e as d,w as r,i as c,o as p,f as u,j as h,x as m,t as g,n as f,k as D,u as I}from"./index-C_HCjYUn.js";import{_ as v}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=v({data:()=>({pointId:null,pointName:"",pointDetail:{name:"",address:"",pointType:"",availableLarge:0,availableMedium:0,availableSmall:0,openTime:"",status:1,pointImage:""},isLoading:!0,error:"",isNavigating:!1}),onLoad(e){this.pointId=e.id||1,this.pointName=decodeURIComponent(e.name||""),this.fromEdit="true"===e.fromEdit,console.log("ç½‘ç‚¹è¯¦æƒ…é¡µé¢åŠ è½½ - ID:",this.pointId,"åç§°:",this.pointName,"æ¥è‡ªç¼–è¾‘:",this.fromEdit),console.log("å®Œæ•´options:",e);const i=t("adminToken");if(console.log("å½“å‰token:",i),this.fromEdit){if(console.log("ä»ç¼–è¾‘é¡µé¢è·³è½¬è¿‡æ¥ï¼Œç›´æ¥ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®"),"new"===this.pointId||"undefined"===this.pointId||!this.pointId){console.log("æ–°å¢ç½‘ç‚¹æ¨¡å¼ï¼Œä½¿ç”¨æœ¬åœ°æœ€æ–°æ•°æ®");const e=t("latestPointData");return e?void this.updatePointDetailDirectly(e):void(this.error="æ–°å¢ç½‘ç‚¹æ¨¡å¼ï¼Œä½†æœªæ‰¾åˆ°æœ¬åœ°æ•°æ®")}this.getPointDetail()}else{const e=t("lastEditTime"),i=t("latestPointData"),a=Date.now();e&&i&&a-e<3e4&&(i.id==this.pointId||i.Id==this.pointId)?(console.log("é¡µé¢åŠ è½½æ—¶ä½¿ç”¨æœ¬åœ°æœ€æ–°æ•°æ®:",i),this.updatePointDetailDirectly(i)):this.getPointDetail()}},onShow(){this.isNavigating=!1,console.log("é¡µé¢æ˜¾ç¤ºï¼Œé‡ç½®å¯¼èˆªçŠ¶æ€");const i=t("lastEditTime"),a=t("latestPointData"),o=Date.now();if(console.log("è¯¦æƒ…é¡µé¢æ˜¾ç¤º - æ£€æŸ¥ç¼–è¾‘æ•°æ®"),console.log("ç¼–è¾‘æ—¶é—´:",i,"å½“å‰æ—¶é—´:",o,"æ—¶é—´å·®:",o-i),console.log("æœ€æ–°ç¼–è¾‘æ•°æ®:",a),console.log("å½“å‰ç½‘ç‚¹ID:",this.pointId),i&&a&&o-i<3e4&&(a.id==this.pointId||a.Id==this.pointId))return console.log("ä½¿ç”¨æœ€æ–°ç¼–è¾‘æ•°æ®æ›´æ–°è¯¦æƒ…é¡µé¢"),void this.updatePointDetailDirectly(a);if(this.fromEdit){if(console.log("ä»ç¼–è¾‘é¡µé¢è·³è½¬è¿‡æ¥ï¼Œç›´æ¥ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®"),"new"===this.pointId||"undefined"===this.pointId||!this.pointId){console.log("æ–°å¢ç½‘ç‚¹æ¨¡å¼ï¼Œä½¿ç”¨æœ¬åœ°æœ€æ–°æ•°æ®");const e=t("latestPointData");return e?void this.updatePointDetailDirectly(e):void(this.error="æ–°å¢ç½‘ç‚¹æ¨¡å¼ï¼Œä½†æœªæ‰¾åˆ°æœ¬åœ°æ•°æ®")}return void setTimeout((()=>{this.getPointDetail()}),500)}const l=t("dataUpdateTime"),s=t("currentPointData");console.log("å…¨å±€æ•°æ®æ›´æ–°æ—¶é—´:",l),console.log("å…¨å±€æœ€æ–°æ•°æ®:",s),l&&s&&o-l<3e4&&(s.id==this.pointId||s.Id==this.pointId)?(console.log("ä½¿ç”¨å…¨å±€æœ€æ–°æ•°æ®:",s),this.updatePointDetailDirectly(s),setTimeout((()=>{e("currentPointData"),e("dataUpdateTime"),console.log("å·²æ¸…é™¤å…¨å±€æ•°æ®")}),5e3)):i&&a&&o-i<3e4&&(a.id==this.pointId||a.Id==this.pointId)?(console.log("ä½¿ç”¨æœ¬åœ°æœ€æ–°æ•°æ®:",a),this.updatePointDetailDirectly(a),setTimeout((()=>{e("latestPointData"),e("lastEditTime"),console.log("å·²æ¸…é™¤æœ¬åœ°æ•°æ®")}),5e3)):this.pointId&&(console.log("é¡µé¢æ˜¾ç¤ºæ—¶é‡æ–°è·å–ç½‘ç‚¹è¯¦æƒ…"),setTimeout((()=>{this.getPointDetail()}),100))},methods:{updatePointDetailDirectly(t){console.log("ç›´æ¥æ›´æ–°ç½‘ç‚¹è¯¦æƒ…æ•°æ®:",t),this.isLoading=!1,this.error="",this.pointDetail={name:t.name||"",address:t.address||"",pointType:t.pointType||"",availableLarge:parseInt(t.availableLarge)||0,availableMedium:parseInt(t.availableMedium)||0,availableSmall:parseInt(t.availableSmall)||0,openTime:t.openTime||"",status:parseInt(t.status)||1,pointImage:t.pointImage||""},console.log("ç›´æ¥æ›´æ–°åçš„ç½‘ç‚¹è¯¦æƒ…:",this.pointDetail),this.$set(this,"pointDetail",{...this.pointDetail}),i({title:"æ•°æ®å·²æ›´æ–°",icon:"success",duration:1500})},getPointDetail(){if(this.isLoading=!0,this.error="",console.log("æ­£åœ¨è·å–ç½‘ç‚¹è¯¦æƒ…ï¼ŒID:",this.pointId),"new"===this.pointId||"undefined"===this.pointId||!this.pointId)return console.log("æ–°å¢ç½‘ç‚¹æ¨¡å¼æˆ–æ— æ•ˆIDï¼Œè·³è¿‡è·å–ç½‘ç‚¹è¯¦æƒ…"),this.isLoading=!1,void(this.error="æ— æ•ˆçš„ç½‘ç‚¹ID");this.pointDetail={name:"",address:"",pointType:"",availableLarge:0,availableMedium:0,availableSmall:0,openTime:"",status:1,pointImage:""};const e={id:parseInt(this.pointId)||this.pointId};console.log("å‘é€çš„è¯·æ±‚æ•°æ®:",e),a({url:"http://localhost:8000/point_info",method:"POST",data:e,header:{"Content-Type":"application/json",Authorization:"Bearer "+t("adminToken")},success:t=>{var e;if(this.isLoading=!1,console.log("ç½‘ç‚¹è¯¦æƒ…æ¥å£è¿”å›æ•°æ®:",t),!t.data||200!==t.data.code&&"200"!==t.data.code)this.error=(null==(e=t.data)?void 0:e.msg)||"è·å–ç½‘ç‚¹è¯¦æƒ…å¤±è´¥",console.error("æ¥å£è¿”å›é”™è¯¯:",t.data),i({title:this.error,icon:"none"});else{console.log("åŸå§‹æ¥å£è¿”å›æ•°æ®:",t.data);const e=t.data.data||t.data;console.log("åç«¯è¿”å›çš„åŸå§‹æ•°æ®:",e),this.pointDetail={name:e.name||e.Name||"",address:e.address||e.Address||"",pointType:e.pointType||e.PointType||e.point_type||"",availableLarge:parseInt(e.availableLarge||e.AvailableLarge||e.available_large)||0,availableMedium:parseInt(e.availableMedium||e.AvailableMedium||e.available_medium)||0,availableSmall:parseInt(e.availableSmall||e.AvailableSmall||e.available_small)||0,openTime:e.openTime||e.OpenTime||e.open_time||"",status:parseInt(e.status||e.Status)||1,pointImage:e.pointImage||e.PointImage||e.point_image||""},console.log("å¤„ç†åçš„ç½‘ç‚¹è¯¦æƒ…:",this.pointDetail);const a={id:this.pointId,name:this.pointDetail.name,address:this.pointDetail.address,pointType:this.pointDetail.pointType,availableLarge:this.pointDetail.availableLarge,availableMedium:this.pointDetail.availableMedium,availableSmall:this.pointDetail.availableSmall,openTime:this.pointDetail.openTime,status:this.pointDetail.status,pointImage:this.pointDetail.pointImage};o("currentPointData",a),o("dataUpdateTime",Date.now()),o("latestPointData",a),o("lastEditTime",Date.now()),console.log("æ•°æ®åº“æ•°æ®ä¸å‰ç«¯æ•°æ®å·²åŒæ­¥:",a),this.fromEdit?(i({title:"å·²æ˜¾ç¤ºæœ€æ–°æ•°æ®",icon:"success",duration:1500}),console.log("âœ… ä»ç¼–è¾‘é¡µé¢è·³è½¬ï¼Œå·²æ˜¾ç¤ºæ•°æ®åº“æœ€æ–°æ•°æ®")):(i({title:"æ•°æ®åŠ è½½æˆåŠŸ",icon:"success",duration:1e3}),console.log("âœ… æ­£å¸¸åŠ è½½ï¼Œæ•°æ®è·å–æˆåŠŸ"))}},fail:t=>{this.isLoading=!1,console.error("ç½‘ç‚¹è¯¦æƒ…è¯·æ±‚å¤±è´¥:",t),this.error="ç½‘ç»œè¯·æ±‚å¤±è´¥",i({title:this.error,icon:"none"})}})},getCabinetInfo(){if(!this.pointDetail)return"0ç»„0ä¸»æœº0æŸœé—¨";const{availableLarge:t,availableMedium:e,availableSmall:i}=this.pointDetail;return`${parseInt(t)||0}ç»„${parseInt(e)||0}ä¸»æœº${parseInt(i)||0}æŸœé—¨`},editPoint(){console.log("ç‚¹å‡»ç¼–è¾‘ç½‘ç‚¹ï¼ŒID:",this.pointId,"åç§°:",this.pointName),l({url:`/pages/point-edit/point-edit?id=${this.pointId}&name=${encodeURIComponent(this.pointName)}`,success:()=>{console.log("æˆåŠŸè·³è½¬åˆ°ç¼–è¾‘é¡µé¢")},fail:t=>{console.error("è·³è½¬åˆ°ç¼–è¾‘é¡µé¢å¤±è´¥:",t),i({title:"è·³è½¬å¤±è´¥",icon:"none"})}})},openBaiduMap(){if(!this.pointDetail.address)return void i({title:"ç½‘ç‚¹åœ°å€ä¸ºç©º",icon:"none"});console.log("æ‰“å¼€åœ°å›¾é¡µé¢ï¼Œåœ°å€:",this.pointDetail.address);const t=encodeURIComponent(this.pointDetail.name||"ç½‘ç‚¹ä½ç½®"),e=encodeURIComponent(this.pointDetail.address);l({url:`/pages/map-view/map-view?name=${t}&address=${e}`,success:()=>{console.log("è·³è½¬åˆ°åœ°å›¾é¡µé¢æˆåŠŸ")},fail:t=>{console.error("è·³è½¬åˆ°åœ°å›¾é¡µé¢å¤±è´¥:",t),i({title:"è·³è½¬å¤±è´¥",icon:"none"})}})},goToPriceRule(){this.isNavigating?console.log("æ­£åœ¨è·³è½¬ä¸­ï¼Œå¿½ç•¥é‡å¤ç‚¹å‡»"):(this.isNavigating=!0,console.log("ç‚¹å‡»æ”¶è´¹è§„åˆ™ï¼Œç½‘ç‚¹ID:",this.pointId,"åç§°:",this.pointName),l({url:`/pages/price-rule/price-rule?id=${this.pointId}&name=${encodeURIComponent(this.pointName)}`,success:()=>{console.log("è·³è½¬æˆåŠŸ"),setTimeout((()=>{this.isNavigating=!1}),500)},fail:t=>{console.error("è·³è½¬å¤±è´¥:",t),this.isNavigating=!1,i({title:"è·³è½¬å¤±è´¥",icon:"none"})}}))},updatePointDetail(t){console.log("æ›´æ–°ç½‘ç‚¹è¯¦æƒ…æ•°æ®:",t),this.pointDetail={name:t.name||"",address:t.address||"",pointType:t.pointType||"",availableLarge:t.availableLarge||0,availableMedium:t.availableMedium||0,availableSmall:t.availableSmall||0,openTime:t.openTime||"",status:t.status||1,pointImage:t.pointImage||""},console.log("æ›´æ–°åçš„ç½‘ç‚¹è¯¦æƒ…:",this.pointDetail),this.$set(this,"pointDetail",{...this.pointDetail}),i({title:"æ•°æ®å·²æ›´æ–°",icon:"success",duration:1e3})},forceRefresh(){if(console.log("å¼ºåˆ¶åˆ·æ–°æ•°æ®"),"new"===this.pointId||"undefined"===this.pointId||!this.pointId)return console.log("æ–°å¢ç½‘ç‚¹æ¨¡å¼ï¼Œä¸éœ€è¦åˆ·æ–°è¯¦æƒ…"),void(this.error="æ–°å¢ç½‘ç‚¹æ¨¡å¼ï¼Œæ— éœ€åˆ·æ–°è¯¦æƒ…");console.log("å¼ºåˆ¶åˆ·æ–° - ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®"),this.getPointDetail()},goBack(){console.log("ç‚¹å‡»è¿”å›æŒ‰é’®ï¼ŒfromEdit:",this.fromEdit),s({url:"/pages/point/point",success:()=>{console.log("âœ… æˆåŠŸè·³è½¬åˆ°æˆ‘çš„ç½‘ç‚¹é¡µé¢ï¼Œå°†æ˜¾ç¤ºæœ€æ–°æ•°æ®")},fail:t=>{console.error("è·³è½¬åˆ°æˆ‘çš„ç½‘ç‚¹é¡µé¢å¤±è´¥:",t),n()}})}}},[["render",function(t,e,i,a,o,l){const s=D,n=c,v=I;return p(),d(n,{class:"point-detail"},{default:r((()=>[u(n,{class:"header"},{default:r((()=>[u(n,{class:"back-btn",onClick:l.goBack},{default:r((()=>[u(s,{class:"back-icon"},{default:r((()=>[h("â†")])),_:1})])),_:1},8,["onClick"]),u(n,{class:"title"},{default:r((()=>[h("ç½‘ç‚¹è¯¦æƒ…")])),_:1}),u(n,{class:"header-right"},{default:r((()=>[u(s,{class:"refresh-btn",onClick:l.forceRefresh},{default:r((()=>[h("åˆ·æ–°")])),_:1},8,["onClick"]),u(s,{class:"edit-btn",onClick:l.editPoint},{default:r((()=>[h("ç¼–è¾‘")])),_:1},8,["onClick"])])),_:1})])),_:1}),o.pointDetail?(p(),d(n,{key:0,class:"photo-section"},{default:r((()=>[u(n,{class:"photo-placeholder"},{default:r((()=>[o.pointDetail.pointImage?(p(),d(v,{key:0,src:o.pointDetail.pointImage,mode:"aspectFill",class:"main-photo"},null,8,["src"])):(p(),d(n,{key:1,class:"photo-upload"},{default:r((()=>[u(s,{class:"photo-icon"},{default:r((()=>[h("ğŸ“·")])),_:1}),u(s,{class:"photo-text"},{default:r((()=>[h("ç½‘ç‚¹ç…§ç‰‡")])),_:1})])),_:1}))])),_:1})])),_:1})):m("",!0),o.pointDetail?(p(),d(n,{key:1,class:"info-section"},{default:r((()=>[u(n,{class:"info-item"},{default:r((()=>[u(s,{class:"info-label"},{default:r((()=>[h("ç½‘ç‚¹åç§°")])),_:1}),u(s,{class:"info-value"},{default:r((()=>[h(g(o.pointDetail.name),1)])),_:1}),u(s,{class:"arrow"},{default:r((()=>[h(">")])),_:1})])),_:1}),u(n,{class:"info-item clickable",onClick:l.openBaiduMap},{default:r((()=>[u(s,{class:"info-label"},{default:r((()=>[h("ç½‘ç‚¹åœ°å€")])),_:1}),u(n,{class:"address-container"},{default:r((()=>[u(s,{class:"location-icon"},{default:r((()=>[h("ğŸ“")])),_:1}),u(s,{class:"info-value"},{default:r((()=>[h(g(o.pointDetail.address),1)])),_:1})])),_:1}),u(s,{class:"arrow"},{default:r((()=>[h(">")])),_:1})])),_:1},8,["onClick"]),u(n,{class:"info-item"},{default:r((()=>[u(s,{class:"info-label"},{default:r((()=>[h("ç½‘ç‚¹ç±»å‹")])),_:1}),u(s,{class:"info-value"},{default:r((()=>[h(g(o.pointDetail.pointType),1)])),_:1}),u(s,{class:"arrow"},{default:r((()=>[h(">")])),_:1})])),_:1}),u(n,{class:"info-item"},{default:r((()=>[u(s,{class:"info-label"},{default:r((()=>[h("ç®¡ç†æŸœç»„")])),_:1}),u(s,{class:"info-value"},{default:r((()=>[h(g(l.getCabinetInfo()),1)])),_:1}),u(s,{class:"arrow"},{default:r((()=>[h(">")])),_:1})])),_:1}),u(n,{class:"info-item"},{default:r((()=>[u(s,{class:"info-label"},{default:r((()=>[h("è¥ä¸šæ—¶é—´")])),_:1}),u(s,{class:"info-value"},{default:r((()=>[h(g(o.pointDetail.openTime),1)])),_:1}),u(s,{class:"arrow"},{default:r((()=>[h(">")])),_:1})])),_:1}),u(n,{class:"info-item"},{default:r((()=>[u(s,{class:"info-label"},{default:r((()=>[h("ç½‘ç‚¹çŠ¶æ€")])),_:1}),u(s,{class:f(["info-value",1==o.pointDetail.staus?"status-normal":"status-closed"])},{default:r((()=>[h(g(1==o.pointDetail.staus?"æ­£å¸¸":"æš‚åœè¥ä¸š"),1)])),_:1},8,["class"]),u(s,{class:"arrow"},{default:r((()=>[h(">")])),_:1})])),_:1}),u(n,{class:"info-item clickable",onClick:l.goToPriceRule},{default:r((()=>[u(s,{class:"info-label"},{default:r((()=>[h("æ”¶è´¹è§„åˆ™")])),_:1}),u(s,{class:"info-value"},{default:r((()=>[h("æŸ¥çœ‹")])),_:1}),u(s,{class:"arrow"},{default:r((()=>[h(">")])),_:1})])),_:1},8,["onClick"])])),_:1})):m("",!0),o.isLoading?(p(),d(n,{key:2,class:"loading"},{default:r((()=>[u(s,null,{default:r((()=>[h("åŠ è½½ä¸­...")])),_:1})])),_:1})):m("",!0),o.error?(p(),d(n,{key:3,class:"error"},{default:r((()=>[u(s,null,{default:r((()=>[h(g(o.error),1)])),_:1})])),_:1})):m("",!0)])),_:1})}],["__scopeId","data-v-a72ff2a6"]]);export{_ as default};
