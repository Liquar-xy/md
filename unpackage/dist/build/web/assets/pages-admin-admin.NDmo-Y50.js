import{g as e,b as a,r as t,h as l,a as s,m as o,J as n,d as i,p as d,q as c,v as r,e as u,w as m,i as f,o as h,f as _,j as p,t as g,x as k,k as N,l as P}from"./index-BAOqw0gZ.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=y({data:()=>({pointNum:0,lastOrderNum:0,yesterdayOrderNum:0,lastOrderPrice:0,mouthPrice:0,monthNum:0,alarmCount:0,adminId:"",lockerPointId:"",lastUpdateTime:""}),onLoad(){console.log("页面加载开始"),this.loadAdminData()},onShow(){console.log("页面显示"),this.fetchAdminDataSilent()},methods:{loadAdminData(){e("adminToken");const a=e("adminId");e("adminMobile"),this.adminId=a||"1",this.lockerPointId="2",console.log("=== 初始化参数 ==="),console.log("管理员ID:",this.adminId),console.log("网点ID:",this.lockerPointId),this.fetchAdminData()},fetchAdminDataSilent(){console.log("=== 静默获取管理员数据 ==="),console.log("时间:",(new Date).toLocaleString()),this.fetchAdminDataInternal(!1)},fetchAdminData(){console.log("=== 开始获取管理员数据 ==="),console.log("时间:",(new Date).toLocaleString()),a({title:"正在获取数据..."}),this.fetchAdminDataInternal(!0)},fetchAdminDataInternal(e=!0){const a={admin_id:this.adminId,locker_point_id:this.lockerPointId};console.log("=== 请求参数 ==="),console.log("管理员ID:",this.adminId),console.log("网点ID:",this.lockerPointId),console.log("请求数据:",a);const o=`http://localhost:8000/admin?t=${(new Date).getTime()}`,n=new URLSearchParams;n.append("admin_id",a.admin_id),n.append("locker_point_id",a.locker_point_id),t({url:o,method:"POST",data:n.toString(),header:{"Content-Type":"application/x-www-form-urlencoded"},timeout:2e4,success:a=>{var t,o,n,i,d,c,r,u;if(e&&l(),console.log("=== API响应 ==="),console.log("状态码:",a.statusCode),console.log("响应数据:",a.data),!a.data||200!==a.data.code&&"200"!==a.data.code)console.log("=== API返回错误 ==="),console.log("错误码:",null==(t=a.data)?void 0:t.code),console.log("错误信息:",null==(o=a.data)?void 0:o.msg),401===(null==(n=a.data)?void 0:n.code)||(null==(d=null==(i=a.data)?void 0:i.msg)?void 0:d.includes("未登录"))||(null==(r=null==(c=a.data)?void 0:c.msg)?void 0:r.includes("token"))?this.handleAuthError():s({title:`获取数据失败: ${(null==(u=a.data)?void 0:u.msg)||"未知错误"}`,icon:"none",duration:3e3});else{console.log("=== 数据映射开始 ===");const e=a.data;console.log("=== 所有字段 ==="),console.log("pointNum:",e.pointNum,typeof e.pointNum),console.log("lastOrderNum:",e.lastOrderNum,typeof e.lastOrderNum),console.log("yesterdayOrderNum:",e.yesterdayOrderNum,typeof e.yesterdayOrderNum),console.log("lastOrderPrice:",e.lastOrderPrice,typeof e.lastOrderPrice),console.log("mouthPrice:",e.mouthPrice,typeof e.mouthPrice),console.log("monthNum:",e.monthNum,typeof e.monthNum),this.pointNum=this.safeParseInt(e.pointNum),this.lastOrderNum=this.safeParseInt(e.lastOrderNum),this.yesterdayOrderNum=this.safeParseInt(e.yesterdayOrderNum),this.lastOrderPrice=this.safeParseFloat(e.lastOrderPrice),this.mouthPrice=this.safeParseFloat(e.mouthPrice),this.monthNum=this.safeParseInt(e.monthNum),console.log("=== 数据映射结果 ==="),console.log("网点数:",this.pointNum),console.log("今日订单:",this.lastOrderNum),console.log("昨日订单:",this.yesterdayOrderNum),console.log("昨日收益:",this.lastOrderPrice),console.log("本月收益:",this.mouthPrice),console.log("本月订单:",this.monthNum),this.lastUpdateTime=(new Date).toLocaleString(),s({title:"数据已更新",icon:"success",duration:2e3})}},fail:a=>{e&&l(),console.log("=== 网络请求失败 ==="),console.log("错误信息:",a.errMsg),console.log("错误详情:",a),e&&s({title:`网络请求失败: ${a.errMsg||"未知错误"}`,icon:"none",duration:3e3})}})},safeParseInt(e){if(null==e||""===e)return 0;const a=parseInt(e);return isNaN(a)?0:a},safeParseFloat(e){if(null==e||""===e)return 0;const a=parseFloat(e);return isNaN(a)?0:a},handleAuthError(){o({title:"登录已过期",content:"您的登录已过期，请重新登录",showCancel:!1,success:()=>{n("adminToken"),n("adminId"),n("adminMobile"),i({url:"/pages/admin/login"})}})},forceRefreshData(){console.log("=== 刷新数据 ==="),console.log("时间:",(new Date).toLocaleString()),this.fetchAdminData()},handleBack(){d()},handleMenu(){c({itemList:["退出登录","帮助","关于"],success:e=>{console.log("选择了:",e.tapIndex),0===e.tapIndex&&this.handleLogout()}})},handleLogout(){o({title:"确认退出",content:"确定要退出登录吗？",success:e=>{e.confirm&&(n("adminToken"),n("adminId"),n("adminMobile"),s({title:"已退出登录",icon:"success"}),setTimeout((()=>{i({url:"/pages/admin/login"})}),1500))}})},handleProfile(){r({url:"/pages/admin/profile"})},handleMySites(){r({url:"/pages/point/point"})},handleCabinetManagement(){r({url:"/pages/location-select/location-select?from=admin&target=cabinet-group"})},handleOrderManagement(){s({title:"订单管理",icon:"none"})},handleRevenueDashboard(){s({title:"营收看板",icon:"none"})},handleAlarm(){s({title:`异常报警 (${this.alarmCount}条)`,icon:"none"})},handleSystemAdmin(){s({title:"系统管理员",icon:"none"})}}},[["render",function(e,a,t,l,s,o){const n=N,i=f,d=P;return h(),u(i,{class:"admin-container"},{default:m((()=>[_(i,{class:"header"},{default:m((()=>[_(i,{class:"header-left"},{default:m((()=>[_(n,{class:"back-icon",onClick:o.handleBack},{default:m((()=>[p("←")])),_:1},8,["onClick"])])),_:1}),_(i,{class:"header-center"},{default:m((()=>[_(n,{class:"header-title"},{default:m((()=>[p("管理员")])),_:1})])),_:1}),_(i,{class:"header-right"},{default:m((()=>[_(n,{class:"menu-icon",onClick:o.handleMenu},{default:m((()=>[p("⋯")])),_:1},8,["onClick"]),_(n,{class:"profile-icon",onClick:o.handleProfile},{default:m((()=>[p("👤")])),_:1},8,["onClick"])])),_:1})])),_:1}),_(i,{class:"overview-section"},{default:m((()=>[_(i,{class:"overview-header"},{default:m((()=>[_(n,{class:"overview-text"},{default:m((()=>[p("共 "+g(s.pointNum)+" 个网点",1)])),_:1}),s.pointNum>0?(h(),u(n,{key:0,class:"overview-status"},{default:m((()=>[p("✅ 正常")])),_:1})):(h(),u(n,{key:1,class:"overview-status error"},{default:m((()=>[p("▲ 无数据")])),_:1}))])),_:1}),_(i,{class:"revenue-note"},{default:m((()=>[_(n,{class:"note-text"},{default:m((()=>[p("*每日9:00后结算昨日收益")])),_:1}),_(n,{class:"question-icon"},{default:m((()=>[p("?")])),_:1})])),_:1}),s.lastUpdateTime?(h(),u(i,{key:0,class:"data-time"},{default:m((()=>[_(n,{class:"time-text"},{default:m((()=>[p("数据库同步时间: "+g(s.lastUpdateTime),1)])),_:1})])),_:1})):k("",!0)])),_:1}),_(i,{class:"kpi-section"},{default:m((()=>[_(i,{class:"kpi-header"},{default:m((()=>[_(n,{class:"kpi-title"},{default:m((()=>[p("实时数据")])),_:1}),_(n,{class:"kpi-subtitle"},{default:m((()=>[p("基于数据库实时查询")])),_:1})])),_:1}),_(i,{class:"kpi-grid"},{default:m((()=>[_(i,{class:"kpi-item"},{default:m((()=>[_(n,{class:"kpi-value"},{default:m((()=>[p(g(s.lastOrderNum),1)])),_:1}),_(n,{class:"kpi-label"},{default:m((()=>[p("今日订单")])),_:1}),_(n,{class:"kpi-desc"},{default:m((()=>[p("今日新增订单数")])),_:1})])),_:1}),_(i,{class:"kpi-item"},{default:m((()=>[_(n,{class:"kpi-value"},{default:m((()=>[p("¥"+g(s.lastOrderPrice),1)])),_:1}),_(n,{class:"kpi-label"},{default:m((()=>[p("昨日收益")])),_:1}),_(n,{class:"kpi-desc"},{default:m((()=>[p("昨日总收益金额")])),_:1})])),_:1}),_(i,{class:"kpi-item"},{default:m((()=>[_(n,{class:"kpi-value"},{default:m((()=>[p(g(s.yesterdayOrderNum),1)])),_:1}),_(n,{class:"kpi-label"},{default:m((()=>[p("昨日订单")])),_:1}),_(n,{class:"kpi-desc"},{default:m((()=>[p("昨日完成订单数")])),_:1})])),_:1}),_(i,{class:"kpi-item"},{default:m((()=>[_(n,{class:"kpi-value"},{default:m((()=>[p("¥"+g(s.mouthPrice),1)])),_:1}),_(n,{class:"kpi-label"},{default:m((()=>[p("本月收益")])),_:1}),_(n,{class:"kpi-desc"},{default:m((()=>[p("本月累计收益")])),_:1})])),_:1}),_(i,{class:"kpi-item"},{default:m((()=>[_(n,{class:"kpi-value"},{default:m((()=>[p(g(s.monthNum),1)])),_:1}),_(n,{class:"kpi-label"},{default:m((()=>[p("本月订单")])),_:1}),_(n,{class:"kpi-desc"},{default:m((()=>[p("本月累计订单数")])),_:1})])),_:1})])),_:1})])),_:1}),_(i,{class:"refresh-section"},{default:m((()=>[_(i,{class:"refresh-controls"},{default:m((()=>[_(d,{class:"refresh-btn",onClick:o.forceRefreshData},{default:m((()=>[_(n,{class:"refresh-icon"},{default:m((()=>[p("🔄")])),_:1}),_(n,{class:"refresh-text"},{default:m((()=>[p("刷新数据")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),_(i,{class:"tools-section"},{default:m((()=>[_(n,{class:"section-title"},{default:m((()=>[p("管理工具")])),_:1}),_(i,{class:"tools-grid"},{default:m((()=>[_(i,{class:"tool-item",onClick:o.handleMySites},{default:m((()=>[_(n,{class:"tool-text"},{default:m((()=>[p("我的网点")])),_:1})])),_:1},8,["onClick"]),_(i,{class:"tool-item",onClick:o.handleCabinetManagement},{default:m((()=>[_(n,{class:"tool-text"},{default:m((()=>[p("柜组管理")])),_:1})])),_:1},8,["onClick"]),_(i,{class:"tool-item",onClick:o.handleOrderManagement},{default:m((()=>[_(n,{class:"tool-text"},{default:m((()=>[p("订单管理")])),_:1})])),_:1},8,["onClick"]),_(i,{class:"tool-item",onClick:o.handleRevenueDashboard},{default:m((()=>[_(n,{class:"tool-text"},{default:m((()=>[p("营收看板")])),_:1})])),_:1},8,["onClick"]),_(i,{class:"tool-item alarm",onClick:o.handleAlarm},{default:m((()=>[_(n,{class:"tool-text"},{default:m((()=>[p("异常报警")])),_:1}),s.alarmCount>0?(h(),u(i,{key:0,class:"alarm-badge"},{default:m((()=>[_(n,{class:"alarm-count"},{default:m((()=>[p(g(s.alarmCount),1)])),_:1})])),_:1})):k("",!0)])),_:1},8,["onClick"]),_(i,{class:"tool-item",onClick:o.handleSystemAdmin},{default:m((()=>[_(n,{class:"tool-text"},{default:m((()=>[p("系统管理员")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-891635a8"]]);export{I as default};
