import{p as o,a as e,r as l,c as s,d as a,e as t,w as n,i,o as d,f as r,j as m,t as c,k as u,M as f,I as h,l as p}from"./index-BAOqw0gZ.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=g({data:()=>({loginForm:{mobile:"13800138000",password:"123456",smsCode:"1234"},isLoading:!1,smsCountdown:0,timer:null}),onLoad(){console.log("管理员登录页面加载")},onUnload(){this.timer&&clearInterval(this.timer)},methods:{handleBack(){o()},sendSmsCode(){if(!this.loginForm.mobile)return void e({title:"请先输入手机号",icon:"none"});if(!/^1[3-9]\d{9}$/.test(this.loginForm.mobile))return void e({title:"请输入正确的手机号",icon:"none"});const o=`mobile=${this.loginForm.mobile}&source=admin`;l({url:"http://localhost:8000/sendSms",method:"POST",data:o,header:{"Content-Type":"application/x-www-form-urlencoded"},success:o=>{var l;!o.data||200!==o.data.code&&"200"!==o.data.code?e({title:(null==(l=o.data)?void 0:l.msg)||"发送失败",icon:"none"}):(e({title:"验证码已发送",icon:"success"}),this.smsCountdown=60,this.timer=setInterval((()=>{this.smsCountdown--,this.smsCountdown<=0&&clearInterval(this.timer)}),1e3))},fail:o=>{console.error("发送验证码失败:",o),e({title:"网络错误，请重试",icon:"none"})}})},handleLogin(){if(!this.loginForm.mobile)return void e({title:"请输入手机号",icon:"none"});if(!this.loginForm.password)return void e({title:"请输入密码",icon:"none"});if(!this.loginForm.smsCode)return void e({title:"请输入验证码",icon:"none"});if(!/^\d{4}$/.test(this.loginForm.smsCode))return void e({title:"请输入4位验证码",icon:"none"});this.isLoading=!0;const o=`mobile=${this.loginForm.mobile}&password=${this.loginForm.password}&smsCode=${this.loginForm.smsCode}`;l({url:"http://localhost:8000/admin_login",method:"POST",data:o,header:{"Content-Type":"application/x-www-form-urlencoded"},success:o=>{var l;!o.data||200!==o.data.code&&"200"!==o.data.code?e({title:(null==(l=o.data)?void 0:l.msg)||"登录失败",icon:"none"}):(s("adminToken",o.data.token||"admin-token"),s("adminId",String(o.data.id||"1")),s("adminMobile",this.loginForm.mobile),a({url:"/pages/admin/admin"}))},fail:o=>{console.error("登录请求失败:",o),e({title:"网络请求失败，请检查网络连接",icon:"none"})},complete:()=>{this.isLoading=!1}})}}},[["render",function(o,e,l,s,a,g){const _=u,b=i,C=f,w=h,F=p;return d(),t(b,{class:"login-container"},{default:n((()=>[r(b,{class:"header"},{default:n((()=>[r(b,{class:"header-left"},{default:n((()=>[r(_,{class:"back-icon",onClick:g.handleBack},{default:n((()=>[m("←")])),_:1},8,["onClick"])])),_:1}),r(b,{class:"header-center"},{default:n((()=>[r(_,{class:"header-title"},{default:n((()=>[m("管理员登录")])),_:1})])),_:1})])),_:1}),r(b,{class:"login-form"},{default:n((()=>[r(b,{class:"form-header"},{default:n((()=>[r(_,{class:"form-title"},{default:n((()=>[m("管理员登录")])),_:1}),r(_,{class:"form-subtitle"},{default:n((()=>[m("请输入您的登录信息")])),_:1})])),_:1}),r(b,{class:"form-group"},{default:n((()=>[r(C,{class:"form-label"},{default:n((()=>[m("手机号")])),_:1}),r(w,{class:"form-input",type:"text",modelValue:a.loginForm.mobile,"onUpdate:modelValue":e[0]||(e[0]=o=>a.loginForm.mobile=o),placeholder:"请输入手机号",maxlength:"11"},null,8,["modelValue"])])),_:1}),r(b,{class:"form-group"},{default:n((()=>[r(C,{class:"form-label"},{default:n((()=>[m("密码")])),_:1}),r(w,{class:"form-input",type:"password",modelValue:a.loginForm.password,"onUpdate:modelValue":e[1]||(e[1]=o=>a.loginForm.password=o),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1}),r(b,{class:"form-group"},{default:n((()=>[r(C,{class:"form-label"},{default:n((()=>[m("验证码")])),_:1}),r(b,{class:"sms-group"},{default:n((()=>[r(w,{class:"form-input sms-input",type:"text",modelValue:a.loginForm.smsCode,"onUpdate:modelValue":e[2]||(e[2]=o=>a.loginForm.smsCode=o),placeholder:"请输入验证码",maxlength:"4"},null,8,["modelValue"]),r(F,{class:"sms-btn",disabled:a.smsCountdown>0,onClick:g.sendSmsCode},{default:n((()=>[m(c(a.smsCountdown>0?`${a.smsCountdown}s`:"获取验证码"),1)])),_:1},8,["disabled","onClick"])])),_:1})])),_:1}),r(F,{class:"login-btn",onClick:g.handleLogin,disabled:a.isLoading},{default:n((()=>[a.isLoading?(d(),t(_,{key:0},{default:n((()=>[m("登录中...")])),_:1})):(d(),t(_,{key:1},{default:n((()=>[m("登录")])),_:1}))])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-9faa86b4"]]);export{_ as default};
