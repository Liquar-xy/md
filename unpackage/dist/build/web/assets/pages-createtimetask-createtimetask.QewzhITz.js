import{a as e,p as t,r as a,v as s,e as i,w as o,i as n,o as l,f as r,j as d,t as u,x as m,k as c,I as g,E as h,l as f,U as I}from"./index-C_HCjYUn.js";import{a as p}from"./api.D1TiY1OU.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=T({data:()=>({isSubmitting:!1,statusIndex:0,statusOptions:["待寄存","寄存中"],dateTimeIndex:[0,0,0,0,0],dateTimeRange:[],storageForm:{orderId:"",cabinetId:"",userId:"",status:0,expireTime:0}}),onLoad(){this.initDateTimeRange()},methods:{initDateTimeRange(){const e=new Date,t=e.getFullYear(),a=[];for(let r=0;r<3;r++)a.push((t+r).toString());const s=[];for(let r=1;r<=12;r++)s.push(r.toString().padStart(2,"0"));const i=[];for(let r=1;r<=31;r++)i.push(r.toString().padStart(2,"0"));const o=[];for(let r=0;r<24;r++)o.push(r.toString().padStart(2,"0"));const n=[];for(let r=0;r<60;r++)n.push(r.toString().padStart(2,"0"));this.dateTimeRange=[a,s,i,o,n];const l=new Date(e.getTime()+36e5);this.dateTimeIndex=[0,l.getMonth(),l.getDate()-1,l.getHours(),l.getMinutes()]},onStatusChange(e){this.statusIndex=e.detail.value,this.storageForm.status=parseInt(e.detail.value)},onDateTimeChange(e){this.dateTimeIndex=e.detail.value},formatDateTime(){if(!this.dateTimeRange.length)return"请选择过期时间";const[e,t,a,s,i]=this.dateTimeIndex;return`${this.dateTimeRange[0][e]}-${this.dateTimeRange[1][t]}-${this.dateTimeRange[2][a]} ${this.dateTimeRange[3][s]}:${this.dateTimeRange[4][i]}`},getSelectedTimestamp(){const[e,t,a,s,i]=this.dateTimeIndex,o=parseInt(this.dateTimeRange[0][e]),n=parseInt(this.dateTimeRange[1][t])-1,l=parseInt(this.dateTimeRange[2][a]),r=parseInt(this.dateTimeRange[3][s]),d=parseInt(this.dateTimeRange[4][i]),u=new Date(o,n,l,r,d);return Math.floor(u.getTime()/1e3)},validateForm(){const t=["orderId","cabinetId","userId"];for(let s of t)if(!this.storageForm[s]||""===this.storageForm[s])return e({title:`请填写${this.getFieldLabel(s)}`,icon:"none"}),!1;if(this.storageForm.orderId<=0)return e({title:"订单ID必须大于0",icon:"none"}),!1;if(this.storageForm.cabinetId<=0)return e({title:"柜子ID必须大于0",icon:"none"}),!1;if(this.storageForm.userId<=0)return e({title:"用户ID必须大于0",icon:"none"}),!1;const a=this.getSelectedTimestamp();return a<=Math.floor(Date.now()/1e3)?(e({title:"过期时间不能早于当前时间",icon:"none"}),!1):(this.storageForm.expireTime=a,!0)},getFieldLabel:e=>({orderId:"订单ID",cabinetId:"柜子ID",userId:"用户ID"}[e]||e),async handleSubmit(){if(this.validateForm()){this.isSubmitting=!0;try{const a={orderId:parseInt(this.storageForm.orderId),cabinetId:parseInt(this.storageForm.cabinetId),userId:parseInt(this.storageForm.userId),status:this.storageForm.status,expireTime:this.storageForm.expireTime},s=await this.createLockerStorage(a);if(!s.success)throw new Error(s.message||"创建寄存记录失败");e({title:"寄存记录创建成功",icon:"success"}),setTimeout((()=>{t()}),1500)}catch(a){console.error("创建寄存记录失败:",a);let t="创建寄存记录失败";a.message.includes("无效参数")?t="参数无效，请检查输入信息":a.message.includes("过期时间不能早于当前时间")?t="过期时间不能早于当前时间":a.message.includes("创建寄存记录失败")?t="寄存记录创建失败，请稍后重试":a.message.includes("创建定时任务失败")?t="定时任务创建失败，请联系管理员":a.message&&(t=a.message),e({title:t,icon:"none",duration:3e3})}finally{this.isSubmitting=!1}}},createLockerStorage:e=>new Promise(((t,s)=>{console.log("发送寄存记录创建请求:",e),a({url:"http://127.0.0.1:8000/create/locker/storage",method:"POST",data:e,header:{"Content-Type":"application/json"},timeout:p.timeout,success:e=>{var a,i,o;if(console.log("寄存记录创建响应:",e),200===e.statusCode)t({success:!0,data:e.data,message:(null==(a=e.data)?void 0:a.msg)||"寄存记录创建成功"});else{const t=(null==(i=e.data)?void 0:i.message)||(null==(o=e.data)?void 0:o.msg)||"请求失败";s(new Error(t))}},fail:e=>{console.error("网络请求失败:",e),s(new Error("网络连接失败，请检查网络设置"))}})})),handleReset(){this.storageForm={orderId:"",cabinetId:"",userId:"",status:0,expireTime:0},this.statusIndex=0,this.initDateTimeRange(),e({title:"表单已重置",icon:"success"})},goToIndex(){s({url:"/pages/index/index"})}}},[["render",function(e,t,a,s,p,T){const _=c,b=n,x=g,S=h,F=f,D=I;return l(),i(b,{class:"locker-storage-create"},{default:o((()=>[r(b,{class:"header"},{default:o((()=>[r(_,{class:"title"},{default:o((()=>[d("创建寄存记录")])),_:1}),r(b,{class:"tips"},{default:o((()=>[r(_,{class:"tip-text"},{default:o((()=>[d("• 请确保订单已存在且有效")])),_:1}),r(_,{class:"tip-text"},{default:o((()=>[d("• 过期时间不能早于当前时间")])),_:1}),r(_,{class:"tip-text"},{default:o((()=>[d("• 系统将自动创建提醒和处理任务")])),_:1})])),_:1})])),_:1}),r(D,{onSubmit:T.handleSubmit,class:"storage-form"},{default:o((()=>[r(b,{class:"form-section"},{default:o((()=>[r(_,{class:"section-title"},{default:o((()=>[d("基本信息")])),_:1}),r(b,{class:"form-item"},{default:o((()=>[r(_,{class:"label"},{default:o((()=>[d("订单ID")])),_:1}),r(x,{modelValue:p.storageForm.orderId,"onUpdate:modelValue":t[0]||(t[0]=e=>p.storageForm.orderId=e),type:"number",placeholder:"请输入订单ID",class:"input"},null,8,["modelValue"])])),_:1}),r(b,{class:"form-item"},{default:o((()=>[r(_,{class:"label"},{default:o((()=>[d("柜子ID")])),_:1}),r(x,{modelValue:p.storageForm.cabinetId,"onUpdate:modelValue":t[1]||(t[1]=e=>p.storageForm.cabinetId=e),type:"number",placeholder:"请输入柜子ID",class:"input"},null,8,["modelValue"])])),_:1}),r(b,{class:"form-item"},{default:o((()=>[r(_,{class:"label"},{default:o((()=>[d("用户ID")])),_:1}),r(x,{modelValue:p.storageForm.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>p.storageForm.userId=e),type:"number",placeholder:"请输入用户ID",class:"input"},null,8,["modelValue"])])),_:1})])),_:1}),r(b,{class:"form-section"},{default:o((()=>[r(_,{class:"section-title"},{default:o((()=>[d("状态和时间")])),_:1}),r(b,{class:"form-item"},{default:o((()=>[r(_,{class:"label"},{default:o((()=>[d("寄存状态")])),_:1}),r(S,{onChange:T.onStatusChange,value:p.statusIndex,range:p.statusOptions},{default:o((()=>[r(b,{class:"picker"},{default:o((()=>[d(u(p.statusOptions[p.statusIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),r(b,{class:"form-item"},{default:o((()=>[r(_,{class:"label"},{default:o((()=>[d("过期时间")])),_:1}),r(S,{mode:"multiSelector",onChange:T.onDateTimeChange,value:p.dateTimeIndex,range:p.dateTimeRange},{default:o((()=>[r(b,{class:"picker"},{default:o((()=>[d(u(T.formatDateTime()),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1}),r(b,{class:"form-actions"},{default:o((()=>[r(F,{onClick:T.handleSubmit,disabled:p.isSubmitting,class:"submit-btn"},{default:o((()=>[d(u(p.isSubmitting?"创建中...":"创建寄存记录"),1)])),_:1},8,["onClick","disabled"]),r(F,{onClick:T.handleReset,class:"reset-btn"},{default:o((()=>[d("重置")])),_:1},8,["onClick"]),r(F,{onClick:T.goToIndex,class:"index-btn"},{default:o((()=>[d("返回首页")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["onSubmit"]),p.isSubmitting?(l(),i(b,{key:0,class:"loading-overlay"},{default:o((()=>[r(b,{class:"loading-content"},{default:o((()=>[r(_,null,{default:o((()=>[d("正在创建寄存记录...")])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1})}],["__scopeId","data-v-8c16c3f8"]]);export{_ as default};
