import{a as e,p as t,r as a,v as s,e as o,w as l,i as r,o as d,f as i,j as n,n as u,t as c,x as m,k as p,I as h,E as f,l as I,U as b}from"./index-C_HCjYUn.js";import{a as _}from"./api.D1TiY1OU.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";const F=g({data:()=>({isSubmitting:!1,statusIndex:0,depositStatusIndex:0,statusOptions:["待支付","已支付","使用中","已完成","已取消"],depositStatusOptions:["未支付","已支付","已退还"],cabinetCheckStatus:null,orderForm:{userId:"",cabinetId:"",lockerPointId:"",storageLocationName:"",typeId:"",title:"",scheduledDuration:"",price:"",discount:0,amountPaid:"",status:0,depositStatus:0}}),methods:{onStatusChange(e){this.statusIndex=e.detail.value,this.orderForm.status=parseInt(e.detail.value)},onDepositStatusChange(e){this.depositStatusIndex=e.detail.value,this.orderForm.depositStatus=parseInt(e.detail.value)},validateForm(){const t=["userId","cabinetId","lockerPointId","storageLocationName","typeId","title","scheduledDuration","price","amountPaid"];for(let s of t)if(!this.orderForm[s]||""===this.orderForm[s])return e({title:`请填写${this.getFieldLabel(s)}`,icon:"none"}),!1;if(this.orderForm.scheduledDuration<=0)return e({title:"预定时长必须大于0分钟",icon:"none"}),!1;if(this.orderForm.price<=0)return e({title:"价格必须大于0",icon:"none"}),!1;if(this.orderForm.amountPaid<=0)return e({title:"实付金额必须大于0",icon:"none"}),!1;const a=this.orderForm.price-(this.orderForm.discount||0);return!(this.orderForm.amountPaid>a)||(e({title:"实付金额不能超过折后价格",icon:"none"}),!1)},getFieldLabel:e=>({userId:"用户ID",cabinetId:"柜子ID",lockerPointId:"存储点ID",storageLocationName:"存储位置名称",typeId:"柜子类型ID",title:"订单标题",scheduledDuration:"预定时长",price:"价格",amountPaid:"实付金额"}[e]||e),async handleSubmit(){if(this.validateForm()){this.isSubmitting=!0;try{const a={userId:parseInt(this.orderForm.userId),cabinetId:parseInt(this.orderForm.cabinetId),lockerPointId:parseInt(this.orderForm.lockerPointId),storageLocationName:this.orderForm.storageLocationName,typeId:parseInt(this.orderForm.typeId),title:this.orderForm.title,scheduledDuration:parseInt(this.orderForm.scheduledDuration),price:parseFloat(this.orderForm.price),discount:parseFloat(this.orderForm.discount)||0,amountPaid:parseFloat(this.orderForm.amountPaid),status:this.orderForm.status,depositStatus:this.orderForm.depositStatus},s=await this.createOrder(a);if(!s.success)throw new Error(s.message||"创建订单失败");e({title:"订单创建成功",icon:"success"}),setTimeout((()=>{t()}),1500)}catch(a){console.error("创建订单失败:",a);let t="创建订单失败";a.message.includes("DAILY_LIMIT_EXCEEDED")?t="订单数量上限，请等待再试":a.message.includes("CabinetId already exists")?t="该柜子已被占用，请选择其他柜子":a.message.includes("create order failed")?t="订单创建失败，请检查输入信息":a.message&&(t=a.message),e({title:t,icon:"none",duration:3e3})}finally{this.isSubmitting=!1}}},createOrder:e=>new Promise(((t,s)=>{console.log("发送订单创建请求:",e),a({url:"http://127.0.0.1:8000/v1/order/create",method:"POST",data:e,header:{"Content-Type":"application/json"},timeout:_.timeout,success:e=>{var a,o;if(console.log("订单创建响应:",e),200===e.statusCode)e.data&&e.data.msg?t({success:!0,data:e.data,message:e.data.msg}):t({success:!0,data:e.data,message:"订单创建成功"});else{const t=(null==(a=e.data)?void 0:a.message)||(null==(o=e.data)?void 0:o.msg)||"请求失败";s(new Error(t))}},fail:e=>{console.error("网络请求失败:",e),s(new Error("网络连接失败，请检查网络设置"))}})})),async checkCabinetAvailability(){if(this.orderForm.cabinetId)try{this.cabinetCheckStatus={type:"checking",message:"正在检查柜子状态..."},setTimeout((()=>{const e=Math.random()>.3;this.cabinetCheckStatus=e?{type:"available",message:"✓ 柜子可用"}:{type:"occupied",message:"✗ 柜子已被占用"}}),1e3)}catch(e){this.cabinetCheckStatus={type:"error",message:"检查失败，请稍后重试"}}else this.cabinetCheckStatus=null},handleReset(){this.orderForm={userId:"",cabinetId:"",lockerPointId:"",storageLocationName:"",typeId:"",title:"",scheduledDuration:"",price:"",discount:0,amountPaid:"",status:0,depositStatus:0},this.statusIndex=0,this.depositStatusIndex=0,this.cabinetCheckStatus=null,e({title:"表单已重置",icon:"success"})},goToIndex(){s({url:"/pages/index/index"})}},onLoad(){console.log("订单创建页面加载")}},[["render",function(e,t,a,s,_,g){const F=p,S=r,y=h,k=f,C=I,V=b;return d(),o(S,{class:"order-create"},{default:l((()=>[i(S,{class:"header"},{default:l((()=>[i(F,{class:"title"},{default:l((()=>[n("创建订单")])),_:1})])),_:1}),i(V,{onSubmit:g.handleSubmit,class:"order-form"},{default:l((()=>[i(S,{class:"form-section"},{default:l((()=>[i(F,{class:"section-title"},{default:l((()=>[n("用户信息")])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("用户ID")])),_:1}),i(y,{modelValue:_.orderForm.userId,"onUpdate:modelValue":t[0]||(t[0]=e=>_.orderForm.userId=e),type:"number",placeholder:"请输入用户ID",class:"input"},null,8,["modelValue"])])),_:1})])),_:1}),i(S,{class:"form-section"},{default:l((()=>[i(F,{class:"section-title"},{default:l((()=>[n("柜子信息")])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("柜子ID")])),_:1}),i(y,{modelValue:_.orderForm.cabinetId,"onUpdate:modelValue":t[1]||(t[1]=e=>_.orderForm.cabinetId=e),type:"number",placeholder:"请输入柜子ID",class:"input",onBlur:g.checkCabinetAvailability},null,8,["modelValue","onBlur"]),_.cabinetCheckStatus?(d(),o(S,{key:0,class:u(["cabinet-status",_.cabinetCheckStatus.type])},{default:l((()=>[i(F,{class:"status-text"},{default:l((()=>[n(c(_.cabinetCheckStatus.message),1)])),_:1})])),_:1},8,["class"])):m("",!0)])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("存储点ID")])),_:1}),i(y,{modelValue:_.orderForm.lockerPointId,"onUpdate:modelValue":t[2]||(t[2]=e=>_.orderForm.lockerPointId=e),type:"number",placeholder:"请输入存储点ID",class:"input"},null,8,["modelValue"])])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("存储位置名称")])),_:1}),i(y,{modelValue:_.orderForm.storageLocationName,"onUpdate:modelValue":t[3]||(t[3]=e=>_.orderForm.storageLocationName=e),type:"text",placeholder:"请输入存储位置名称",class:"input"},null,8,["modelValue"])])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("柜子类型ID")])),_:1}),i(y,{modelValue:_.orderForm.typeId,"onUpdate:modelValue":t[4]||(t[4]=e=>_.orderForm.typeId=e),type:"number",placeholder:"请输入柜子类型ID",class:"input"},null,8,["modelValue"])])),_:1})])),_:1}),i(S,{class:"form-section"},{default:l((()=>[i(F,{class:"section-title"},{default:l((()=>[n("订单信息")])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("订单标题")])),_:1}),i(y,{modelValue:_.orderForm.title,"onUpdate:modelValue":t[5]||(t[5]=e=>_.orderForm.title=e),type:"text",placeholder:"请输入订单标题",class:"input"},null,8,["modelValue"])])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("预定时长(分钟)")])),_:1}),i(y,{modelValue:_.orderForm.scheduledDuration,"onUpdate:modelValue":t[6]||(t[6]=e=>_.orderForm.scheduledDuration=e),type:"number",placeholder:"请输入预定时长",class:"input"},null,8,["modelValue"])])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("价格")])),_:1}),i(y,{modelValue:_.orderForm.price,"onUpdate:modelValue":t[7]||(t[7]=e=>_.orderForm.price=e),type:"number",step:"0.01",placeholder:"请输入价格",class:"input"},null,8,["modelValue"])])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("折扣")])),_:1}),i(y,{modelValue:_.orderForm.discount,"onUpdate:modelValue":t[8]||(t[8]=e=>_.orderForm.discount=e),type:"number",step:"0.01",placeholder:"请输入折扣",class:"input"},null,8,["modelValue"])])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("实付金额")])),_:1}),i(y,{modelValue:_.orderForm.amountPaid,"onUpdate:modelValue":t[9]||(t[9]=e=>_.orderForm.amountPaid=e),type:"number",step:"0.01",placeholder:"请输入实付金额",class:"input"},null,8,["modelValue"])])),_:1})])),_:1}),i(S,{class:"form-section"},{default:l((()=>[i(F,{class:"section-title"},{default:l((()=>[n("状态信息")])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("订单状态")])),_:1}),i(k,{onChange:g.onStatusChange,value:_.statusIndex,range:_.statusOptions},{default:l((()=>[i(S,{class:"picker"},{default:l((()=>[n(c(_.statusOptions[_.statusIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),i(S,{class:"form-item"},{default:l((()=>[i(F,{class:"label"},{default:l((()=>[n("押金状态")])),_:1}),i(k,{onChange:g.onDepositStatusChange,value:_.depositStatusIndex,range:_.depositStatusOptions},{default:l((()=>[i(S,{class:"picker"},{default:l((()=>[n(c(_.depositStatusOptions[_.depositStatusIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1}),i(S,{class:"form-actions"},{default:l((()=>[i(C,{onClick:g.handleSubmit,disabled:_.isSubmitting,class:"submit-btn"},{default:l((()=>[n(c(_.isSubmitting?"创建中...":"创建订单"),1)])),_:1},8,["onClick","disabled"]),i(C,{onClick:g.handleReset,class:"reset-btn"},{default:l((()=>[n("重置")])),_:1},8,["onClick"]),i(C,{onClick:g.goToIndex,class:"index-btn"},{default:l((()=>[n("返回首页")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["onSubmit"]),_.isSubmitting?(d(),o(S,{key:0,class:"loading-overlay"},{default:l((()=>[i(S,{class:"loading-content"},{default:l((()=>[i(F,null,{default:l((()=>[n("正在创建订单...")])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1})}],["__scopeId","data-v-24dd02eb"]]);export{F as default};
