<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•çŠ¶æ€è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .status-item.success {
            border-left-color: #28a745;
        }
        .status-item.error {
            border-left-color: #dc3545;
        }
        .status-item.warning {
            border-left-color: #ffc107;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ç™»å½•çŠ¶æ€è°ƒè¯•</h1>
    
    <!-- ç™»å½•çŠ¶æ€æ£€æŸ¥ -->
    <div class="container">
        <h3>ğŸ“‹ å½“å‰ç™»å½•çŠ¶æ€</h3>
        <div id="loginStatus"></div>
        <button onclick="checkLoginStatus()">ğŸ”„ æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
        <button onclick="clearLoginData()">ğŸ—‘ï¸ æ¸…é™¤ç™»å½•æ•°æ®</button>
        <button onclick="simulateLogin()">ğŸ” æ¨¡æ‹Ÿç™»å½•</button>
        <div id="statusResult" class="result"></div>
    </div>

    <!-- ç™»å½•æµ‹è¯• -->
    <div class="container">
        <h3>ğŸ§ª ç™»å½•æµ‹è¯•</h3>
        <button onclick="testLogin()">ğŸš€ æµ‹è¯•ç™»å½•</button>
        <button onclick="testLoginWithWrongParams()">âŒ æµ‹è¯•é”™è¯¯å‚æ•°</button>
        <div id="testResult" class="result"></div>
    </div>

    <!-- å­˜å‚¨æµ‹è¯• -->
    <div class="container">
        <h3>ğŸ’¾ å­˜å‚¨æµ‹è¯•</h3>
        <button onclick="testStorage()">ğŸ’¾ æµ‹è¯•å­˜å‚¨</button>
        <button onclick="testStorageRead()">ğŸ“– æµ‹è¯•è¯»å–</button>
        <div id="storageResult" class="result"></div>
    </div>

    <script>
        function checkLoginStatus() {
            const resultDiv = document.getElementById('statusResult');
            resultDiv.innerHTML = 'ğŸ” æ£€æŸ¥ç™»å½•çŠ¶æ€...';
            resultDiv.className = 'result info';
            
            // æ¨¡æ‹Ÿuni-appçš„å­˜å‚¨API
            const adminToken = localStorage.getItem('adminToken');
            const adminId = localStorage.getItem('adminId');
            const adminMobile = localStorage.getItem('adminMobile');
            
            console.log('=== ç™»å½•çŠ¶æ€æ£€æŸ¥ ===');
            console.log('adminToken:', adminToken);
            console.log('adminId:', adminId);
            console.log('adminMobile:', adminMobile);
            
            let statusHtml = '';
            
            // æ£€æŸ¥adminToken
            if (adminToken) {
                statusHtml += '<div class="status-item success">âœ… adminToken: ' + adminToken.substring(0, 20) + '...</div>';
            } else {
                statusHtml += '<div class="status-item error">âŒ adminToken: æœªæ‰¾åˆ°</div>';
            }
            
            // æ£€æŸ¥adminId
            if (adminId) {
                statusHtml += '<div class="status-item success">âœ… adminId: ' + adminId + '</div>';
            } else {
                statusHtml += '<div class="status-item error">âŒ adminId: æœªæ‰¾åˆ°</div>';
            }
            
            // æ£€æŸ¥adminMobile
            if (adminMobile) {
                statusHtml += '<div class="status-item success">âœ… adminMobile: ' + adminMobile + '</div>';
            } else {
                statusHtml += '<div class="status-item error">âŒ adminMobile: æœªæ‰¾åˆ°</div>';
            }
            
            // æ€»ä½“çŠ¶æ€
            if (adminToken || adminId || adminMobile) {
                statusHtml += '<div class="status-item success">âœ… ç™»å½•çŠ¶æ€: å·²ç™»å½•</div>';
                resultDiv.className = 'result success';
            } else {
                statusHtml += '<div class="status-item error">âŒ ç™»å½•çŠ¶æ€: æœªç™»å½•</div>';
                resultDiv.className = 'result error';
            }
            
            document.getElementById('loginStatus').innerHTML = statusHtml;
            
            resultDiv.innerHTML = 
                'ğŸ“‹ ç™»å½•çŠ¶æ€è¯¦æƒ…:\n\n' +
                'adminToken: ' + (adminToken || 'æœªæ‰¾åˆ°') + '\n' +
                'adminId: ' + (adminId || 'æœªæ‰¾åˆ°') + '\n' +
                'adminMobile: ' + (adminMobile || 'æœªæ‰¾åˆ°') + '\n\n' +
                'ğŸ’¡ è¯´æ˜: åœ¨uni-appä¸­ï¼Œè¿™äº›æ•°æ®åº”è¯¥é€šè¿‡uni.getStorageSync()è·å–';
        }
        
        function clearLoginData() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminId');
            localStorage.removeItem('adminMobile');
            
            const resultDiv = document.getElementById('statusResult');
            resultDiv.innerHTML = 'ğŸ—‘ï¸ å·²æ¸…é™¤æ‰€æœ‰ç™»å½•æ•°æ®';
            resultDiv.className = 'result warning';
            
            // é‡æ–°æ£€æŸ¥çŠ¶æ€
            setTimeout(checkLoginStatus, 1000);
        }
        
        function simulateLogin() {
            // æ¨¡æ‹Ÿç™»å½•æˆåŠŸåçš„æ•°æ®ä¿å­˜
            localStorage.setItem('adminToken', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test.token');
            localStorage.setItem('adminId', '1');
            localStorage.setItem('adminMobile', '13800138000');
            
            const resultDiv = document.getElementById('statusResult');
            resultDiv.innerHTML = 'ğŸ” å·²æ¨¡æ‹Ÿç™»å½•æ•°æ®ä¿å­˜';
            resultDiv.className = 'result success';
            
            // é‡æ–°æ£€æŸ¥çŠ¶æ€
            setTimeout(checkLoginStatus, 1000);
        }
        
        function testLogin() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = 'ğŸš€ æµ‹è¯•ç™»å½•...';
            resultDiv.className = 'result info';
            
            const loginData = {
                Mobile: '13800138000',
                Password: '123456',
                SmsCode: '1234'
            };
            
            console.log('=== æµ‹è¯•ç™»å½• ===');
            console.log('è¯·æ±‚å‚æ•°:', loginData);
            
            fetch('http://localhost:8000/admin/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(loginData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('å“åº”æ•°æ®:', data);
                
                if (data.code === 200 || data.code === "200") {
                    resultDiv.innerHTML = 
                        'âœ… ç™»å½•æµ‹è¯•æˆåŠŸ!\n\n' +
                        'ğŸ“± æ‰‹æœºå·: 13800138000\n' +
                        'ğŸ”‘ å¯†ç : 123456\n' +
                        'ğŸ“‹ éªŒè¯ç : 1234\n' +
                        'ğŸ†” ç®¡ç†å‘˜ID: ' + data.id + '\n' +
                        'ğŸ”‘ Token: ' + (data.token ? data.token.substring(0, 20) + '...' : 'N/A') + '\n' +
                        'ğŸ“‹ å“åº”: ' + JSON.stringify(data, null, 2);
                    resultDiv.className = 'result success';
                    
                    // æ¨¡æ‹Ÿä¿å­˜ç™»å½•æ•°æ®
                    localStorage.setItem('adminToken', data.token || 'test-token');
                    localStorage.setItem('adminId', data.id || '1');
                    localStorage.setItem('adminMobile', '13800138000');
                    
                    console.log('å·²ä¿å­˜ç™»å½•æ•°æ®åˆ°localStorage');
                } else {
                    resultDiv.innerHTML = 
                        'âŒ ç™»å½•æµ‹è¯•å¤±è´¥\n\n' +
                        'ğŸ“± æ‰‹æœºå·: 13800138000\n' +
                        'ğŸ”‘ å¯†ç : 123456\n' +
                        'ğŸ“‹ éªŒè¯ç : 1234\n' +
                        'âŒ é”™è¯¯: ' + (data.msg || 'æœªçŸ¥é”™è¯¯') + '\n' +
                        'ğŸ“‹ å“åº”: ' + JSON.stringify(data, null, 2);
                    resultDiv.className = 'result error';
                }
            })
            .catch(error => {
                resultDiv.innerHTML = 
                    'âŒ è¯·æ±‚å¤±è´¥\n\n' +
                    'ğŸ“± æ‰‹æœºå·: 13800138000\n' +
                    'ğŸ”‘ å¯†ç : 123456\n' +
                    'ğŸ“‹ éªŒè¯ç : 1234\n' +
                    'âŒ é”™è¯¯: ' + error.message + '\n\n' +
                    'ğŸ’¡ å¯èƒ½åŸå› :\n' +
                    '1. åç«¯æœåŠ¡æœªå¯åŠ¨\n' +
                    '2. å‚æ•°æ ¼å¼é”™è¯¯\n' +
                    '3. ç½‘ç»œè¿æ¥é—®é¢˜';
                resultDiv.className = 'result error';
            });
        }
        
        function testLoginWithWrongParams() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = 'ğŸš€ æµ‹è¯•é”™è¯¯å‚æ•°ç™»å½•...';
            resultDiv.className = 'result info';
            
            const wrongData = {
                mobile: '13800138000',      // é”™è¯¯çš„å‚æ•°å
                password: '123456',          // é”™è¯¯çš„å‚æ•°å
                smsCode: '1234'              // é”™è¯¯çš„å‚æ•°å
            };
            
            console.log('=== æµ‹è¯•é”™è¯¯å‚æ•°ç™»å½• ===');
            console.log('è¯·æ±‚å‚æ•°:', wrongData);
            
            fetch('http://localhost:8000/admin/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(wrongData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('å“åº”æ•°æ®:', data);
                
                resultDiv.innerHTML = 
                    'âŒ é”™è¯¯å‚æ•°ç™»å½•æµ‹è¯•ç»“æœ\n\n' +
                    'ğŸ“± æ‰‹æœºå·: 13800138000\n' +
                    'ğŸ”‘ å¯†ç : 123456\n' +
                    'ğŸ“‹ éªŒè¯ç : 1234\n' +
                    'âŒ é”™è¯¯: å‚æ•°åä¸åŒ¹é…ï¼Œåç«¯æ— æ³•è¯†åˆ«\n' +
                    'ğŸ“‹ å“åº”: ' + JSON.stringify(data, null, 2) + '\n\n' +
                    'ğŸ’¡ è¯´æ˜: ä½¿ç”¨é”™è¯¯çš„å‚æ•°åä¼šå¯¼è‡´åç«¯æ— æ³•æ­£ç¡®æ¥æ”¶å‚æ•°';
                resultDiv.className = 'result error';
            })
            .catch(error => {
                resultDiv.innerHTML = 
                    'âŒ è¯·æ±‚å¤±è´¥\n\n' +
                    'ğŸ“± æ‰‹æœºå·: 13800138000\n' +
                    'ğŸ”‘ å¯†ç : 123456\n' +
                    'ğŸ“‹ éªŒè¯ç : 1234\n' +
                    'âŒ é”™è¯¯: ' + error.message + '\n\n' +
                    'ğŸ’¡ è¯´æ˜: å‚æ•°åé”™è¯¯ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥';
                resultDiv.className = 'result error';
            });
        }
        
        function testStorage() {
            const resultDiv = document.getElementById('storageResult');
            resultDiv.innerHTML = 'ğŸ’¾ æµ‹è¯•å­˜å‚¨...';
            resultDiv.className = 'result info';
            
            // æµ‹è¯•å­˜å‚¨
            const testData = {
                token: 'test-token-' + Date.now(),
                id: '1',
                mobile: '13800138000'
            };
            
            localStorage.setItem('adminToken', testData.token);
            localStorage.setItem('adminId', testData.id);
            localStorage.setItem('adminMobile', testData.mobile);
            
            resultDiv.innerHTML = 
                'âœ… å­˜å‚¨æµ‹è¯•æˆåŠŸ!\n\n' +
                'ğŸ’¾ å·²å­˜å‚¨æ•°æ®:\n' +
                'adminToken: ' + testData.token + '\n' +
                'adminId: ' + testData.id + '\n' +
                'adminMobile: ' + testData.mobile + '\n\n' +
                'ğŸ’¡ è¯´æ˜: localStorageå·¥ä½œæ­£å¸¸';
            resultDiv.className = 'result success';
        }
        
        function testStorageRead() {
            const resultDiv = document.getElementById('storageResult');
            resultDiv.innerHTML = 'ğŸ“– æµ‹è¯•è¯»å–...';
            resultDiv.className = 'result info';
            
            // æµ‹è¯•è¯»å–
            const adminToken = localStorage.getItem('adminToken');
            const adminId = localStorage.getItem('adminId');
            const adminMobile = localStorage.getItem('adminMobile');
            
            resultDiv.innerHTML = 
                'ğŸ“– è¯»å–æµ‹è¯•ç»“æœ:\n\n' +
                'adminToken: ' + (adminToken || 'æœªæ‰¾åˆ°') + '\n' +
                'adminId: ' + (adminId || 'æœªæ‰¾åˆ°') + '\n' +
                'adminMobile: ' + (adminMobile || 'æœªæ‰¾åˆ°') + '\n\n' +
                'ğŸ’¡ è¯´æ˜: åœ¨uni-appä¸­åº”ä½¿ç”¨uni.getStorageSync()';
            resultDiv.className = 'result info';
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            console.log('=== ç™»å½•çŠ¶æ€è°ƒè¯•é¡µé¢åŠ è½½ ===');
            console.log('æµ‹è¯•è¯´æ˜:');
            console.log('1. æ£€æŸ¥å½“å‰ç™»å½•çŠ¶æ€');
            console.log('2. æµ‹è¯•ç™»å½•åŠŸèƒ½');
            console.log('3. æµ‹è¯•å­˜å‚¨åŠŸèƒ½');
            
            // è‡ªåŠ¨æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkLoginStatus();
        };
    </script>
</body>
</html> 