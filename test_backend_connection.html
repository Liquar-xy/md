<!DOCTYPE html>
<html>
<head>
    <title>åç«¯æ¥å£è¿æ¥æµ‹è¯•</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #dee2e6; border-radius: 8px; }
        .test-button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .test-button.primary { background: #007bff; color: white; }
        .test-button.success { background: #28a745; color: white; }
        .test-button.danger { background: #dc3545; color: white; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .test-result.success { background: #d4edda; border: 1px solid #c3e6cb; }
        .test-result.error { background: #f8d7da; border: 1px solid #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ”§ åç«¯æ¥å£è¿æ¥æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“¡ APIæ¥å£æµ‹è¯•</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•å„ä¸ªåç«¯æ¥å£æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p>
        
        <button class="test-button primary" onclick="testHealthCheck()">å¥åº·æ£€æŸ¥</button>
        <button class="test-button primary" onclick="testLockersDistribution()">å¯„å­˜ç‚¹åˆ†å¸ƒ</button>
        <button class="test-button primary" onclick="testNearbySearch()">é™„è¿‘æœç´¢</button>
        <button class="test-button primary" onclick="testCitiesList()">åŸå¸‚åˆ—è¡¨</button>
        <button class="test-button success" onclick="testAllApis()">æµ‹è¯•æ‰€æœ‰æ¥å£</button>
        
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>âš™ï¸ åç«¯æœåŠ¡å¯åŠ¨æŒ‡å—</h2>
        
        <h3>Goåç«¯æœåŠ¡å¯åŠ¨ï¼š</h3>
        <pre><code># è¿›å…¥åç«¯ç›®å½•
cd ito-deposit

# å®‰è£…ä¾èµ–
go mod tidy

# å¯åŠ¨æœåŠ¡
go run cmd/ito-deposit/main.go

# æˆ–è€…ä½¿ç”¨Kratoså‘½ä»¤
kratos run</code></pre>
        
        <h3>æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š</h3>
        <pre><code># æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr :8000

# æˆ–è€…ç›´æ¥è®¿é—®å¥åº·æ£€æŸ¥æ¥å£
curl http://localhost:8000/health</code></pre>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”— APIæ¥å£åˆ—è¡¨</h2>
        
        <h3>ç”¨æˆ·è®¤è¯ç›¸å…³ï¼š</h3>
        <ul>
            <li><code>POST /api/auth/login</code> - ç”¨æˆ·ç™»å½•</li>
            <li><code>POST /api/auth/admin/login</code> - ç®¡ç†å‘˜ç™»å½•</li>
            <li><code>POST /api/auth/sms</code> - å‘é€çŸ­ä¿¡éªŒè¯ç </li>
        </ul>
        
        <h3>å¯„å­˜ç‚¹ç›¸å…³ï¼š</h3>
        <ul>
            <li><code>POST /api/lockers/distribution</code> - è·å–å¯„å­˜ç‚¹åˆ†å¸ƒ</li>
            <li><code>GET /api/lockers/{id}</code> - è·å–å¯„å­˜ç‚¹è¯¦æƒ…</li>
            <li><code>GET /api/nearby/city/search</code> - é™„è¿‘æœç´¢</li>
            <li><code>GET /api/nearby/my-nearby</code> - æˆ‘çš„é™„è¿‘</li>
            <li><code>GET /api/nearby/city/map</code> - åœ°å›¾æ•°æ®</li>
        </ul>
        
        <h3>å…¶ä»–æ¥å£ï¼š</h3>
        <ul>
            <li><code>GET /api/cities</code> - åŸå¸‚åˆ—è¡¨</li>
            <li><code>POST /api/orders/list</code> - è®¢å•åˆ—è¡¨</li>
            <li><code>POST /api/orders/detail</code> - è®¢å•è¯¦æƒ…</li>
            <li><code>POST /api/admin/dashboard</code> - ç®¡ç†å‘˜é¢æ¿</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³</h2>
        
        <h3>é—®é¢˜1ï¼šERR_CONNECTION_REFUSED</h3>
        <div class="error">
            <p><strong>åŸå› </strong>ï¼šåç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£è¢«å ç”¨</p>
            <p><strong>è§£å†³</strong>ï¼š</p>
            <ul>
                <li>æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨</li>
                <li>ç¡®è®¤ç«¯å£8000æ²¡æœ‰è¢«å…¶ä»–ç¨‹åºå ç”¨</li>
                <li>æ£€æŸ¥é˜²ç«å¢™è®¾ç½®</li>
            </ul>
        </div>
        
        <h3>é—®é¢˜2ï¼š404 Not Found</h3>
        <div class="warning">
            <p><strong>åŸå› </strong>ï¼šAPIè·¯å¾„ä¸æ­£ç¡®æˆ–åç«¯è·¯ç”±æœªé…ç½®</p>
            <p><strong>è§£å†³</strong>ï¼š</p>
            <ul>
                <li>æ£€æŸ¥APIè·¯å¾„æ˜¯å¦æ­£ç¡®</li>
                <li>ç¡®è®¤åç«¯è·¯ç”±é…ç½®</li>
                <li>æŸ¥çœ‹åç«¯æ—¥å¿—</li>
            </ul>
        </div>
        
        <h3>é—®é¢˜3ï¼šCORSè·¨åŸŸé”™è¯¯</h3>
        <div class="info">
            <p><strong>åŸå› </strong>ï¼šåç«¯æœªé…ç½®CORSæˆ–é…ç½®ä¸æ­£ç¡®</p>
            <p><strong>è§£å†³</strong>ï¼š</p>
            <ul>
                <li>åœ¨åç«¯æ·»åŠ CORSä¸­é—´ä»¶</li>
                <li>å…è®¸å‰ç«¯åŸŸåè®¿é—®</li>
                <li>é…ç½®æ­£ç¡®çš„è¯·æ±‚å¤´</li>
            </ul>
        </div>
    </div>
    
    <script>
        const API_BASE_URL = 'http://localhost:8000';
        
        function addTestResult(message, isSuccess = true) {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }
        
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }
        
        async function testHealthCheck() {
            clearResults();
            addTestResult('ğŸ” æ­£åœ¨æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£...', true);
            
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    const data = await response.text();
                    addTestResult(`âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${data}`, true);
                } else {
                    addTestResult(`âŒ å¥åº·æ£€æŸ¥å¤±è´¥: HTTP ${response.status}`, false);
                }
            } catch (error) {
                addTestResult(`âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, false);
                addTestResult('ğŸ’¡ è¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨åœ¨ç«¯å£8000', false);
            }
        }
        
        async function testLockersDistribution() {
            addTestResult('ğŸ” æ­£åœ¨æµ‹è¯•å¯„å­˜ç‚¹åˆ†å¸ƒæ¥å£...', true);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/lockers/distribution`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        city: 'éƒ‘å·',
                        longitude: 113.6253,
                        latitude: 34.7466,
                        radius: 10
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult(`âœ… å¯„å­˜ç‚¹åˆ†å¸ƒæ¥å£æˆåŠŸ: è¿”å›${data.lockers ? data.lockers.length : 0}ä¸ªå¯„å­˜ç‚¹`, true);
                } else {
                    addTestResult(`âŒ å¯„å­˜ç‚¹åˆ†å¸ƒæ¥å£å¤±è´¥: HTTP ${response.status}`, false);
                }
            } catch (error) {
                addTestResult(`âŒ å¯„å­˜ç‚¹åˆ†å¸ƒæ¥å£å¤±è´¥: ${error.message}`, false);
            }
        }
        
        async function testNearbySearch() {
            addTestResult('ğŸ” æ­£åœ¨æµ‹è¯•é™„è¿‘æœç´¢æ¥å£...', true);
            
            try {
                const params = new URLSearchParams({
                    city_name: 'éƒ‘å·',
                    keyword: 'ç«è½¦ç«™',
                    page: '1',
                    page_size: '10'
                });
                
                const response = await fetch(`${API_BASE_URL}/api/nearby/city/search?${params}`);
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult(`âœ… é™„è¿‘æœç´¢æ¥å£æˆåŠŸ: æ‰¾åˆ°ç›¸å…³ç»“æœ`, true);
                } else {
                    addTestResult(`âŒ é™„è¿‘æœç´¢æ¥å£å¤±è´¥: HTTP ${response.status}`, false);
                }
            } catch (error) {
                addTestResult(`âŒ é™„è¿‘æœç´¢æ¥å£å¤±è´¥: ${error.message}`, false);
            }
        }
        
        async function testCitiesList() {
            addTestResult('ğŸ” æ­£åœ¨æµ‹è¯•åŸå¸‚åˆ—è¡¨æ¥å£...', true);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/cities`);
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult(`âœ… åŸå¸‚åˆ—è¡¨æ¥å£æˆåŠŸ: è¿”å›åŸå¸‚æ•°æ®`, true);
                } else {
                    addTestResult(`âŒ åŸå¸‚åˆ—è¡¨æ¥å£å¤±è´¥: HTTP ${response.status}`, false);
                }
            } catch (error) {
                addTestResult(`âŒ åŸå¸‚åˆ—è¡¨æ¥å£å¤±è´¥: ${error.message}`, false);
            }
        }
        
        async function testAllApis() {
            clearResults();
            addTestResult('ğŸš€ å¼€å§‹æµ‹è¯•æ‰€æœ‰APIæ¥å£...', true);
            
            await testHealthCheck();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testLockersDistribution();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testNearbySearch();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testCitiesList();
            
            addTestResult('âœ… æ‰€æœ‰æ¥å£æµ‹è¯•å®Œæˆï¼', true);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿›è¡Œå¥åº·æ£€æŸ¥
        window.onload = function() {
            setTimeout(testHealthCheck, 1000);
        };
    </script>
</body>
</html>